<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>系统状态</title><script type="module">import "https://testingcf.jsdelivr.net/npm/pinia/+esm";

var __webpack_modules__ = {
  235: (__unused_webpack_module, exports) => {
    var __webpack_unused_export__;
    __webpack_unused_export__ = {
      value: true
    };
    exports.A = (sfc, props) => {
      const target = sfc.__vccOpts || sfc;
      for (const [key, val] of props) {
        target[key] = val;
      }
      return target;
    };
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  __webpack_require__.n = module => {
    var getter = module && module.__esModule ? () => module["default"] : () => module;
    __webpack_require__.d(getter, {
      a: getter
    });
    return getter;
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

var __webpack_exports__ = {};

const external_Vue_namespaceObject = Vue;

const external_z_namespaceObject = z;

const ERA_EVENT_NAMES = {
  INSERT_BY_OBJECT: "era:insertByObject",
  UPDATE_BY_OBJECT: "era:updateByObject",
  INSERT_BY_PATH: "era:insertByPath",
  UPDATE_BY_PATH: "era:updateByPath",
  DELETE_BY_OBJECT: "era:deleteByObject",
  DELETE_BY_PATH: "era:deleteByPath",
  GET_CURRENT_VARS: "era:getCurrentVars",
  GET_SNAPSHOT_AT_MK: "era:getSnapshotAtMk",
  GET_SNAPSHOTS_BETWEEN_MKS: "era:getSnapshotsBetweenMks",
  GET_SNAPSHOT_AT_MID: "era:getSnapshotAtMId",
  GET_SNAPSHOTS_BETWEEN_MIDS: "era:getSnapshotsBetweenMIds",
  REQUEST_WRITE_DONE: "era:requestWriteDone"
};

const ERA_BROADCAST_EVENT_NAMES = {
  WRITE_DONE: "era:writeDone",
  QUERY_RESULT: "era:queryResult"
};

const QueryResultItemSchema = external_z_namespaceObject.z.object({
  mk: external_z_namespaceObject.z.string(),
  message_id: external_z_namespaceObject.z.number(),
  is_user: external_z_namespaceObject.z.boolean(),
  stat: external_z_namespaceObject.z.any(),
  statWithoutMeta: external_z_namespaceObject.z.any()
});

const mkValueSchema = external_z_namespaceObject.z.string().nullable();

const PeriodAnchorSchema = external_z_namespaceObject.z.object({
  newDawn: mkValueSchema,
  newMorning: mkValueSchema,
  newNoon: mkValueSchema,
  newAfternoon: mkValueSchema,
  newDusk: mkValueSchema,
  newNight: mkValueSchema,
  newFirstHalfNight: mkValueSchema,
  newSecondHalfNight: mkValueSchema
}).partial().default({});

const SeasonAnchorSchema = external_z_namespaceObject.z.object({
  newSpring: mkValueSchema,
  newSummer: mkValueSchema,
  newAutumn: mkValueSchema,
  newWinter: mkValueSchema
}).partial().default({});

const TimeChatMkAnchorsSchema = external_z_namespaceObject.z.object({
  newPeriod: mkValueSchema,
  period: PeriodAnchorSchema,
  newDay: mkValueSchema,
  newWeek: mkValueSchema,
  newMonth: mkValueSchema,
  newSeason: mkValueSchema,
  season: SeasonAnchorSchema,
  newYear: mkValueSchema
}).partial().default({});

const createEmptyAnchors = () => ({});

const TimeChatMkSyncCacheSchema = external_z_namespaceObject.z.object({
  anchors: TimeChatMkAnchorsSchema.optional()
}).optional().default(() => ({
  anchors: createEmptyAnchors()
}));

const TimeChatMkSyncRuntimeSchema = external_z_namespaceObject.z.object({
  anchors: TimeChatMkAnchorsSchema.optional()
}).optional().default(() => ({
  anchors: createEmptyAnchors()
}));

const BY_PERIOD_KEYS = null && TIME_PERIOD_KEYS;

const BY_SEASON_KEYS = null && TIME_SEASON_KEYS;

const ClockAckSchema = external_z_namespaceObject.z.object({
  dayID: external_z_namespaceObject.z.number(),
  weekID: external_z_namespaceObject.z.number(),
  monthID: external_z_namespaceObject.z.number(),
  yearID: external_z_namespaceObject.z.number(),
  periodID: external_z_namespaceObject.z.number(),
  periodIdx: external_z_namespaceObject.z.number(),
  seasonID: external_z_namespaceObject.z.number(),
  seasonIdx: external_z_namespaceObject.z.number()
});

const NowSchema = external_z_namespaceObject.z.object({
  iso: external_z_namespaceObject.z.string(),
  year: external_z_namespaceObject.z.number(),
  month: external_z_namespaceObject.z.number(),
  day: external_z_namespaceObject.z.number(),
  weekdayIndex: external_z_namespaceObject.z.number(),
  weekdayName: external_z_namespaceObject.z.string(),
  periodName: external_z_namespaceObject.z.string(),
  periodIdx: external_z_namespaceObject.z.number(),
  minutesSinceMidnight: external_z_namespaceObject.z.number(),
  seasonName: external_z_namespaceObject.z.string(),
  seasonIdx: external_z_namespaceObject.z.number(),
  hour: external_z_namespaceObject.z.number(),
  minute: external_z_namespaceObject.z.number(),
  hm: external_z_namespaceObject.z.string()
});

const ClockFlagsSchema = external_z_namespaceObject.z.object({
  newPeriod: external_z_namespaceObject.z.boolean(),
  byPeriod: external_z_namespaceObject.z.object({
    newDawn: external_z_namespaceObject.z.boolean(),
    newMorning: external_z_namespaceObject.z.boolean(),
    newNoon: external_z_namespaceObject.z.boolean(),
    newAfternoon: external_z_namespaceObject.z.boolean(),
    newDusk: external_z_namespaceObject.z.boolean(),
    newNight: external_z_namespaceObject.z.boolean(),
    newFirstHalfNight: external_z_namespaceObject.z.boolean(),
    newSecondHalfNight: external_z_namespaceObject.z.boolean()
  }),
  newDay: external_z_namespaceObject.z.boolean(),
  newWeek: external_z_namespaceObject.z.boolean(),
  newMonth: external_z_namespaceObject.z.boolean(),
  newSeason: external_z_namespaceObject.z.boolean(),
  bySeason: external_z_namespaceObject.z.object({
    newSpring: external_z_namespaceObject.z.boolean(),
    newSummer: external_z_namespaceObject.z.boolean(),
    newAutumn: external_z_namespaceObject.z.boolean(),
    newWinter: external_z_namespaceObject.z.boolean()
  }),
  newYear: external_z_namespaceObject.z.boolean()
});

const CLOCK_ROOT_FLAG_KEYS = null && [ "newPeriod", "newDay", "newWeek", "newMonth", "newSeason", "newYear" ];

const ClockSchema = external_z_namespaceObject.z.object({
  now: NowSchema,
  flags: ClockFlagsSchema,
  mkAnchors: TimeChatMkAnchorsSchema.optional(),
  previousMkAnchors: TimeChatMkAnchorsSchema.optional()
});

const EMPTY_NOW = {
  iso: "",
  year: 0,
  month: 0,
  day: 0,
  weekdayIndex: 0,
  weekdayName: "",
  periodName: "",
  periodIdx: 0,
  minutesSinceMidnight: 0,
  seasonName: "",
  seasonIdx: 0,
  hour: 0,
  minute: 0,
  hm: ""
};

const EMPTY_FLAGS = {
  newPeriod: false,
  byPeriod: {
    newDawn: false,
    newMorning: false,
    newNoon: false,
    newAfternoon: false,
    newDusk: false,
    newNight: false,
    newFirstHalfNight: false,
    newSecondHalfNight: false
  },
  newDay: false,
  newWeek: false,
  newMonth: false,
  newSeason: false,
  bySeason: {
    newSpring: false,
    newSummer: false,
    newAutumn: false,
    newWinter: false
  },
  newYear: false
};

const OtherCharacterInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  target: external_z_namespaceObject.z.string()
});

const AyaNewsEntrySchema = external_z_namespaceObject.z.object({
  location: external_z_namespaceObject.z.string(),
  otherCharacters: external_z_namespaceObject.z.array(OtherCharacterInfoSchema),
  target: external_z_namespaceObject.z.string(),
  clockAck: ClockAckSchema
});

const AyaNewsSchema = external_z_namespaceObject.z.object({
  entries: external_z_namespaceObject.z.array(AyaNewsEntrySchema)
});

const PreprocessStringifiedObject = schema => external_z_namespaceObject.z.preprocess(val => {
  if (typeof val === "string") {
    try {
      return JSON.parse(val);
    } catch (e) {
      return val;
    }
  }
  return val;
}, schema);

const TimeUnitSchema = external_z_namespaceObject.z.enum([ "period", "day", "week", "month", "season", "year" ]);

const ForgettingRuleSchema = external_z_namespaceObject.z.object({
  triggerFlag: external_z_namespaceObject.z.string(),
  decrease: external_z_namespaceObject.z.number()
});

const AffectionStageWithForgetSchema = external_z_namespaceObject.z.object({
  threshold: external_z_namespaceObject.z.number(),
  name: external_z_namespaceObject.z.string(),
  describe: external_z_namespaceObject.z.string().nullable().optional(),
  patienceUnit: TimeUnitSchema.optional(),
  visit: external_z_namespaceObject.z.object({
    enabled: external_z_namespaceObject.z.boolean().optional(),
    probBase: external_z_namespaceObject.z.number().optional(),
    probK: external_z_namespaceObject.z.number().optional(),
    coolUnit: TimeUnitSchema.optional()
  }).optional(),
  forgettingSpeed: external_z_namespaceObject.z.array(PreprocessStringifiedObject(ForgettingRuleSchema)).optional(),
  affectionGrowthLimit: external_z_namespaceObject.z.object({
    max: external_z_namespaceObject.z.number(),
    divisor: external_z_namespaceObject.z.number()
  }).optional()
}).passthrough();

const ActionSchema = external_z_namespaceObject.z.object({
  do: external_z_namespaceObject.z.string(),
  to: external_z_namespaceObject.z.string().optional(),
  from: external_z_namespaceObject.z.string().optional(),
  source: external_z_namespaceObject.z.string().optional()
});

const EntrySchema = external_z_namespaceObject.z.object({
  when: external_z_namespaceObject.z.any(),
  action: ActionSchema,
  priority: external_z_namespaceObject.z.number().optional()
});

const EntryListSchema = external_z_namespaceObject.z.array(EntrySchema);

const EntryListPreprocessSchema = external_z_namespaceObject.z.array(PreprocessStringifiedObject(EntrySchema));

const CharacterSettingsSchema = external_z_namespaceObject.z.object({
  id: external_z_namespaceObject.z.string(),
  name: external_z_namespaceObject.z.string(),
  affectionStages: external_z_namespaceObject.z.array(AffectionStageWithForgetSchema),
  specials: EntryListPreprocessSchema,
  routine: EntryListPreprocessSchema
});

const CharacterSettingsMapSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterSettingsSchema);

const IncidentDetailSchema = external_z_namespaceObject.z.object({
  异变细节: external_z_namespaceObject.z.string(),
  主要地区: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  异变退治者: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional(),
  异变已结束: external_z_namespaceObject.z.boolean()
});

const IncidentsSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), IncidentDetailSchema);

const WEATHER_CONDITION_TYPES = [ "clear", "partly_cloudy", "overcast", "light_rain", "heavy_rain", "storm", "snow", "fog" ];

const WeatherConditionTypeEnum = external_z_namespaceObject.z.enum(WEATHER_CONDITION_TYPES);

const WeatherConditionSchema = external_z_namespaceObject.z.object({
  type: WeatherConditionTypeEnum,
  label: external_z_namespaceObject.z.string(),
  description: external_z_namespaceObject.z.string()
});

const WeatherTemperatureSchema = external_z_namespaceObject.z.object({
  minC: external_z_namespaceObject.z.number(),
  maxC: external_z_namespaceObject.z.number()
});

const WeatherDaySchema = external_z_namespaceObject.z.object({
  condition: WeatherConditionSchema,
  temperature: WeatherTemperatureSchema,
  precipitationChance: external_z_namespaceObject.z.number().min(0).max(1),
  humidity: external_z_namespaceObject.z.number().min(0).max(1),
  windLevel: external_z_namespaceObject.z.number().min(0),
  narrative: external_z_namespaceObject.z.string()
});

const WeatherRuntimeSchema = external_z_namespaceObject.z.object({
  generatedAtISO: external_z_namespaceObject.z.string(),
  anchorDayISO: external_z_namespaceObject.z.string(),
  days: external_z_namespaceObject.z.array(WeatherDaySchema).min(1)
});

const MapSizeSchema = external_z_namespaceObject.z.object({
  width: external_z_namespaceObject.z.number(),
  height: external_z_namespaceObject.z.number()
});

const MapPositionSchema = external_z_namespaceObject.z.object({
  x: external_z_namespaceObject.z.number(),
  y: external_z_namespaceObject.z.number()
});

const MapLeafSchema = external_z_namespaceObject.z.object({
  pos: MapPositionSchema,
  htmlEle: external_z_namespaceObject.z.string(),
  aliases: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).default([])
}).passthrough();

const MapTreeSchema = external_z_namespaceObject.z.lazy(() => external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.union([ MapLeafSchema, MapTreeSchema ])));

const MapGraphSchema = external_z_namespaceObject.z.object({
  mapSize: MapSizeSchema,
  tree: MapTreeSchema,
  edges: external_z_namespaceObject.z.array(PreprocessStringifiedObject(external_z_namespaceObject.z.object({
    a: external_z_namespaceObject.z.string(),
    b: external_z_namespaceObject.z.string()
  }))).optional(),
  aliases: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string())).optional()
});

const WORLD_DEFAULTS = {
  fallbackPlace: "博丽神社",
  mainStoryTag: "gensokyo"
};

const WorldSchema = external_z_namespaceObject.z.object({
  map_graph: MapGraphSchema.optional(),
  fallbackPlace: external_z_namespaceObject.z.string().default(WORLD_DEFAULTS.fallbackPlace)
}).passthrough();

const timeSchema = external_z_namespaceObject.z.object({
  timeProgress: external_z_namespaceObject.z.number()
}).passthrough();

const IncidentRuntimeInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  detail: external_z_namespaceObject.z.string(),
  solver: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  mainLoc: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  isFinished: external_z_namespaceObject.z.boolean(),
  raw: IncidentDetailSchema
});

const runtime_ActionSchema = external_z_namespaceObject.z.object({
  do: external_z_namespaceObject.z.string(),
  to: external_z_namespaceObject.z.string().optional(),
  from: external_z_namespaceObject.z.string().optional(),
  source: external_z_namespaceObject.z.string().optional()
});

const IncidentSchema = external_z_namespaceObject.z.object({
  decision: external_z_namespaceObject.z.enum([ "continue", "start_new", "daily" ]),
  current: IncidentRuntimeInfoSchema.optional(),
  spawn: IncidentRuntimeInfoSchema.optional(),
  remainingCooldown: external_z_namespaceObject.z.number().optional(),
  isIncidentActive: external_z_namespaceObject.z.boolean()
});

const CurrentFestivalInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  host: external_z_namespaceObject.z.string(),
  customs: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  month: external_z_namespaceObject.z.number(),
  start_day: external_z_namespaceObject.z.number(),
  end_day: external_z_namespaceObject.z.number()
});

const NextFestivalInfoSchema = CurrentFestivalInfoSchema.extend({
  days_until: external_z_namespaceObject.z.number()
});

const FestivalSchema = external_z_namespaceObject.z.object({
  ongoing: external_z_namespaceObject.z.boolean(),
  upcoming: external_z_namespaceObject.z.boolean(),
  current: CurrentFestivalInfoSchema.nullable(),
  next: NextFestivalInfoSchema.nullable()
});

const CharacterDistributionSchema = external_z_namespaceObject.z.object({
  playerLocation: external_z_namespaceObject.z.string().nullable(),
  npcByLocation: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()))
});

const CharacterRuntimeSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string().optional(),
  affectionStage: AffectionStageWithForgetSchema.optional(),
  decision: runtime_ActionSchema.optional(),
  companionDecision: runtime_ActionSchema.optional()
});

const BfsPathSchema = external_z_namespaceObject.z.object({
  hops: external_z_namespaceObject.z.number(),
  steps: external_z_namespaceObject.z.array(external_z_namespaceObject.z.object({
    from: external_z_namespaceObject.z.string(),
    to: external_z_namespaceObject.z.string()
  }))
});

const RouteSchema = external_z_namespaceObject.z.object({
  destination: external_z_namespaceObject.z.string(),
  path: BfsPathSchema
});

const RouteInfoSchema = external_z_namespaceObject.z.object({
  candidates: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  routes: external_z_namespaceObject.z.array(RouteSchema)
});

const FullMapLeafSchema = MapLeafSchema.extend({
  name: external_z_namespaceObject.z.string()
});

const AreaRuntimeInfoSchema = external_z_namespaceObject.z.object({
  graph: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.boolean())),
  legal_locations: external_z_namespaceObject.z.array(FullMapLeafSchema),
  neighbors: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  loadArea: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  route: RouteInfoSchema,
  mapSize: MapSizeSchema.optional()
});

const RuntimeSchema = external_z_namespaceObject.z.object({
  incident: IncidentSchema.optional(),
  clock: ClockSchema.optional(),
  weather: WeatherRuntimeSchema.optional(),
  area: AreaRuntimeInfoSchema.optional(),
  festival: FestivalSchema.optional(),
  characterDistribution: CharacterDistributionSchema.optional(),
  character: external_z_namespaceObject.z.object({
    chars: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterRuntimeSchema),
    partitions: external_z_namespaceObject.z.object({
      coLocated: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
      remote: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string())
    }),
    mentionedCharIds: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional()
  }).optional(),
  characterLog: external_z_namespaceObject.z.object({}).passthrough().optional(),
  characterSettings: CharacterSettingsMapSchema.optional(),
  snapshots: external_z_namespaceObject.z.array(QueryResultItemSchema).optional(),
  ayaNews: AyaNewsSchema.optional()
});

const CharacterCacheSchema = external_z_namespaceObject.z.object({
  visit: external_z_namespaceObject.z.object({
    cooling: external_z_namespaceObject.z.boolean().optional()
  }).optional()
});

const IncidentCacheSchema = external_z_namespaceObject.z.object({
  incidentCooldownAnchor: external_z_namespaceObject.z.number().nullable().optional()
});

const CacheSchema = external_z_namespaceObject.z.object({
  time: external_z_namespaceObject.z.object({
    clockAck: ClockAckSchema.optional()
  }).optional().default({}),
  incident: IncidentCacheSchema.optional().default({}),
  character: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterCacheSchema).optional().default({}),
  timeChatMkSync: TimeChatMkSyncCacheSchema.optional().default({})
});

const CharacterSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  pic: external_z_namespaceObject.z.string().optional(),
  好感度: external_z_namespaceObject.z.number(),
  所在地区: external_z_namespaceObject.z.string().nullable(),
  居住地区: external_z_namespaceObject.z.string().nullable(),
  affectionStages: external_z_namespaceObject.z.array(PreprocessStringifiedObject(AffectionStageWithForgetSchema)).default([]),
  specials: EntryListPreprocessSchema.default([]),
  routine: EntryListPreprocessSchema.default([]),
  目标: external_z_namespaceObject.z.string().optional(),
  身体状况: external_z_namespaceObject.z.string().optional(),
  内心想法: external_z_namespaceObject.z.string().optional()
});

const CharsSchema = external_z_namespaceObject.z.object({
  $meta: external_z_namespaceObject.z.any().optional()
}).catchall(CharacterSchema);

const CHARACTER_FIELDS = {
  affection: "好感度",
  currentLocation: "所在地区",
  home: "居住地区"
};

const UiConfigSchema = external_z_namespaceObject.z.object({
  theme: external_z_namespaceObject.z.enum([ "light", "dark" ]).default("light"),
  mainFontPercent: external_z_namespaceObject.z.number().default(100),
  fontScaleStepPct: external_z_namespaceObject.z.number().default(10)
}).passthrough();

const IncidentPoolItemSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  detail: external_z_namespaceObject.z.string(),
  mainLoc: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ])
});

const IncidentConfigSchema = external_z_namespaceObject.z.object({
  cooldownMinutes: external_z_namespaceObject.z.number(),
  forceTrigger: external_z_namespaceObject.z.boolean(),
  isRandomPool: external_z_namespaceObject.z.boolean(),
  pool: external_z_namespaceObject.z.array(PreprocessStringifiedObject(IncidentPoolItemSchema)).optional(),
  randomCore: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional(),
  randomType: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional()
});

const FlagHistoryLimitSchema = external_z_namespaceObject.z.number().int().min(0);

const PeriodFlagHistoryLimitSchema = external_z_namespaceObject.z.object({
  newDawn: FlagHistoryLimitSchema,
  newMorning: FlagHistoryLimitSchema,
  newNoon: FlagHistoryLimitSchema,
  newAfternoon: FlagHistoryLimitSchema,
  newDusk: FlagHistoryLimitSchema,
  newNight: FlagHistoryLimitSchema,
  newFirstHalfNight: FlagHistoryLimitSchema,
  newSecondHalfNight: FlagHistoryLimitSchema
}).partial().default({});

const SeasonFlagHistoryLimitSchema = external_z_namespaceObject.z.object({
  newSpring: FlagHistoryLimitSchema,
  newSummer: FlagHistoryLimitSchema,
  newAutumn: FlagHistoryLimitSchema,
  newWinter: FlagHistoryLimitSchema
}).partial().default({});

const TimeFlagHistoryLimitsSchema = external_z_namespaceObject.z.object({
  newPeriod: FlagHistoryLimitSchema.optional(),
  newDay: FlagHistoryLimitSchema.optional(),
  newWeek: FlagHistoryLimitSchema.optional(),
  newMonth: FlagHistoryLimitSchema.optional(),
  newSeason: FlagHistoryLimitSchema.optional(),
  newYear: FlagHistoryLimitSchema.optional(),
  period: PeriodFlagHistoryLimitSchema.optional(),
  season: SeasonFlagHistoryLimitSchema.optional()
}).default({});

const TimeConfigSchema = external_z_namespaceObject.z.object({
  epochISO: external_z_namespaceObject.z.string().datetime({
    message: "无效的 ISO 8601 日期时间格式"
  }),
  flagHistoryLimits: TimeFlagHistoryLimitsSchema
}).passthrough();

const DEFAULT_TIME_CONFIG = {
  epochISO: "2025-10-24T06:00:00+09:00",
  flagHistoryLimits: {}
};

const AffectionConfigSchema = external_z_namespaceObject.z.object({
  affectionStages: external_z_namespaceObject.z.array(PreprocessStringifiedObject(AffectionStageWithForgetSchema)),
  loveThreshold: external_z_namespaceObject.z.number().optional(),
  hateThreshold: external_z_namespaceObject.z.number().optional()
});

const ConfigSchema = external_z_namespaceObject.z.object({
  affection: AffectionConfigSchema.optional(),
  specials: EntryListPreprocessSchema.default([]),
  routine: EntryListPreprocessSchema.default([]),
  time: TimeConfigSchema.default(DEFAULT_TIME_CONFIG),
  incident: IncidentConfigSchema.optional(),
  ui: UiConfigSchema,
  mainBodyTags: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional(),
  excludeBodyTags: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional()
}).passthrough();

const FestivalDefinitionSchema = external_z_namespaceObject.z.object({
  month: external_z_namespaceObject.z.number(),
  start_day: external_z_namespaceObject.z.number(),
  end_day: external_z_namespaceObject.z.number(),
  name: external_z_namespaceObject.z.string(),
  type: external_z_namespaceObject.z.string(),
  customs: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  importance: external_z_namespaceObject.z.number(),
  host: external_z_namespaceObject.z.string()
});

const festival_FestivalSchema = FestivalDefinitionSchema.extend({
  id: external_z_namespaceObject.z.string().optional()
});

const FestivalsListSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), PreprocessStringifiedObject(FestivalDefinitionSchema)).default({});

const UserSchema = external_z_namespaceObject.z.object({
  姓名: external_z_namespaceObject.z.string().nullable(),
  身份: external_z_namespaceObject.z.string().nullable(),
  性别: external_z_namespaceObject.z.string().nullable(),
  年龄: external_z_namespaceObject.z.string().nullable(),
  特殊能力: external_z_namespaceObject.z.string().nullable(),
  所在地区: external_z_namespaceObject.z.string().nullable(),
  居住地区: external_z_namespaceObject.z.string().nullable(),
  重要经历: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional().nullable(),
  人际关系: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional().nullable()
});

const USER_FIELDS = {
  name: "姓名",
  identity: "身份",
  gender: "性别",
  age: "年龄",
  abilities: "特殊能力",
  currentLocation: "所在地区",
  home: "居住地区",
  events: "重要经历",
  relationships: "人际关系"
};

const StatSchema = external_z_namespaceObject.z.object({
  config: ConfigSchema,
  chars: CharsSchema,
  user: UserSchema,
  world: WorldSchema.optional(),
  time: timeSchema,
  cache: CacheSchema.optional(),
  incidents: IncidentsSchema.default({}),
  festivals_list: FestivalsListSchema,
  附加正文: external_z_namespaceObject.z.string().optional(),
  weather: external_z_namespaceObject.z.string().optional(),
  AyaNews: external_z_namespaceObject.z.string().optional()
});

const PROJECT_NAME = "GSKO-FACE";

const DEBUG_CONFIG_LS_KEY = "gsko_era_debug_config";

let enabledPatterns = [];

let disabledPatterns = [];

function loadDebugConfig() {
  try {
    const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
    const config = JSON.parse(configStr);
    const toRegex = p => new RegExp(`^${p.replace(/\*/g, ".*?")}$`);
    enabledPatterns = (config.enabled || []).map(toRegex);
    disabledPatterns = (config.disabled || []).map(toRegex);
  } catch (e) {
    console.error(`《${PROJECT_NAME}-Log》: 加载调试配置失败。`, e);
    enabledPatterns = [];
    disabledPatterns = [];
  }
}

function isDebugEnabled(moduleName) {
  if (!moduleName) return false;
  if (disabledPatterns.some(re => re.test(moduleName))) {
    return false;
  }
  if (enabledPatterns.length === 0) {
    return false;
  }
  if (enabledPatterns.some(re => re.test(moduleName))) {
    return true;
  }
  return false;
}

function updateConfig(newConfig) {
  const uniqueConfig = {
    enabled: [ ...new Set(newConfig.enabled) ],
    disabled: [ ...new Set(newConfig.disabled) ]
  };
  globalThis.localStorage?.setItem(DEBUG_CONFIG_LS_KEY, JSON.stringify(uniqueConfig));
  loadDebugConfig();
  console.log(`%c《${PROJECT_NAME}-Log》调试模式已更新。`, "color: #3498db; font-weight: bold;", {
    "启用 (Enabled)": uniqueConfig.enabled,
    "禁用 (Disabled)": uniqueConfig.disabled
  });
}

loadDebugConfig();

if (typeof globalThis !== "undefined") {
  const eraDebug = {
    add(pattern) {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      enabled.add(pattern);
      disabled.delete(pattern);
      updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    remove(pattern) {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      disabled.add(pattern);
      enabled.delete(pattern);
      updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    status() {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      console.log(`%c《${PROJECT_NAME}-Log》当前调试配置:`, "color: #3498db; font-weight: bold;", config);
    },
    clear() {
      updateConfig({
        enabled: [],
        disabled: []
      });
    }
  };
  globalThis.eraDebug = eraDebug;
}

const logContext = {
  mk: ""
};

class Logger {
  moduleName;
  constructor(moduleName) {
    this.moduleName = moduleName || this._getModuleNameFromStack() || "unknown";
  }
  _getModuleNameFromStack() {
    try {
      const stack = (new Error).stack || "";
      const callerLine = stack.split("\n").find(line => (line.includes(`/src/${PROJECT_NAME}/`) || line.includes(`/dist/${PROJECT_NAME}/`) || line.includes(`\\src\\${PROJECT_NAME}\\`) || line.includes(`\\dist\\${PROJECT_NAME}\\`)) && !line.includes("/utils/log.ts"));
      if (!callerLine) {
        return null;
      }
      const match = callerLine.match(new RegExp(`(src|dist)[\\\\/]${PROJECT_NAME}[\\\\/]([^?:]+)`));
      if (!match || !match[2]) {
        return null;
      }
      const path = match[2];
      return path.replace(/\\/g, "/").replace(/\.(vue|ts|js)$/, "").replace(/\/index$/, "");
    } catch (e) {
      console.error(`《${PROJECT_NAME}-Log-Debug》: 解析模块名时发生意外错误。`, e);
      return null;
    }
  }
  formatMessage(funcName, message) {
    const mkString = logContext.mk ? `（${logContext.mk}）` : "";
    return `《${PROJECT_NAME}》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;
  }
  debug(funcName, message, obj) {
    if (!isDebugEnabled(this.moduleName)) {
      return;
    }
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.debug(formattedMessage, obj);
    } else {
      console.debug(formattedMessage);
    }
  }
  log(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.log(`%c${formattedMessage}`, "color: #3498db;", obj);
    } else {
      console.log(`%c${formattedMessage}`, "color: #3498db;");
    }
  }
  warn(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;", obj);
    } else {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;");
    }
  }
  error(funcName, message, errorObj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (errorObj !== undefined) {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;", errorObj);
    } else {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;");
    }
  }
}

const logger = new Logger("GSKO-FACE/utils/eraWriter");

function updateEraVariable(path, value) {
  const funcName = "updateEraVariable";
  if (!path || typeof path !== "string") {
    logger.warn(funcName, "调用失败：path 无效。", {
      path
    });
    return;
  }
  const eventData = {
    path,
    value
  };
  try {
    logger.log(funcName, `准备发送 era:updateByPath 事件`, eventData);
    eventEmit("era:updateByPath", eventData);
  } catch (e) {
    logger.error(funcName, "发送 era:updateByPath 事件时出现异常", e);
  }
}

function updateEraVariableByObject(obj) {
  const funcName = "updateEraVariableByObject";
  if (!obj || typeof obj !== "object") {
    logger.warn(funcName, "调用失败：传入的 obj 无效。", {
      obj
    });
    return;
  }
  try {
    logger.log(funcName, `准备发送 era:updateByObject 事件`, obj);
    eventEmit("era:updateByObject", obj);
  } catch (e) {
    logger.error(funcName, "发送 era:updateByObject 事件时出现异常", e);
  }
}

const StyledProgressBarvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StyledProgressBar",
  props: {
    value: {},
    max: {},
    loveThreshold: {},
    hateThreshold: {},
    size: {}
  },
  setup(__props) {
    const props = __props;
    const barWidth = (0, external_Vue_namespaceObject.computed)(() => {
      const max = props.max || 100;
      return `${Math.min(Math.abs(props.value) / max * 100, 100)}%`;
    });
    const barClasses = (0, external_Vue_namespaceObject.computed)(() => {
      const classes = {
        "size-small": props.size === "small",
        "size-large": props.size !== "small",
        rtl: props.value < 0
      };
      if (props.hateThreshold !== undefined && props.value <= props.hateThreshold) {
        classes["very-hate"] = true;
      } else if (props.value < 0) {
        classes["negative"] = true;
      } else if (props.loveThreshold !== undefined && props.value >= props.loveThreshold) {
        classes["very-love"] = true;
      }
      return classes;
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "styled-progress-bar", barClasses.value ])
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "val",
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        width: barWidth.value
      })
    }, null, 4) ], 2));
  }
});

var exportHelper = __webpack_require__(235);

const __exports__ = (0, exportHelper.A)(StyledProgressBarvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-5c2b1dc4" ] ]);

const StyledProgressBar = __exports__;

const _hoisted_1 = {
  class: "affection-display"
};

const _hoisted_2 = {
  class: "info-line"
};

const _hoisted_3 = {
  class: "aff-num"
};

const _hoisted_4 = {
  class: "aff-stage"
};

const AffectionDisplayvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AffectionDisplay",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    },
    size: {
      type: String,
      required: true
    }
  },
  setup(__props) {
    const props = __props;
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionStage = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.runtime || !props.character?.id) return "—";
      return props.runtime.character?.chars[props.character.id]?.affectionStage?.name || "—";
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_2, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "好感度：", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", _hoisted_3, (0, external_Vue_namespaceObject.toDisplayString)(affectionValue.value), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", _hoisted_4, (0, external_Vue_namespaceObject.toDisplayString)(affectionStage.value), 1) ]), (0, 
    external_Vue_namespaceObject.createVNode)(StyledProgressBar, {
      value: affectionValue.value,
      "love-threshold": loveThreshold.value,
      "hate-threshold": hateThreshold.value,
      size: __props.size
    }, null, 8, [ "value", "love-threshold", "hate-threshold", "size" ]) ]));
  }
});

const AffectionDisplay_exports_ = (0, exportHelper.A)(AffectionDisplayvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-72c13fe5" ] ]);

const AffectionDisplay = AffectionDisplay_exports_;

const Particlevue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Particle",
  props: {
    particleType: {},
    dx: {},
    dy: {},
    rot: {},
    delay: {},
    initialX: {},
    initialY: {}
  },
  emits: [ "destroy" ],
  setup(__props, {emit: __emit}) {
    const props = __props;
    const emit = __emit;
    const particleContent = (0, external_Vue_namespaceObject.computed)(() => props.particleType === "skull" ? "☠" : "❤");
    const particleStyle = (0, external_Vue_namespaceObject.computed)(() => ({
      left: `${props.initialX}%`,
      top: `${props.initialY}%`,
      "--dx": `${props.dx}px`,
      "--dy": `${props.dy}px`,
      "--rot": `${props.rot}deg`,
      animationDelay: `${props.delay}s`
    }));
    (0, external_Vue_namespaceObject.onMounted)(() => {
      setTimeout(() => {
        emit("destroy");
      }, 1500);
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("span", {
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "GensokyoOrigin-Particle", `GensokyoOrigin-Particle--${__props.particleType}` ]),
      style: (0, external_Vue_namespaceObject.normalizeStyle)(particleStyle.value)
    }, (0, external_Vue_namespaceObject.toDisplayString)(particleContent.value), 7));
  }
});

const Particle_exports_ = Particlevue_type_script_setup_true_lang_ts;

const Particle = Particle_exports_;

const ParticleEmittervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "particle-emitter-root"
};

const ParticleEmittervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ParticleEmitter",
  props: {
    active: {
      type: Boolean
    },
    particleType: {},
    emissionRate: {}
  },
  setup(__props, {expose: __expose}) {
    const props = __props;
    const particles = (0, external_Vue_namespaceObject.ref)([]);
    let particleIdCounter = 0;
    const ticker = (0, external_Vue_namespaceObject.ref)(null);
    const createParticle = (type, delay = 0) => {
      particleIdCounter++;
      particles.value.push({
        id: particleIdCounter,
        type,
        initialX: 5 + Math.random() * 90,
        initialY: 10 + Math.random() * 80,
        dx: (Math.random() - .5) * 60,
        dy: -40 - Math.random() * 40,
        rot: (Math.random() - .5) * 40,
        delay
      });
    };
    const removeParticle = id => {
      particles.value = particles.value.filter(p => p.id !== id);
    };
    const startTicker = () => {
      if (ticker.value) return;
      const rate = props.emissionRate || 2;
      ticker.value = setInterval(() => {
        createParticle(props.particleType);
      }, 1e3 / rate);
    };
    const stopTicker = () => {
      if (ticker.value) {
        clearInterval(ticker.value);
        ticker.value = null;
      }
    };
    (0, external_Vue_namespaceObject.watch)(() => props.active, isActive => {
      if (isActive) {
        startTicker();
      } else {
        stopTicker();
      }
    }, {
      immediate: true
    });
    const burst = (type, count) => {
      for (let i = 0; i < count; i++) {
        createParticle(type, i * .05);
      }
    };
    (0, external_Vue_namespaceObject.onUnmounted)(() => {
      stopTicker();
    });
    __expose({
      burst
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", ParticleEmittervue_type_script_setup_true_lang_ts_hoisted_1, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(particles.value, p => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(Particle, {
      key: p.id,
      "particle-type": p.type,
      "initial-x": p.initialX,
      "initial-y": p.initialY,
      dx: p.dx,
      dy: p.dy,
      rot: p.rot,
      delay: p.delay,
      onDestroy: $event => removeParticle(p.id)
    }, null, 8, [ "particle-type", "initial-x", "initial-y", "dx", "dy", "rot", "delay", "onDestroy" ]))), 128)) ]));
  }
});

const ParticleEmitter_exports_ = ParticleEmittervue_type_script_setup_true_lang_ts;

const ParticleEmitter = ParticleEmitter_exports_;

async function getMainWorldBookId() {
  try {
    const charWorldbooks = await getCharWorldbookNames("current");
    const mainBookId = charWorldbooks?.primary;
    if (!mainBookId) {
      console.warn("[GSKO-FACE] 当前角色没有设置主世界书。");
      return null;
    }
    return mainBookId;
  } catch (error) {
    console.error("[GSKO-FACE] 获取主世界书ID失败:", error);
    return null;
  }
}

async function saveModuleToWorldBook({module, id, identifier, data}) {
  const mainBookId = await getMainWorldBookId();
  if (!mainBookId) {
    toastr.error("未找到当前角色卡的主世界书，无法保存。");
    throw new Error("主世界书未找到。");
  }
  const currentEntries = await getWorldbook(mainBookId);
  const newEntryKey = `[[${module}]]${id}-${identifier}`;
  const keyRegex = new RegExp(`^\\[\\[${module}\\]\\]${id}-(\\d+)$`);
  const entriesToDisable = currentEntries.filter(entry => keyRegex.test(entry.name));
  if (entriesToDisable.length > 0) {
    await updateWorldbookWith(mainBookId, entries => {
      entriesToDisable.forEach(entryToDisable => {
        const target = entries.find(e => e.uid === entryToDisable.uid);
        if (target) {
          const disabledKey = entryToDisable.name.replace(`[[${module}]]`, `<<${module}>>`);
          target.name = disabledKey;
          target.enabled = false;
          console.log(`[GSKO] 已禁用旧的世界书条目: ${entryToDisable.name} -> ${disabledKey}`);
        }
      });
      return entries;
    });
  }
  const newEntry = {
    name: newEntryKey,
    content: JSON.stringify(data, null, 2),
    enabled: false,
    order: 2e3,
    comment: `由 GSKO-FACE 于 ${(new Date).toISOString()} 自动生成`
  };
  await createWorldbookEntries(mainBookId, [ newEntry ]);
  toastr.success(`设置已保存至世界书条目：\n${newEntryKey}`);
}

const TIME_PERIOD_NAMES = [ "清晨", "上午", "中午", "下午", "黄昏", "夜晚", "上半夜", "下半夜" ];

const constants_TIME_PERIOD_KEYS = [ "newDawn", "newMorning", "newNoon", "newAfternoon", "newDusk", "newNight", "newFirstHalfNight", "newSecondHalfNight" ];

const TIME_SEASON_NAMES = [ "春", "夏", "秋", "冬" ];

const constants_TIME_SEASON_KEYS = [ "newSpring", "newSummer", "newAutumn", "newWinter" ];

const TIME_WEEK_NAMES = [ "周一", "周二", "周三", "周四", "周五", "周六", "周日" ];

const TIME_UNIT_OPTIONS = [ "period", "day", "week", "month", "season", "year" ];

const BASE_FLAG_OPTIONS = [ "newPeriod", "newDay", "newWeek", "newMonth", "newSeason", "newYear" ];

const PERIOD_FLAG_OPTIONS = constants_TIME_PERIOD_KEYS.map(flag => `byPeriod.${flag}`);

const SEASON_FLAG_OPTIONS = constants_TIME_SEASON_KEYS.map(flag => `bySeason.${flag}`);

const FLAG_GROUPS = [ {
  title: "基础时间节点",
  options: BASE_FLAG_OPTIONS
}, {
  title: "时段 Flags",
  options: PERIOD_FLAG_OPTIONS
}, {
  title: "季节 Flags",
  options: SEASON_FLAG_OPTIONS
} ];

const TRIGGER_FLAG_OPTIONS = [ ...BASE_FLAG_OPTIONS, ...PERIOD_FLAG_OPTIONS, ...SEASON_FLAG_OPTIONS ];

const TRIGGER_FLAG_LOOKUP = new Set(TRIGGER_FLAG_OPTIONS);

const KNOWN_FLAG_SET = new Set(TRIGGER_FLAG_OPTIONS);

const isTriggerFlag = flag => TRIGGER_FLAG_LOOKUP.has(flag);

const PERIOD_LABEL_MAP = Object.fromEntries(constants_TIME_PERIOD_KEYS.map((key, idx) => [ `byPeriod.${key}`, `时段·${TIME_PERIOD_NAMES[idx]} (${key})` ]));

const SEASON_LABEL_MAP = Object.fromEntries(constants_TIME_SEASON_KEYS.map((key, idx) => [ `bySeason.${key}`, `季节·${TIME_SEASON_NAMES[idx]} (${key})` ]));

const BASE_FLAG_LABELS = {
  newPeriod: "新时段 (newPeriod)",
  newDay: "新的一天 (newDay)",
  newWeek: "新的一周 (newWeek)",
  newMonth: "新的一月 (newMonth)",
  newSeason: "新季节 (newSeason)",
  newYear: "新年 (newYear)"
};

const formatFlagLabel = flag => PERIOD_LABEL_MAP[flag] || SEASON_LABEL_MAP[flag] || BASE_FLAG_LABELS[flag] || flag;

const BY_NOW_SELECT_FIELDS = [ {
  key: "weekdayName",
  label: "星期",
  options: TIME_WEEK_NAMES
}, {
  key: "periodName",
  label: "时间段",
  options: TIME_PERIOD_NAMES
}, {
  key: "seasonName",
  label: "季节",
  options: TIME_SEASON_NAMES
} ];

const BY_NOW_TEXT_FIELDS = [ {
  key: "iso",
  label: "ISO 字符串",
  placeholder: "2025-01-01T08:00:00Z"
}, {
  key: "hm",
  label: "HH:mm",
  placeholder: "08:00"
} ];

const BY_NOW_NUMERIC_FIELDS = [ {
  key: "year",
  label: "年份"
}, {
  key: "month",
  label: "月份"
}, {
  key: "day",
  label: "日期"
}, {
  key: "hour",
  label: "小时"
}, {
  key: "minute",
  label: "分钟"
}, {
  key: "weekdayIndex",
  label: "星期索引"
}, {
  key: "periodIdx",
  label: "时间段索引"
}, {
  key: "seasonIdx",
  label: "季节索引"
}, {
  key: "minutesSinceMidnight",
  label: "分钟数（当日零点开始算）"
} ];

const KNOWN_BY_NOW_KEY_ARRAY = [ ...BY_NOW_SELECT_FIELDS.map(field => field.key), ...BY_NOW_TEXT_FIELDS.map(field => field.key), ...BY_NOW_NUMERIC_FIELDS.map(field => field.key) ];

const KNOWN_BY_NOW_KEYS = new Set(KNOWN_BY_NOW_KEY_ARRAY);

const NUMERIC_BY_NOW_FIELDS = new Set(BY_NOW_NUMERIC_FIELDS.map(field => field.key));

const isNumericByNowKey = key => NUMERIC_BY_NOW_FIELDS.has(key);

const ACTION_TO_SPECIALS = [ "$HOME", "HERO", "RANDOM" ];

const ACTION_TO_STAY = "__stay__";

const ACTION_TO_CUSTOM = "__custom__";

const CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "GensokyoOrigin-CharacterEntryEditor-container"
};

const CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "GensokyoOrigin-CharacterEntryEditor-grid GensokyoOrigin-CharacterEntryEditor-grid--two"
};

const CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_3 = {
  key: 0
};

const CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "GensokyoOrigin-CharacterEntryEditor-grid GensokyoOrigin-CharacterEntryEditor-grid--two"
};

const _hoisted_5 = [ "value" ];

const _hoisted_6 = [ "value" ];

const _hoisted_7 = [ "value" ];

const _hoisted_8 = [ "value" ];

const _hoisted_9 = {
  class: "GensokyoOrigin-CharacterEntryEditor-details collapsible-section"
};

const _hoisted_10 = {
  class: "GensokyoOrigin-CharacterEntryEditor-conditions-wrapper"
};

const _hoisted_11 = {
  class: "GensokyoOrigin-CharacterEntryEditor-condition-group"
};

const _hoisted_12 = {
  class: "GensokyoOrigin-CharacterEntryEditor-flag-groups"
};

const _hoisted_13 = {
  class: "GensokyoOrigin-CharacterEntryEditor-flag-group__title"
};

const _hoisted_14 = {
  class: "GensokyoOrigin-CharacterEntryEditor-flag-group__options"
};

const _hoisted_15 = [ "checked", "onChange" ];

const _hoisted_16 = {
  key: 0,
  class: "GensokyoOrigin-CharacterEntryEditor-selected-flags"
};

const _hoisted_17 = [ "onClick" ];

const _hoisted_18 = {
  class: "GensokyoOrigin-CharacterEntryEditor-condition-group"
};

const _hoisted_19 = {
  class: "GensokyoOrigin-CharacterEntryEditor-grid GensokyoOrigin-CharacterEntryEditor-grid--two GensokyoOrigin-CharacterEntryEditor-grid--equal"
};

const _hoisted_20 = [ "value", "onChange" ];

const _hoisted_21 = [ "value" ];

const _hoisted_22 = [ "placeholder", "value", "onInput" ];

const _hoisted_23 = [ "value", "onInput" ];

const _hoisted_24 = {
  class: "GensokyoOrigin-CharacterEntryEditor-condition-group"
};

const _hoisted_25 = {
  class: "GensokyoOrigin-CharacterEntryEditor-grid GensokyoOrigin-CharacterEntryEditor-grid--three"
};

const _hoisted_26 = [ "value" ];

const _hoisted_27 = [ "value" ];

const _hoisted_28 = {
  class: "GensokyoOrigin-CharacterEntryEditor-condition-group GensokyoOrigin-CharacterEntryEditor-condition-group--festival"
};

const _hoisted_29 = {
  class: "GensokyoOrigin-CharacterEntryEditor-festival-controls"
};

const _hoisted_30 = {
  class: "GensokyoOrigin-CharacterEntryEditor-festival-label"
};

const _hoisted_31 = [ "value" ];

const _hoisted_32 = [ "disabled" ];

const _hoisted_33 = {
  key: 0,
  class: "GensokyoOrigin-CharacterEntryEditor-selected-flags"
};

const _hoisted_34 = [ "onClick" ];

const CharacterEntryEditorvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CharacterEntryEditor",
  props: {
    entry: {
      type: Object,
      required: true
    },
    legalLocations: {
      type: Array,
      default: () => []
    },
    listKey: {
      type: String,
      required: true
    },
    showPriority: {
      type: Boolean,
      default: false
    },
    festivalOptions: {
      type: Array,
      default: () => []
    }
  },
  setup(__props) {
    const props = __props;
    const entry = (0, external_Vue_namespaceObject.computed)(() => props.entry);
    const locationOptions = (0, external_Vue_namespaceObject.computed)(() => {
      const uniq = Array.from(new Set((props.legalLocations ?? []).filter(Boolean)));
      return uniq.sort((a, b) => a.localeCompare(b, "zh-Hans"));
    });
    const isSpecialDestination = value => ACTION_TO_SPECIALS.includes(value);
    const ensureWhen = () => {
      if (!entry.value.when || typeof entry.value.when !== "object") {
        entry.value.when = {};
      }
      return entry.value.when;
    };
    const hasFlag = flag => Array.isArray(entry.value.when?.byFlag) && entry.value.when.byFlag.includes(flag);
    const toggleFlag = flag => {
      const when = ensureWhen();
      const arr = Array.isArray(when.byFlag) ? when.byFlag : when.byFlag = [];
      const idx = arr.indexOf(flag);
      if (idx >= 0) arr.splice(idx, 1); else arr.push(flag);
    };
    const removeFlag = flag => {
      const when = ensureWhen();
      if (!Array.isArray(when.byFlag)) return;
      when.byFlag = when.byFlag.filter(item => item !== flag);
      if (!when.byFlag.length) delete when.byFlag;
    };
    const setByNowField = (key, rawValue) => {
      const when = ensureWhen();
      const byNow = when.byNow = when.byNow ?? {};
      const value = rawValue.trim();
      if (!value) {
        delete byNow[key];
      } else if (isNumericByNowKey(key)) {
        const numeric = Number(value);
        if (!Number.isNaN(numeric)) byNow[key] = numeric;
      } else {
        byNow[key] = value;
      }
      if (!Object.keys(byNow).length) delete when.byNow;
    };
    const setByMonthDayField = (key, rawValue) => {
      const when = ensureWhen();
      const value = rawValue.trim();
      if (!value) {
        if (when.byMonthDay) {
          delete when.byMonthDay[key];
          if (when.byMonthDay.month == null && when.byMonthDay.day == null) delete when.byMonthDay;
        }
        return;
      }
      const numeric = Number(value);
      if (Number.isNaN(numeric)) return;
      when.byMonthDay = when.byMonthDay ?? {
        month: 1,
        day: 1
      };
      when.byMonthDay[key] = numeric;
    };
    const clearByMonthDay = () => {
      const when = ensureWhen();
      delete when.byMonthDay;
    };
    const selectedFestivals = (0, external_Vue_namespaceObject.computed)(() => {
      const value = entry.value.when?.byFestival;
      if (!value) return [];
      if (value === "ANY") return [ "__ANY__" ];
      if (Array.isArray(value)) return value;
      return [ value ];
    });
    const formatFestivalLabel = value => {
      if (value === "__ANY__") return "浠绘剰鑺傛棩";
      const option = props.festivalOptions.find(opt => opt.value === value);
      return option ? option.label : value;
    };
    const festivalToAdd = (0, external_Vue_namespaceObject.ref)("");
    const addFestival = () => {
      const value = festivalToAdd.value;
      if (!value) return;
      const when = ensureWhen();
      const current = when.byFestival;
      if (value === "__ANY__") {
        when.byFestival = "ANY";
      } else if (current === "ANY") {
        when.byFestival = [ value ];
      } else if (Array.isArray(current)) {
        if (!current.includes(value)) current.push(value);
      } else if (typeof current === "string") {
        if (current !== value) when.byFestival = [ current, value ];
      } else {
        when.byFestival = [ value ];
      }
      festivalToAdd.value = "";
    };
    const removeFestival = festival => {
      const when = ensureWhen();
      const current = when.byFestival;
      if (festival === "__ANY__" && current === "ANY") {
        delete when.byFestival;
        return;
      }
      if (Array.isArray(current)) {
        const next = current.filter(item => item !== festival);
        if (next.length === 0) delete when.byFestival; else if (next.length === 1) when.byFestival = next[0]; else when.byFestival = next;
      } else if (typeof current === "string" && current === festival) {
        delete when.byFestival;
      }
    };
    const actionToSelection = (0, external_Vue_namespaceObject.computed)(() => {
      const toValue = entry.value.action.to;
      if (!toValue) return ACTION_TO_STAY;
      if (isSpecialDestination(toValue)) return toValue;
      if (locationOptions.value.includes(toValue)) return toValue;
      return ACTION_TO_STAY;
    });
    const selectActionTo = value => {
      if (value === ACTION_TO_STAY) {
        delete entry.value.action.to;
        return;
      }
      entry.value.action.to = value;
    };
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[6] || (_cache[6] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "行动描述 (do)", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => entry.value.action.do = $event),
      type: "text"
    }, null, 512), [ [ external_Vue_namespaceObject.vModelText, entry.value.action.do ] ]) ]), __props.showPriority ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("label", CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_3, [ _cache[7] || (_cache[7] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "优先级", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => entry.value.priority = $event),
      type: "number"
    }, null, 512), [ [ external_Vue_namespaceObject.vModelText, entry.value.priority, void 0, {
      number: true
    } ] ]) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CharacterEntryEditorvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[9] || (_cache[9] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "目的地 (to)", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("select", {
      value: actionToSelection.value,
      onChange: _cache[2] || (_cache[2] = $event => selectActionTo($event.target.value))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: (0, external_Vue_namespaceObject.unref)(ACTION_TO_STAY)
    }, "保持所在地区", 8, _hoisted_6), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(ACTION_TO_SPECIALS), opt => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: `entry-${opt}`,
      value: opt
    }, (0, external_Vue_namespaceObject.toDisplayString)(opt), 9, _hoisted_7))), 128)), _cache[8] || (_cache[8] = (0, 
    external_Vue_namespaceObject.createElementVNode)("option", {
      disabled: ""
    }, "────────", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(locationOptions.value, loc => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: `loc-${loc}`,
      value: loc
    }, (0, external_Vue_namespaceObject.toDisplayString)(loc), 9, _hoisted_8))), 128)) ], 40, _hoisted_5) ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("details", _hoisted_9, [ _cache[18] || (_cache[18] = (0, 
    external_Vue_namespaceObject.createElementVNode)("summary", null, "触发条件", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_10, [ (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_11, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_12, [ ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(FLAG_GROUPS), group => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: group.title,
      class: "GensokyoOrigin-CharacterEntryEditor-flag-group"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_13, (0, 
    external_Vue_namespaceObject.toDisplayString)(group.title), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_14, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(group.options, flag => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("label", {
      key: flag
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("input", {
      type: "checkbox",
      checked: hasFlag(flag),
      onChange: $event => toggleFlag(flag)
    }, null, 40, _hoisted_15), (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, 
    external_Vue_namespaceObject.toDisplayString)((0, external_Vue_namespaceObject.unref)(formatFlagLabel)(flag)), 1) ]))), 128)) ]) ]))), 128)) ]), entry.value.when?.byFlag?.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_16, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(entry.value.when.byFlag, flag => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("span", {
      key: flag,
      class: "GensokyoOrigin-CharacterEntryEditor-selected-flag"
    }, [ (0, external_Vue_namespaceObject.createTextVNode)((0, external_Vue_namespaceObject.toDisplayString)((0, 
    external_Vue_namespaceObject.unref)(formatFlagLabel)(flag)) + " ", 1), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      onClick: $event => removeFlag(flag)
    }, "×", 8, _hoisted_17) ]))), 128)) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_18, [ (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_19, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(BY_NOW_SELECT_FIELDS), field => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("label", {
      key: field.key
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, external_Vue_namespaceObject.toDisplayString)(field.label), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("select", {
      value: entry.value.when?.byNow?.[field.key] ?? "",
      onChange: $event => setByNowField(field.key, $event.target.value || "")
    }, [ _cache[10] || (_cache[10] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: ""
    }, "—", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(field.options, option => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: `select-${field.key}-${option}`,
      value: option
    }, (0, external_Vue_namespaceObject.toDisplayString)(option), 9, _hoisted_21))), 128)) ], 40, _hoisted_20) ]))), 128)), ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(BY_NOW_TEXT_FIELDS), field => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("label", {
      key: field.key
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, external_Vue_namespaceObject.toDisplayString)(field.label), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("input", {
      type: "text",
      placeholder: field.placeholder,
      value: entry.value.when?.byNow?.[field.key] ?? "",
      onInput: $event => setByNowField(field.key, $event.target.value)
    }, null, 40, _hoisted_22) ]))), 128)), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(BY_NOW_NUMERIC_FIELDS), field => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("label", {
      key: field.key
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, external_Vue_namespaceObject.toDisplayString)(field.label), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("input", {
      type: "number",
      value: entry.value.when?.byNow?.[field.key] ?? "",
      onInput: $event => setByNowField(field.key, $event.target.value)
    }, null, 40, _hoisted_23) ]))), 128)) ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_24, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_25, [ (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[11] || (_cache[11] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "指定月份", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("input", {
      type: "number",
      min: "1",
      max: "12",
      value: entry.value.when?.byMonthDay?.month ?? "",
      onInput: _cache[3] || (_cache[3] = $event => setByMonthDayField("month", $event.target.value))
    }, null, 40, _hoisted_26) ]), (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[12] || (_cache[12] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "指定日期", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("input", {
      type: "number",
      min: "1",
      max: "31",
      value: entry.value.when?.byMonthDay?.day ?? "",
      onInput: _cache[4] || (_cache[4] = $event => setByMonthDayField("day", $event.target.value))
    }, null, 40, _hoisted_27) ]), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--small",
      onClick: clearByMonthDay
    }, "清空") ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_28, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_29, [ (0, external_Vue_namespaceObject.createElementVNode)("label", _hoisted_30, [ _cache[16] || (_cache[16] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "节日限定", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("select", {
      "onUpdate:modelValue": _cache[5] || (_cache[5] = $event => festivalToAdd.value = $event)
    }, [ _cache[13] || (_cache[13] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: "",
      disabled: ""
    }, "选择一个节日", -1)), _cache[14] || (_cache[14] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: "__ANY__"
    }, "任意节日", -1)), _cache[15] || (_cache[15] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      disabled: ""
    }, "────────", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(__props.festivalOptions, option => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: option.value,
      value: option.value
    }, (0, external_Vue_namespaceObject.toDisplayString)(option.label), 9, _hoisted_31))), 128)) ], 512), [ [ external_Vue_namespaceObject.vModelSelect, festivalToAdd.value ] ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--small",
      disabled: !festivalToAdd.value,
      onClick: addFestival
    }, " 添加 ", 8, _hoisted_32) ]), selectedFestivals.value.length ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_33, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(selectedFestivals.value, festival => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("span", {
      key: festival,
      class: "GensokyoOrigin-CharacterEntryEditor-selected-flag"
    }, [ (0, external_Vue_namespaceObject.createTextVNode)((0, external_Vue_namespaceObject.toDisplayString)(formatFestivalLabel(festival)) + " ", 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      onClick: $event => removeFestival(festival)
    }, "×", 8, _hoisted_34) ]))), 128)) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true), _cache[17] || (_cache[17] = (0, 
    external_Vue_namespaceObject.createElementVNode)("p", {
      class: "GensokyoOrigin-CharacterEntryEditor-hint"
    }, "不选择则代表不限定节日。", -1)) ]) ]) ]) ]));
  }
});

const CharacterEntryEditor_exports_ = CharacterEntryEditorvue_type_script_setup_true_lang_ts;

const CharacterEntryEditor = CharacterEntryEditor_exports_;

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_1 = {
  key: 0,
  class: "role-settings-modal"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "role-settings-modal__panel",
  role: "dialog",
  "aria-modal": "true"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "role-settings-modal__header"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_4 = {
  key: 0,
  class: "role-settings-modal__subtitle"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_5 = {
  key: 1,
  class: "role-settings-modal__subtitle"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_6 = {
  key: 0,
  class: "role-settings-modal__body"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "role-settings-modal__section"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "form-grid form-grid--two"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_9 = [ "value" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_10 = {
  class: "role-settings-modal__section collapsible-section"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_11 = {
  class: "section-heading"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_12 = {
  key: 0,
  class: "empty-hint"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_13 = {
  class: "card__header"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_14 = [ "onClick" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_15 = {
  class: "form-grid form-grid--two"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_16 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_17 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_18 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_19 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_20 = [ "value" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_21 = {
  class: "sub-card collapsible-section"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_22 = {
  class: "sub-card__header"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_23 = [ "checked", "onChange" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_24 = {
  key: 0,
  class: "form-grid form-grid--two form-grid--equal"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_25 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_26 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_27 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_28 = [ "onUpdate:modelValue" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_29 = [ "value" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_30 = {
  class: "sub-card collapsible-section"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_31 = {
  class: "sub-card__header"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_32 = [ "onClick" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_33 = {
  key: 0,
  class: "empty-hint"
};

const CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_34 = [ "value", "onChange" ];

const _hoisted_35 = [ "value" ];

const _hoisted_36 = [ "onUpdate:modelValue" ];

const _hoisted_37 = [ "onClick" ];

const _hoisted_38 = {
  class: "sub-card collapsible-section"
};

const _hoisted_39 = {
  class: "sub-card__header"
};

const _hoisted_40 = [ "checked", "onChange" ];

const _hoisted_41 = {
  key: 0,
  class: "form-grid form-grid--two form-grid--equal"
};

const _hoisted_42 = [ "onUpdate:modelValue" ];

const _hoisted_43 = [ "onUpdate:modelValue" ];

const _hoisted_44 = {
  class: "role-settings-modal__section collapsible-section"
};

const _hoisted_45 = {
  class: "section-heading"
};

const _hoisted_46 = {
  key: 0,
  class: "empty-hint"
};

const _hoisted_47 = {
  class: "card__header"
};

const _hoisted_48 = [ "onClick" ];

const _hoisted_49 = {
  class: "role-settings-modal__section collapsible-section"
};

const _hoisted_50 = {
  class: "section-heading"
};

const _hoisted_51 = {
  key: 0,
  class: "empty-hint"
};

const _hoisted_52 = {
  class: "card__header"
};

const _hoisted_53 = [ "onClick" ];

const _hoisted_54 = {
  key: 1,
  class: "role-settings-modal__empty"
};

const _hoisted_55 = {
  class: "role-settings-modal__footer"
};

const _hoisted_56 = [ "disabled" ];

const _hoisted_57 = [ "disabled" ];

const CharacterSettingsModalvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CharacterSettingsModal",
  props: {
    open: {
      type: Boolean,
      default: false
    },
    settings: {
      type: Object,
      default: null
    },
    legalLocations: {
      type: Array,
      default: () => []
    },
    stat: {
      type: Object,
      default: null
    }
  },
  emits: [ "close", "save" ],
  setup(__props, {emit: __emit}) {
    const props = __props;
    const emit = __emit;
    const editableSettings = (0, external_Vue_namespaceObject.ref)(null);
    (0, external_Vue_namespaceObject.watch)(() => props.open, open => {
      if (open) {
        editableSettings.value = props.settings ? JSON.parse(JSON.stringify(props.settings)) : null;
      }
    });
    (0, external_Vue_namespaceObject.watch)(() => props.settings, newSettings => {
      if (props.open) {
        editableSettings.value = newSettings ? JSON.parse(JSON.stringify(newSettings)) : null;
      }
    });
    const legalLocationOptions = (0, external_Vue_namespaceObject.computed)(() => {
      const uniq = Array.from(new Set((props.legalLocations ?? []).filter(Boolean)));
      return uniq.sort((a, b) => a.localeCompare(b, "zh-Hans"));
    });
    const festivalOptions = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.stat?.festivals_list) return [];
      return Object.entries(props.stat.festivals_list).map(([key, festival]) => ({
        value: key,
        label: `${festival.name} (${key})`
      }));
    });
    const addAffectionStage = () => {
      if (!editableSettings.value) return;
      editableSettings.value.affectionStages.push({
        threshold: 0,
        name: "未命名阶段",
        describe: ""
      });
    };
    const removeAffectionStage = index => {
      editableSettings.value?.affectionStages.splice(index, 1);
    };
    const toggleVisit = (stage, enabled) => {
      if (enabled) {
        stage.visit = stage.visit ?? {
          enabled: true,
          probBase: 0,
          probK: 0,
          coolUnit: "day"
        };
      } else {
        delete stage.visit;
      }
    };
    const addForgettingRule = stage => {
      if (!stage.forgettingSpeed) stage.forgettingSpeed = [];
      stage.forgettingSpeed.push({
        triggerFlag: "newDay",
        decrease: 1
      });
    };
    const removeForgettingRule = (stage, index) => {
      stage.forgettingSpeed?.splice(index, 1);
      if (!stage.forgettingSpeed?.length) delete stage.forgettingSpeed;
    };
    const toggleGrowthLimit = (stage, enabled) => {
      if (enabled) {
        stage.affectionGrowthLimit = stage.affectionGrowthLimit ?? {
          max: 5,
          divisor: 2
        };
      } else {
        delete stage.affectionGrowthLimit;
      }
    };
    const handleTriggerFlagSelect = (rule, value) => {
      rule.triggerFlag = value;
    };
    const addEntry = list => {
      if (!editableSettings.value) return;
      editableSettings.value[list].push({
        when: {},
        action: {
          do: ""
        }
      });
    };
    const removeEntry = (list, index) => {
      editableSettings.value?.[list].splice(index, 1);
    };
    const ensureWhen = entry => {
      if (!entry.when || typeof entry.when !== "object") entry.when = {};
      return entry.when;
    };
    const sanitizeEntry = entry => {
      const sanitized = {
        when: {},
        action: {
          do: entry.action.do?.trim() || ""
        }
      };
      if (entry.action.to && entry.action.to.trim()) sanitized.action.to = entry.action.to.trim();
      if (entry.action.from && entry.action.from.trim()) sanitized.action.from = entry.action.from.trim();
      if (entry.action.source && entry.action.source.trim()) sanitized.action.source = entry.action.source.trim();
      const when = ensureWhen(entry);
      if (when.byFlag?.length) sanitized.when.byFlag = Array.from(new Set(when.byFlag.filter(Boolean)));
      if (when.byNow) {
        const filtered = {};
        Object.entries(when.byNow).forEach(([key, value]) => {
          if (value === "" || value == null) return;
          filtered[key] = value;
        });
        if (Object.keys(filtered).length) sanitized.when.byNow = filtered;
      }
      if (when.byMonthDay && (when.byMonthDay.month != null || when.byMonthDay.day != null)) {
        sanitized.when.byMonthDay = {
          ...when.byMonthDay
        };
      }
      if (when.byFestival) {
        if (when.byFestival === "ANY") sanitized.when.byFestival = "ANY"; else if (Array.isArray(when.byFestival)) {
          const list = when.byFestival.map(item => item.trim()).filter(Boolean);
          if (list.length) sanitized.when.byFestival = list;
        } else if (typeof when.byFestival === "string") {
          const value = when.byFestival.trim();
          if (value) sanitized.when.byFestival = value;
        }
      }
      if (Object.keys(sanitized.when).length === 0) sanitized.when = {};
      if (typeof entry.priority === "number" && !Number.isNaN(entry.priority)) {
        sanitized.priority = entry.priority;
      }
      return sanitized;
    };
    const sanitizeStage = stage => {
      const next = {
        threshold: Number(stage.threshold) || 0,
        name: stage.name?.trim() || "未命名阶段",
        describe: stage.describe?.toString().trim() || undefined
      };
      if (stage.patienceUnit) next.patienceUnit = stage.patienceUnit;
      if (stage.visit) {
        next.visit = {
          enabled: stage.visit.enabled ?? true,
          probBase: stage.visit.probBase,
          probK: stage.visit.probK,
          coolUnit: stage.visit.coolUnit
        };
      }
      if (stage.forgettingSpeed?.length) {
        next.forgettingSpeed = stage.forgettingSpeed.filter(rule => rule.triggerFlag && rule.decrease != null).map(rule => ({
          triggerFlag: rule.triggerFlag.trim(),
          decrease: Number(rule.decrease) || 0
        })).filter(rule => rule.triggerFlag);
      }
      if (next.forgettingSpeed && !next.forgettingSpeed.length) delete next.forgettingSpeed;
      if (stage.affectionGrowthLimit) {
        const max = Number(stage.affectionGrowthLimit.max);
        const divisor = Number(stage.affectionGrowthLimit.divisor);
        if (!Number.isNaN(max) && !Number.isNaN(divisor)) next.affectionGrowthLimit = {
          max,
          divisor
        };
      }
      return next;
    };
    const sanitizeSettings = settings => ({
      ...settings,
      name: settings.name?.trim() || settings.name || settings.id,
      affectionStages: settings.affectionStages.map(sanitizeStage),
      specials: settings.specials.map(sanitizeEntry),
      routine: settings.routine.map(sanitizeEntry)
    });
    const handleSave = async () => {
      if (!editableSettings.value) return;
      try {
        const sanitized = sanitizeSettings(editableSettings.value);
        const {id, ...dataWithoutId} = sanitized;
        const payload = {
          [id]: dataWithoutId
        };
        await saveModuleToWorldBook({
          module: "chars",
          id,
          identifier: Date.now(),
          data: payload
        });
      } catch (error) {
        console.error("[GSKO-FACE] 保存到世界书失败:", error);
        toastr.error("保存到世界书失败，请检查控制台获取详细信息。");
      }
    };
    const exportSettings = () => {
      if (!editableSettings.value) return;
      const sanitized = sanitizeSettings(editableSettings.value);
      const {id, ...dataWithoutId} = sanitized;
      const payload = {
        [id]: dataWithoutId
      };
      const blob = new Blob([ JSON.stringify(payload, null, 2) ], {
        type: "application/json"
      });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = `${id || "character-settings"}.json`;
      link.click();
      URL.revokeObjectURL(url);
    };
    const emitClose = () => emit("close");
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(external_Vue_namespaceObject.Teleport, {
      to: "body"
    }, [ __props.open ? ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-settings-modal__backdrop",
      onClick: emitClose
    }), (0, external_Vue_namespaceObject.createElementVNode)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("header", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ _cache[5] || (_cache[5] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h2", null, "角色设定", -1)), editableSettings.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("p", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_4, "ID：" + (0, 
    external_Vue_namespaceObject.toDisplayString)(editableSettings.value.id), 1)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("p", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_5, "runtime.characterSettings 中没有该角色的镜像。")) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "role-settings-modal__close",
      "aria-label": "关闭",
      onClick: emitClose
    }, "×") ]), editableSettings.value ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("section", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_7, [ _cache[8] || (_cache[8] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h3", null, "基础信息", -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_8, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[6] || (_cache[6] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "角色 ID", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("input", {
      type: "text",
      value: editableSettings.value.id,
      disabled: ""
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_9) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[7] || (_cache[7] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "角色名称", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => editableSettings.value.name = $event),
      type: "text"
    }, null, 512), [ [ external_Vue_namespaceObject.vModelText, editableSettings.value.name ] ]) ]) ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("details", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_10, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("summary", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_11, [ _cache[9] || (_cache[9] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h3", null, "好感阶段", -1)), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn",
      onClick: (0, external_Vue_namespaceObject.withModifiers)(addAffectionStage, [ "prevent" ])
    }, "新增阶段") ]), !editableSettings.value.affectionStages.length ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("p", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_12, "暂无阶段。")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(editableSettings.value.affectionStages, (stage, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("details", {
      key: `stage-${index}`,
      class: "card collapsible-section"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("summary", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_13, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, external_Vue_namespaceObject.createElementVNode)("h4", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(stage.name || `阶段 ${index + 1}`), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("small", null, "阈值 " + (0, external_Vue_namespaceObject.toDisplayString)(stage.threshold), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--danger",
      onClick: (0, external_Vue_namespaceObject.withModifiers)($event => removeAffectionStage(index), [ "prevent" ])
    }, " 移除 ", 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_14) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_15, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[10] || (_cache[10] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "阶段名称", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.name = $event,
      type: "text"
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_16), [ [ external_Vue_namespaceObject.vModelText, stage.name ] ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[11] || (_cache[11] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "触发阈值", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.threshold = $event,
      type: "number"
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_17), [ [ external_Vue_namespaceObject.vModelText, stage.threshold, void 0, {
      number: true
    } ] ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[12] || (_cache[12] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "阶段描述", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("textarea", {
      "onUpdate:modelValue": $event => stage.describe = $event,
      rows: "2"
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_18), [ [ external_Vue_namespaceObject.vModelText, stage.describe ] ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[14] || (_cache[14] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "耐心单位", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("select", {
      "onUpdate:modelValue": $event => stage.patienceUnit = $event
    }, [ _cache[13] || (_cache[13] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: ""
    }, "—", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(TIME_UNIT_OPTIONS), unit => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: unit,
      value: unit
    }, (0, external_Vue_namespaceObject.toDisplayString)(unit), 9, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_20))), 128)) ], 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_19), [ [ external_Vue_namespaceObject.vModelSelect, stage.patienceUnit ] ]) ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("details", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_21, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("summary", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_22, [ _cache[16] || (_cache[16] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h5", null, "拜访规则", -1)), (0, external_Vue_namespaceObject.createElementVNode)("label", {
      class: "toggle",
      onClick: _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.withModifiers)(() => {}, [ "prevent" ]))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("input", {
      type: "checkbox",
      checked: Boolean(stage.visit),
      onChange: $event => toggleVisit(stage, $event.target.checked)
    }, null, 40, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_23), _cache[15] || (_cache[15] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "启用", -1)) ]) ]), stage.visit ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_24, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[18] || (_cache[18] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "是否尝试拜访", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("select", {
      "onUpdate:modelValue": $event => stage.visit.enabled = $event
    }, [ ..._cache[17] || (_cache[17] = [ (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: true
    }, "会来访", -1), (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: false
    }, "不会来访", -1) ]) ], 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_25), [ [ external_Vue_namespaceObject.vModelSelect, stage.visit.enabled ] ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[19] || (_cache[19] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "基础概率 (0-1)", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.visit.probBase = $event,
      type: "number",
      step: "0.01",
      min: "0",
      max: "1"
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_26), [ [ external_Vue_namespaceObject.vModelText, stage.visit.probBase, void 0, {
      number: true
    } ] ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[20] || (_cache[20] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "好感影响系数", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.visit.probK = $event,
      type: "number",
      step: "0.001"
    }, null, 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_27), [ [ external_Vue_namespaceObject.vModelText, stage.visit.probK, void 0, {
      number: true
    } ] ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[22] || (_cache[22] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "冷却单位", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("select", {
      "onUpdate:modelValue": $event => stage.visit.coolUnit = $event
    }, [ _cache[21] || (_cache[21] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: ""
    }, "—", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(TIME_UNIT_OPTIONS), unit => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: unit,
      value: unit
    }, (0, external_Vue_namespaceObject.toDisplayString)(unit), 9, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_29))), 128)) ], 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_28), [ [ external_Vue_namespaceObject.vModelSelect, stage.visit.coolUnit ] ]) ]) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]), (0, external_Vue_namespaceObject.createElementVNode)("details", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_30, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("summary", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_31, [ _cache[23] || (_cache[23] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h5", null, "遗忘速度", -1)), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--small",
      onClick: (0, external_Vue_namespaceObject.withModifiers)($event => addForgettingRule(stage), [ "prevent" ])
    }, " 新增规则 ", 8, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_32) ]), !stage.forgettingSpeed?.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("p", CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_33, "暂无遗忘规则。")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(stage.forgettingSpeed, (rule, ruleIndex) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: `rule-${index}-${ruleIndex}`,
      class: "rule-row"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[25] || (_cache[25] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "触发 Flag", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("select", {
      value: rule.triggerFlag,
      onChange: $event => handleTriggerFlagSelect(rule, $event.target.value)
    }, [ _cache[24] || (_cache[24] = (0, external_Vue_namespaceObject.createElementVNode)("option", {
      value: ""
    }, "—", -1)), ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(TRIGGER_FLAG_OPTIONS), flag => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("option", {
      key: flag,
      value: flag
    }, (0, external_Vue_namespaceObject.toDisplayString)((0, external_Vue_namespaceObject.unref)(formatFlagLabel)(flag)), 9, _hoisted_35))), 128)) ], 40, CharacterSettingsModalvue_type_script_setup_true_lang_ts_hoisted_34) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[26] || (_cache[26] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "减少值", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => rule.decrease = $event,
      type: "number"
    }, null, 8, _hoisted_36), [ [ external_Vue_namespaceObject.vModelText, rule.decrease, void 0, {
      number: true
    } ] ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--danger ghost-btn--small",
      onClick: $event => removeForgettingRule(stage, ruleIndex)
    }, " 删除 ", 8, _hoisted_37) ]))), 128)) ]), (0, external_Vue_namespaceObject.createElementVNode)("details", _hoisted_38, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("summary", _hoisted_39, [ _cache[28] || (_cache[28] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h5", null, "好感增长上限", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("label", {
      class: "toggle",
      onClick: _cache[2] || (_cache[2] = (0, external_Vue_namespaceObject.withModifiers)(() => {}, [ "prevent" ]))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("input", {
      type: "checkbox",
      checked: Boolean(stage.affectionGrowthLimit),
      onChange: $event => toggleGrowthLimit(stage, $event.target.checked)
    }, null, 40, _hoisted_40), _cache[27] || (_cache[27] = (0, external_Vue_namespaceObject.createElementVNode)("span", null, "启用", -1)) ]) ]), stage.affectionGrowthLimit ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_41, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[29] || (_cache[29] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "软上限", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.affectionGrowthLimit.max = $event,
      type: "number"
    }, null, 8, _hoisted_42), [ [ external_Vue_namespaceObject.vModelText, stage.affectionGrowthLimit.max, void 0, {
      number: true
    } ] ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("label", null, [ _cache[30] || (_cache[30] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "超额除数", -1)), (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      "onUpdate:modelValue": $event => stage.affectionGrowthLimit.divisor = $event,
      type: "number"
    }, null, 8, _hoisted_43), [ [ external_Vue_namespaceObject.vModelText, stage.affectionGrowthLimit.divisor, void 0, {
      number: true
    } ] ]) ]) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]) ]))), 128)) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("details", _hoisted_44, [ (0, external_Vue_namespaceObject.createElementVNode)("summary", _hoisted_45, [ _cache[31] || (_cache[31] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h3", null, "特殊行动 (specials)", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn",
      onClick: _cache[3] || (_cache[3] = (0, external_Vue_namespaceObject.withModifiers)($event => addEntry("specials"), [ "prevent" ]))
    }, "新增特殊行动") ]), !editableSettings.value.specials.length ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("p", _hoisted_46, "暂无特殊行动。")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(editableSettings.value.specials, (entry, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("details", {
      key: `special-${index}`,
      class: "card collapsible-section"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("summary", _hoisted_47, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, (0, external_Vue_namespaceObject.toDisplayString)(entry.action.do || `特殊行动 ${index + 1}`), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--danger",
      onClick: (0, external_Vue_namespaceObject.withModifiers)($event => removeEntry("specials", index), [ "prevent" ])
    }, " 移除 ", 8, _hoisted_48) ]), (0, external_Vue_namespaceObject.createVNode)(CharacterEntryEditor, {
      entry,
      "legal-locations": legalLocationOptions.value,
      "festival-options": festivalOptions.value,
      "list-key": `specials-${index}`,
      "show-priority": ""
    }, null, 8, [ "entry", "legal-locations", "festival-options", "list-key" ]) ]))), 128)) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("details", _hoisted_49, [ (0, external_Vue_namespaceObject.createElementVNode)("summary", _hoisted_50, [ _cache[32] || (_cache[32] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h3", null, "日常行动 (routine)", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn",
      onClick: _cache[4] || (_cache[4] = (0, external_Vue_namespaceObject.withModifiers)($event => addEntry("routine"), [ "prevent" ]))
    }, "新增日常行动") ]), !editableSettings.value.routine.length ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("p", _hoisted_51, "暂无日常行动。")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(editableSettings.value.routine, (entry, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("details", {
      key: `routine-${index}`,
      class: "card collapsible-section"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("summary", _hoisted_52, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, (0, external_Vue_namespaceObject.toDisplayString)(entry.action.do || `日常行动 ${index + 1}`), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn ghost-btn--danger",
      onClick: (0, external_Vue_namespaceObject.withModifiers)($event => removeEntry("routine", index), [ "prevent" ])
    }, " 移除 ", 8, _hoisted_53) ]), (0, external_Vue_namespaceObject.createVNode)(CharacterEntryEditor, {
      entry,
      "legal-locations": legalLocationOptions.value,
      "festival-options": festivalOptions.value,
      "list-key": `routine-${index}`
    }, null, 8, [ "entry", "legal-locations", "festival-options", "list-key" ]) ]))), 128)) ]) ])) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_54, [ ..._cache[33] || (_cache[33] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("p", null, "runtime.characterSettings 中未找到该角色数据。", -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("p", {
      class: "empty-hint"
    }, "保存或导出功能不可用。", -1) ]) ])), (0, external_Vue_namespaceObject.createElementVNode)("footer", _hoisted_55, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn",
      disabled: !editableSettings.value,
      onClick: exportSettings
    }, " 导出 JSON ", 8, _hoisted_56), _cache[34] || (_cache[34] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "footer-spacer"
    }, null, -1)), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "ghost-btn",
      onClick: emitClose
    }, "取消"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      type: "button",
      class: "primary-btn",
      disabled: !editableSettings.value,
      onClick: handleSave
    }, "保存", 8, _hoisted_57) ]) ]) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const CharacterSettingsModal_exports_ = (0, exportHelper.A)(CharacterSettingsModalvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-5aa4d780" ] ]);

const CharacterSettingsModal = CharacterSettingsModal_exports_;

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "GensokyoOrigin-RoleDetailPopup-popup"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "GensokyoOrigin-RoleDetailPopup-portrait-section"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_3 = [ "src", "alt" ];

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_4 = {
  key: 1,
  class: "GensokyoOrigin-RoleDetailPopup-portrait-placeholder"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "GensokyoOrigin-RoleDetailPopup-content-section"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "GensokyoOrigin-RoleDetailPopup-header"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "GensokyoOrigin-RoleDetailPopup-name"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "GensokyoOrigin-RoleDetailPopup-meta"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_9 = {
  class: "GensokyoOrigin-RoleDetailPopup-details-grid"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_10 = {
  class: "GensokyoOrigin-RoleDetailPopup-detail-item"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_11 = {
  class: "GensokyoOrigin-RoleDetailPopup-detail-item full-width"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_12 = {
  key: 0,
  class: "GensokyoOrigin-RoleDetailPopup-section"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_13 = {
  class: "GensokyoOrigin-RoleDetailPopup-section-title"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_14 = {
  class: "GensokyoOrigin-RoleDetailPopup-section-desc"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_15 = {
  class: "GensokyoOrigin-RoleDetailPopup-details-grid"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_16 = {
  class: "GensokyoOrigin-RoleDetailPopup-detail-item"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_17 = {
  key: 0,
  class: "GensokyoOrigin-RoleDetailPopup-detail-item"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_18 = {
  key: 1,
  class: "GensokyoOrigin-RoleDetailPopup-detail-item full-width"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_19 = {
  key: 2,
  class: "GensokyoOrigin-RoleDetailPopup-detail-item full-width"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_20 = {
  class: "role-detail-popup-actions"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_21 = [ "disabled" ];

const RoleDetailPopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleDetailPopup",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    }
  },
  emits: [ "close" ],
  setup(__props) {
    const props = __props;
    const particleEmitter = (0, external_Vue_namespaceObject.ref)(null);
    const showSettingsModal = (0, external_Vue_namespaceObject.ref)(false);
    const charRuntimeData = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.runtime?.character?.chars || !props.character.id) return null;
      return props.runtime.character.chars[props.character.id];
    });
    const affectionStageInfo = (0, external_Vue_namespaceObject.computed)(() => charRuntimeData.value?.affectionStage);
    const characterSettings = (0, external_Vue_namespaceObject.computed)(() => props.runtime?.characterSettings?.[props.character.id] ?? null);
    const legalLocations = (0, external_Vue_namespaceObject.computed)(() => {
      const locations = props.runtime?.area?.legal_locations ?? [];
      const names = locations.map(loc => loc.name).filter(Boolean);
      return Array.from(new Set(names)).sort((a, b) => a.localeCompare(b, "zh-Hans"));
    });
    const decisionText = (0, external_Vue_namespaceObject.computed)(() => {
      const decision = charRuntimeData.value?.decision;
      const companionDecision = charRuntimeData.value?.companionDecision;
      if (decision) {
        let text = `正在 ${toText(decision.do)}`;
        if (decision.to) text += ` 前往 ${toText(decision.to)}`;
        if (decision.from) text += ` (从 ${toText(decision.from)} 出发)`;
        return text;
      }
      if (companionDecision) {
        return `原本计划 ${toText(companionDecision.do)}, 但因与你同行而暂缓。`;
      }
      return "—";
    });
    const toText = v => {
      if (Array.isArray(v)) return v.length ? v.join("；") : "—";
      if (v == null || v === "") return "—";
      return String(v);
    };
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionState = (0, external_Vue_namespaceObject.computed)(() => {
      if (affectionValue.value >= loveThreshold.value) return "love";
      if (affectionValue.value <= hateThreshold.value) return "hate";
      return "neutral";
    });
    const openSettingsModal = () => {
      if (!characterSettings.value) {
        if (typeof toastr !== "undefined") toastr.warning("runtime 中暂未找到该角色的设定镜像");
        return;
      }
      showSettingsModal.value = true;
    };
    const closeSettingsModal = () => {
      showSettingsModal.value = false;
    };
    const handleRoleSettingsSave = payload => {
      try {
        updateEraVariable(`runtime.characterSettings.${payload.id}`, payload);
        showSettingsModal.value = false;
        if (typeof toastr !== "undefined") toastr.success("角色设定已提交写入请求");
      } catch (error) {
        console.error("写入角色设定失败", error);
        if (typeof toastr !== "undefined") toastr.error("写入角色设定失败");
      }
    };
    (0, external_Vue_namespaceObject.watch)(affectionState, (newState, oldState) => {
      if (newState !== oldState && particleEmitter.value) {
        if (newState === "love") {
          particleEmitter.value.burst("heart", 15);
        } else if (newState === "hate") {
          particleEmitter.value.burst("skull", 12);
        }
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-RoleDetailPopup-overlay",
      onClick: _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.withModifiers)($event => _ctx.$emit("close"), [ "self" ]))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "GensokyoOrigin-RoleDetailPopup-close-btn",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close"))
    }, "×"), (0, external_Vue_namespaceObject.createCommentVNode)(" Left Column: Portrait "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_2, [ __props.character.pic ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("img", {
      key: 0,
      src: __props.character.pic,
      alt: __props.character.name,
      class: "GensokyoOrigin-RoleDetailPopup-portrait-image"
    }, null, 8, RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_3)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, (0, external_Vue_namespaceObject.toDisplayString)(__props.character.name.slice(0, 1)), 1) ])) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" Right Column: Content "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_5, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_7, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_8, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character["所在地区"] || "未知"), 1) ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_9, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_10, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "居住地:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(toText(__props.character.居住地区)), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_11, [ _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "目标:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(decisionText.value), 1) ]) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" Affection Details "), affectionStageInfo.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_12, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h3", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_13, "好感度阶段: " + (0, 
    external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.name), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("p", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_14, (0, 
    external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.describe), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_15, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_16, [ _cache[4] || (_cache[4] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "耐心值:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(toText(affectionStageInfo.value.patienceUnit)), 1) ]), affectionStageInfo.value.affectionGrowthLimit ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_17, [ _cache[5] || (_cache[5] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "好感增长上限:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" 软上限 " + (0, external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.affectionGrowthLimit.max) + ", 超出后除以 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.affectionGrowthLimit.divisor), 1) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), affectionStageInfo.value.visit ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_18, [ _cache[6] || (_cache[6] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "拜访规则:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.visit.enabled ? "会" : "不会") + "拜访。基础概率 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(((affectionStageInfo.value.visit.probBase ?? 0) * 100).toFixed(0)) + "%, 好感影响 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(((affectionStageInfo.value.visit.probK ?? 0) * 100).toFixed(0)) + "%。冷却刷新于 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(affectionStageInfo.value.visit.coolUnit), 1) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), affectionStageInfo.value.forgettingSpeed?.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_19, [ _cache[7] || (_cache[7] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "遗忘规则:", -1)), ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(affectionStageInfo.value.forgettingSpeed, (rule, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("span", {
      key: index
    }, " 于 " + (0, external_Vue_namespaceObject.toDisplayString)(rule.triggerFlag) + " 触发, 降低 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(rule.decrease) + " 点好感。 ", 1))), 128)) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]) ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, 
    external_Vue_namespaceObject.createVNode)(AffectionDisplay, {
      character: __props.character,
      "stat-without-meta": __props.statWithoutMeta,
      runtime: __props.runtime,
      size: "large"
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]), (0, external_Vue_namespaceObject.createVNode)(ParticleEmitter, {
      ref_key: "particleEmitter",
      ref: particleEmitter,
      active: affectionState.value === "love" || affectionState.value === "hate",
      "particle-type": affectionState.value === "hate" ? "skull" : "heart",
      "emission-rate": 3
    }, null, 8, [ "active", "particle-type" ]), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_20, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "role-settings-btn",
      disabled: !characterSettings.value,
      onClick: openSettingsModal
    }, "角色设定", 8, RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_21) ]) ]) ]) ]), (0, 
    external_Vue_namespaceObject.createVNode)(CharacterSettingsModal, {
      open: showSettingsModal.value,
      settings: characterSettings.value,
      "legal-locations": legalLocations.value,
      stat: __props.statWithoutMeta,
      onClose: closeSettingsModal,
      onSave: handleRoleSettingsSave
    }, null, 8, [ "open", "settings", "legal-locations", "stat" ]) ], 64));
  }
});

const RoleDetailPopup_exports_ = RoleDetailPopupvue_type_script_setup_true_lang_ts;

const RoleDetailPopup = RoleDetailPopup_exports_;

const Mapvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "map-component",
  id: "mapComponent"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "map-wrapper"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_3 = {
  key: 0,
  class: "map-info",
  ref: "mapInfo"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_4 = {
  id: "coords"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "map-container",
  id: "mapContainer"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_6 = [ "innerHTML", "onClick", "onTouchstart", "onMouseenter" ];

const Mapvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "dialog"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "dialog-header"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_9 = {
  class: "location-name"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_10 = {
  class: "dialog-content"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_11 = {
  key: 0,
  class: "npc-list"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_12 = [ "onClick", "onTouchstart" ];

const Mapvue_type_script_setup_true_lang_ts_hoisted_13 = {
  class: "npc-name"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_14 = {
  class: "npc-target"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_15 = {
  key: 1,
  class: "empty-location"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_16 = [ "innerHTML" ];

const Mapvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Map",
  props: {
    context: null
  },
  setup(__props) {
    const props = __props;
    const isMobile = (0, external_Vue_namespaceObject.ref)(false);
    const checkIfMobile = () => {
      isMobile.value = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };
    const mapSize = (0, external_Vue_namespaceObject.computed)(() => {
      if (props.context?.runtime?.area?.mapSize) {
        const padding = 20;
        return {
          width: props.context.runtime.area.mapSize.width + padding,
          height: props.context.runtime.area.mapSize.height + padding
        };
      }
      return {
        width: 800,
        height: 600
      };
    });
    const markers = (0, external_Vue_namespaceObject.computed)(() => {
      if (props.context?.runtime?.area?.legal_locations) {
        return props.context.runtime.area.legal_locations;
      }
      return [];
    });
    const locationMap = (0, external_Vue_namespaceObject.computed)(() => {
      const locationMap = new Map;
      if (props.context?.runtime?.area?.legal_locations) {
        props.context.runtime.area.legal_locations.forEach(item => {
          locationMap.set(item.name, item.pos);
        });
      }
      return locationMap;
    });
    const roads = (0, external_Vue_namespaceObject.computed)(() => {
      const connections = [];
      if (props.context?.runtime?.area?.graph) {
        for (const [startName, connectionsObj] of Object.entries(props.context.runtime.area.graph)) {
          const startLocation = locationMap.value.get(startName);
          if (!startLocation) continue;
          const startInfo = {
            name: startName,
            x: startLocation.x,
            y: startLocation.y
          };
          for (const [endName, isConnected] of Object.entries(connectionsObj)) {
            if (isConnected) {
              const endLocation = locationMap.value.get(endName);
              if (endLocation) {
                const endInfo = {
                  name: endName,
                  x: endLocation.x,
                  y: endLocation.y
                };
                connections.push({
                  start: startInfo,
                  end: endInfo
                });
              }
            }
          }
        }
      }
      return connections;
    });
    const playerMarker = (0, external_Vue_namespaceObject.computed)(() => {
      if (props.context?.runtime?.characterDistribution?.playerLocation) {
        const location = locationMap.value.get(props.context?.runtime?.characterDistribution.playerLocation);
        if (location) {
          return {
            name: "玩家",
            pos: {
              x: location.x,
              y: location.y
            },
            htmlEle: '<div class="player-icon">📍</div>'
          };
        }
      }
      return null;
    });
    let mapState = (0, external_Vue_namespaceObject.ref)({
      offsetX: 0,
      offsetY: 0,
      zoom: 1,
      isDragging: false,
      lastMouseX: 0,
      lastMouseY: 0,
      mapWidth: 300,
      mapHeight: 300,
      isTouching: false,
      lastTouchDistance: 0,
      initialTouches: []
    });
    let selectedMarker = (0, external_Vue_namespaceObject.ref)(null);
    let hoverMarker = (0, external_Vue_namespaceObject.ref)(null);
    const charactersInSelectedLocation = (0, external_Vue_namespaceObject.ref)([]);
    const showRoleDetailPopup = (0, external_Vue_namespaceObject.ref)(false);
    const selectedCharacterForPopup = (0, external_Vue_namespaceObject.ref)(null);
    let mapComponent;
    let mapContainer;
    let canvas;
    let ctx;
    let touchStartTime = 0;
    let longPressTimer = null;
    function openRoleDetailPopup(character) {
      selectedCharacterForPopup.value = character;
      showRoleDetailPopup.value = true;
    }
    function selectLocation(markerData) {
      if (markerData.name === selectedMarker.value?.name) {
        selectedMarker.value = null;
        charactersInSelectedLocation.value = [];
        return;
      }
      const npcIdList = props.context?.runtime?.characterDistribution?.npcByLocation?.[markerData.name];
      if (npcIdList) {
        charactersInSelectedLocation.value = npcIdList.map(id => ({
          ...props.context.statWithoutMeta.chars[id],
          id
        }));
      } else {
        charactersInSelectedLocation.value = [];
      }
      selectedMarker.value = {
        ...markerData,
        htmlEle: ""
      };
    }
    function handleMarkerTouchStart(markerData, event) {
      event.preventDefault();
      event.stopPropagation();
      touchStartTime = Date.now();
      longPressTimer = window.setTimeout(() => {
        console.log("长按标记:", markerData.name);
      }, 500);
      selectLocation(markerData);
    }
    function handleNpcTouch(npc, event) {
      event.preventDefault();
      event.stopPropagation();
      openRoleDetailPopup(npc);
    }
    function resetToPlayer() {
      if (playerMarker.value) {
        const playerPos = playerMarker.value.pos;
        const containerWidth = mapContainer.clientWidth;
        const containerHeight = mapContainer.clientHeight;
        mapState.value = {
          ...mapState.value,
          zoom: 1,
          offsetX: containerWidth / 2 - playerPos.x * 1,
          offsetY: containerHeight / 2 - playerPos.y * 1
        };
        drawMap();
      }
    }
    function zoomIn() {
      const zoomFactor = 1.2;
      const newZoom = mapState.value.zoom * zoomFactor;
      if (newZoom <= 5) {
        const containerWidth = mapContainer.clientWidth;
        const containerHeight = mapContainer.clientHeight;
        mapState.value = {
          ...mapState.value,
          zoom: newZoom,
          offsetX: containerWidth / 2 - (containerWidth / 2 - mapState.value.offsetX) * zoomFactor,
          offsetY: containerHeight / 2 - (containerHeight / 2 - mapState.value.offsetY) * zoomFactor
        };
        drawMap();
      }
    }
    function zoomOut() {
      const zoomFactor = .8;
      const newZoom = mapState.value.zoom * zoomFactor;
      if (newZoom >= .2) {
        const containerWidth = mapContainer.clientWidth;
        const containerHeight = mapContainer.clientHeight;
        mapState.value = {
          ...mapState.value,
          zoom: newZoom,
          offsetX: containerWidth / 2 - (containerWidth / 2 - mapState.value.offsetX) * zoomFactor,
          offsetY: containerHeight / 2 - (containerHeight / 2 - mapState.value.offsetY) * zoomFactor
        };
        drawMap();
      }
    }
    function resetView() {
      mapState.value = {
        ...mapState.value,
        zoom: 1,
        offsetX: (mapContainer.clientWidth - mapState.value.mapWidth) / 2,
        offsetY: (mapContainer.clientHeight - mapState.value.mapHeight) / 2
      };
      drawMap();
    }
    function drawMap() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(mapState.value.offsetX, mapState.value.offsetY);
      ctx.scale(mapState.value.zoom, mapState.value.zoom);
      drawMapBackground();
      drawRoads();
      ctx.restore();
    }
    function drawMapBackground() {
      const gradient = ctx.createLinearGradient(0, 0, mapSize.value.width, mapSize.value.height);
      gradient.addColorStop(0, "#8e9eab");
      gradient.addColorStop(1, "#eef2f3");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, mapSize.value.width, mapSize.value.height);
      ctx.strokeStyle = "rgba(255, 255, 255, 0.1)";
      ctx.lineWidth = 1;
      const gridSize = 50;
      for (let x = 0; x <= mapSize.value.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, mapSize.value.height);
        ctx.stroke();
      }
      for (let y = 0; y <= mapSize.value.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(mapSize.value.width, y);
        ctx.stroke();
      }
    }
    function drawRoads() {
      try {
        roads.value.forEach(road => {
          ctx.strokeStyle = "rgba(0, 0, 0, 0.2)";
          ctx.lineWidth = 8;
          ctx.lineCap = "round";
          ctx.beginPath();
          ctx.moveTo(road.start.x + 2, road.start.y + 2);
          ctx.lineTo(road.end.x + 2, road.end.y + 2);
          ctx.stroke();
          const gradient = ctx.createLinearGradient(road.start.x, road.start.y, road.end.x, road.end.y);
          gradient.addColorStop(0, "#5d4037");
          gradient.addColorStop(.5, "#6d4c41");
          gradient.addColorStop(1, "#5d4037");
          ctx.strokeStyle = gradient;
          ctx.lineWidth = 6;
          ctx.lineCap = "round";
          ctx.beginPath();
          ctx.moveTo(road.start.x, road.start.y);
          ctx.lineTo(road.end.x, road.end.y);
          ctx.stroke();
          ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
          ctx.lineWidth = 1;
          ctx.setLineDash([ 5, 3 ]);
          ctx.beginPath();
          ctx.moveTo(road.start.x, road.start.y);
          ctx.lineTo(road.end.x, road.end.y);
          ctx.stroke();
          ctx.setLineDash([]);
        });
      } catch (error) {
        console.error("道路数据格式错误:", error);
      }
    }
    function getDistance(touch1, touch2) {
      const dx = touch1.clientX - touch2.clientX;
      const dy = touch1.clientY - touch2.clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
    function getMidpoint(touch1, touch2) {
      return {
        x: (touch1.clientX + touch2.clientX) / 2,
        y: (touch1.clientY + touch2.clientY) / 2
      };
    }
    function updateCanvasSize() {
      const containerWidth = mapContainer.clientWidth;
      const containerHeight = containerWidth;
      mapContainer.style.height = `${containerHeight}px`;
      mapComponent.style.height = `${containerHeight}px`;
      mapState.value.mapWidth = containerWidth;
      mapState.value.mapHeight = containerHeight;
      canvas.width = containerWidth;
      canvas.height = containerHeight;
      drawMap();
    }
    function handleTouchStart(e) {
      e.preventDefault();
      if (e.touches.length === 1) {
        mapState.value = {
          ...mapState.value,
          isTouching: true,
          lastMouseX: e.touches[0].clientX,
          lastMouseY: e.touches[0].clientY
        };
      } else if (e.touches.length === 2) {
        mapState.value = {
          ...mapState.value,
          isTouching: true,
          lastTouchDistance: getDistance(e.touches[0], e.touches[1]),
          initialTouches: [ e.touches[0], e.touches[1] ]
        };
      }
    }
    function handleTouchMove(e) {
      e.preventDefault();
      if (!mapState.value.isTouching) return;
      if (e.touches.length === 1 && !mapState.value.lastTouchDistance) {
        const deltaX = e.touches[0].clientX - mapState.value.lastMouseX;
        const deltaY = e.touches[0].clientY - mapState.value.lastMouseY;
        mapState.value.offsetX += deltaX;
        mapState.value.offsetY += deltaY;
        mapState.value.lastMouseX = e.touches[0].clientX;
        mapState.value.lastMouseY = e.touches[0].clientY;
        drawMap();
      } else if (e.touches.length === 2) {
        const currentDistance = getDistance(e.touches[0], e.touches[1]);
        if (mapState.value.lastTouchDistance > 0) {
          const zoomFactor = currentDistance / mapState.value.lastTouchDistance;
          const newZoom = mapState.value.zoom * zoomFactor;
          if (newZoom >= .2 && newZoom <= 5) {
            const midpoint = getMidpoint(e.touches[0], e.touches[1]);
            const rect = mapContainer.getBoundingClientRect();
            const touchX = midpoint.x - rect.left;
            const touchY = midpoint.y - rect.top;
            const worldX = (touchX - mapState.value.offsetX) / mapState.value.zoom;
            const worldY = (touchY - mapState.value.offsetY) / mapState.value.zoom;
            mapState.value = {
              ...mapState.value,
              zoom: newZoom,
              offsetX: touchX - worldX * mapState.value.zoom,
              offsetY: touchY - worldY * mapState.value.zoom
            };
            drawMap();
          }
        }
        mapState.value.lastTouchDistance = currentDistance;
      }
    }
    function handleTouchEnd(e) {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
      mapState.value = {
        ...mapState.value,
        isTouching: false,
        lastTouchDistance: 0,
        initialTouches: []
      };
    }
    (0, external_Vue_namespaceObject.onMounted)(() => {
      checkIfMobile();
      mapComponent = document.getElementById("mapComponent");
      mapContainer = document.getElementById("mapContainer");
      canvas = document.getElementById("mapCanvas");
      ctx = canvas.getContext("2d");
      updateCanvasSize();
      function generateMap() {
        resetToPlayer();
        drawMap();
      }
      mapContainer.addEventListener("mousedown", e => {
        mapState.value = {
          ...mapState.value,
          isDragging: true,
          lastMouseX: e.clientX,
          lastMouseY: e.clientY
        };
        mapContainer.style.cursor = "grabbing";
      });
      mapContainer.addEventListener("mousemove", e => {
        if (mapState.value.isDragging) {
          const deltaX = e.clientX - mapState.value.lastMouseX;
          const deltaY = e.clientY - mapState.value.lastMouseY;
          mapState.value.offsetX += deltaX;
          mapState.value.offsetY += deltaY;
          mapState.value.lastMouseX = e.clientX;
          mapState.value.lastMouseY = e.clientY;
          drawMap();
        }
      });
      mapContainer.addEventListener("mouseup", () => {
        mapState.value.isDragging = false;
        mapContainer.style.cursor = "grab";
      });
      mapContainer.addEventListener("mouseleave", () => {
        mapState.value.isDragging = false;
        mapContainer.style.cursor = "grab";
      });
      mapContainer.addEventListener("wheel", e => {
        e.preventDefault();
        const zoomFactor = e.deltaY > 0 ? .9 : 1.1;
        const newZoom = mapState.value.zoom * zoomFactor;
        if (newZoom >= .2 && newZoom <= 5) {
          const rect = mapContainer.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;
          const worldX = (mouseX - mapState.value.offsetX) / mapState.value.zoom;
          const worldY = (mouseY - mapState.value.offsetY) / mapState.value.zoom;
          mapState.value = {
            ...mapState.value,
            zoom: newZoom,
            offsetX: mouseX - worldX * mapState.value.zoom,
            offsetY: mouseY - worldY * mapState.value.zoom
          };
          drawMap();
        }
      });
      mapContainer.addEventListener("touchstart", handleTouchStart, {
        passive: false
      });
      mapContainer.addEventListener("touchmove", handleTouchMove, {
        passive: false
      });
      mapContainer.addEventListener("touchend", handleTouchEnd);
      mapContainer.addEventListener("touchcancel", handleTouchEnd);
      generateMap();
    });
    (0, external_Vue_namespaceObject.onUnmounted)(() => {
      if (mapContainer) {
        mapContainer.removeEventListener("touchstart", handleTouchStart);
        mapContainer.removeEventListener("touchmove", handleTouchMove);
        mapContainer.removeEventListener("touchend", handleTouchEnd);
        mapContainer.removeEventListener("touchcancel", handleTouchEnd);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 地图信息显示，暂时隐藏 "), false ? 0 : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "map-operate"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", {
      onClick: resetToPlayer,
      title: "回到玩家位置"
    }, "🎯"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      onClick: zoomIn
    }, "+"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      onClick: zoomOut
    }, "-") ]), (0, external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_5, [ _cache[6] || (_cache[6] = (0, 
    external_Vue_namespaceObject.createElementVNode)("canvas", {
      id: "mapCanvas"
    }, null, -1)), (0, external_Vue_namespaceObject.createCommentVNode)(" 动态生成marker "), ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(markers.value, (marker, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: index,
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "marker location-marker", {
        "marker-highlighted": (0, external_Vue_namespaceObject.unref)(selectedMarker)?.name === marker.name
      } ]),
      innerHTML: marker.htmlEle,
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: marker.pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: marker.pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY + "px",
        transform: `translate(-50%, -50%)`
      }),
      onClick: $event => selectLocation(marker),
      onTouchstart: $event => handleMarkerTouchStart(marker, $event),
      onMouseenter: $event => (0, external_Vue_namespaceObject.isRef)(hoverMarker) ? hoverMarker.value = marker.name : hoverMarker = marker.name,
      onMouseleave: _cache[0] || (_cache[0] = $event => (0, external_Vue_namespaceObject.isRef)(hoverMarker) ? hoverMarker.value = null : hoverMarker = null)
    }, null, 46, Mapvue_type_script_setup_true_lang_ts_hoisted_6))), 128)), (0, external_Vue_namespaceObject.createCommentVNode)(" 点击marker的tip弹出 "), (0, 
    external_Vue_namespaceObject.unref)(selectedMarker) ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: 0,
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "tip-container", {
        "tip-visible": (0, external_Vue_namespaceObject.unref)(selectedMarker)
      } ]),
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: (0, external_Vue_namespaceObject.unref)(selectedMarker).pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: (0, external_Vue_namespaceObject.unref)(selectedMarker).pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY - 20 + "px",
        transform: `translate(-50%, -100%)`
      })
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_7, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_8, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h2", Mapvue_type_script_setup_true_lang_ts_hoisted_9, (0, 
    external_Vue_namespaceObject.toDisplayString)((0, external_Vue_namespaceObject.unref)(selectedMarker).name), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "close-btn",
      onClick: _cache[1] || (_cache[1] = $event => (0, external_Vue_namespaceObject.isRef)(selectedMarker) ? selectedMarker.value = null : selectedMarker = null),
      onTouchstart: _cache[2] || (_cache[2] = $event => (0, external_Vue_namespaceObject.isRef)(selectedMarker) ? selectedMarker.value = null : selectedMarker = null)
    }, "×", 32) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_10, [ charactersInSelectedLocation.value.length > 0 ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_11, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(charactersInSelectedLocation.value, npc => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: npc.id,
      class: "npc-item",
      onClick: $event => openRoleDetailPopup(npc),
      onTouchstart: $event => handleNpcTouch(npc, $event)
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", Mapvue_type_script_setup_true_lang_ts_hoisted_13, (0, 
    external_Vue_namespaceObject.toDisplayString)(npc.name) + "：", 1), (0, external_Vue_namespaceObject.createElementVNode)("span", Mapvue_type_script_setup_true_lang_ts_hoisted_14, (0, 
    external_Vue_namespaceObject.toDisplayString)(npc["目标"] || "未知"), 1) ], 40, Mapvue_type_script_setup_true_lang_ts_hoisted_12))), 128)) ])) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_15, "空无一人")) ]) ]) ], 6)) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, external_Vue_namespaceObject.createCommentVNode)(" 玩家 "), playerMarker.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: 1,
      class: "marker player-marker pulsate",
      innerHTML: playerMarker.value.htmlEle,
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: playerMarker.value.pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: playerMarker.value.pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY + "px",
        transform: `translate(-50%, -100%)`
      })
    }, null, 12, Mapvue_type_script_setup_true_lang_ts_hoisted_16)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]) ]), showRoleDetailPopup.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(RoleDetailPopup, {
      key: 0,
      character: selectedCharacterForPopup.value,
      "stat-without-meta": props.context.statWithoutMeta,
      runtime: props.context.runtime,
      onClose: _cache[3] || (_cache[3] = $event => showRoleDetailPopup.value = false)
    }, null, 8, [ "character", "stat-without-meta", "runtime" ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const Map_exports_ = Mapvue_type_script_setup_true_lang_ts;

const Map_Map = Map_exports_;

const format_logger = new Logger("GSKO-FACE/utils/format");

function firstVal(x) {
  return Array.isArray(x) ? x.length ? x[0] : "" : x;
}

function get(obj, path, fallback = "") {
  try {
    const ks = Array.isArray(path) ? path : String(path).split(".");
    let cur = obj;
    for (const k of ks) {
      if (!cur || typeof cur !== "object" || !(k in cur)) {
        format_logger.debug("get", "未找到键，使用默认值。", {
          路径: String(path),
          缺失键: String(k),
          默认值: fallback
        });
        return fallback;
      }
      cur = cur[k];
    }
    const v = firstVal(cur);
    if (v == null) {
      format_logger.debug("get", "路径存在但值为空(null/undefined)，使用默认值。", {
        路径: String(path),
        默认值: fallback
      });
      return fallback;
    }
    return v;
  } catch (e) {
    format_logger.error("get", "异常，使用默认值。", {
      路径: String(path),
      异常: String(e),
      默认值: fallback
    });
    return fallback;
  }
}

function format_text(id, raw) {
  const el = document.getElementById(id);
  if (!el) {
    format_logger.warn("text", "目标元素不存在，跳过写入。", {
      元素ID: id
    });
    return;
  }
  el.textContent = toText(raw);
}

function getRaw(obj, path, fallback = null) {
  try {
    const ks = Array.isArray(path) ? path : String(path).split(".");
    let cur = obj;
    for (const k of ks) {
      if (!cur || typeof cur !== "object" || !(k in cur)) {
        return fallback;
      }
      cur = cur[k];
    }
    return cur == null ? fallback : cur;
  } catch (e) {
    format_logger.error("getRaw", "异常，使用默认值。", {
      路径: String(path),
      异常: String(e),
      默认值: fallback
    });
    return fallback;
  }
}

function toText(v) {
  if (v == null || v === "") return "—";
  if (Array.isArray(v)) return v.length ? v.join("；") : "—";
  if (typeof v === "object") return JSON.stringify(v);
  return String(v);
}

function getStr(obj, path, fallback = "") {
  const rawValue = getRaw(obj, path, null);
  if (rawValue === null) {
    return toText(fallback);
  }
  return toText(rawValue);
}

function parseIsoAsLocal(isoString) {
  if (!isoString) {
    return new Date;
  }
  const parts = isoString.match(/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);
  if (parts) {
    return new Date(parseInt(parts[1], 10), parseInt(parts[2], 10) - 1, parseInt(parts[3], 10), parseInt(parts[4], 10), parseInt(parts[5], 10), parseInt(parts[6], 10));
  }
  return new Date(isoString);
}

const ContentBiovue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ContentBio",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/StatusTab/tabs/ContentBio");
    const userEvents = (0, external_Vue_namespaceObject.ref)(null);
    const userRelationships = (0, external_Vue_namespaceObject.ref)(null);
    function update({statWithoutMeta: stat}) {
      const funcName = "update";
      logger.log(funcName, "接收到更新指令，开始更新履历与关系", {
        stat
      });
      const userData = stat.user;
      logger.debug(funcName, "提取的用户数据", {
        userData
      });
      const eventsText = toText(userData.重要经历);
      const relationshipsText = toText(userData.人际关系);
      logger.debug(funcName, "处理后的待显示文本", {
        eventsText,
        relationshipsText
      });
      if (userEvents.value) {
        userEvents.value.textContent = eventsText;
        logger.log(funcName, "成功更新“重要经历”内容。");
      } else {
        logger.warn(funcName, "无法找到“重要经历”的 DOM 元素 (userEvents ref)，请检查模板。");
      }
      if (userRelationships.value) {
        userRelationships.value.textContent = relationshipsText;
        logger.log(funcName, "成功更新“人际关系”内容。");
      } else {
        logger.warn(funcName, "无法找到“人际关系”的 DOM 元素 (userRelationships ref)，请检查模板。");
      }
    }
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🧭"), (0, external_Vue_namespaceObject.createTextVNode)("重要经历") ], -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      ref_key: "userEvents",
      ref: userEvents,
      class: "preserve-format"
    }, "—", 512), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("hr", {
      class: "dashed"
    }, null, -1)), _cache[2] || (_cache[2] = (0, external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🤝"), (0, external_Vue_namespaceObject.createTextVNode)("人际关系") ], -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      ref_key: "userRelationships",
      ref: userRelationships,
      class: "preserve-format"
    }, "—", 512) ]));
  }
});

const ContentBio_exports_ = (0, exportHelper.A)(ContentBiovue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-57d1591c" ] ]);

const ContentBio = ContentBio_exports_;

const external_namespaceObject = _;

var external_default = __webpack_require__.n(external_namespaceObject);

const ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "row",
  style: {
    display: "flex",
    gap: "8px",
    "align-items": "center",
    margin: "8px 0 12px"
  }
};

const ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_2 = {
  id: "cfg_status",
  class: "tag"
};

const ContentSettingsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ContentSettings",
  props: {
    config: {}
  },
  emits: [ "saved" ],
  setup(__props, {emit: __emit}) {
    const props = __props;
    const emit = __emit;
    const logger = new Logger("GSKO-FACE/components/StatusTab/tabs/ContentSettings");
    const loadStatus = (0, external_Vue_namespaceObject.ref)("未载入");
    const configRoot = (0, external_Vue_namespaceObject.ref)(null);
    let initialConfig = null;
    let editedConfig = null;
    let leafCount = 0;
    let groupCount = 0;
    let pendingConfig;
    const isObj = o => o && typeof o === "object" && !Array.isArray(o);
    const handleConfigUpdate = config => {
      if (!configRoot.value) {
        pendingConfig = config;
        return;
      }
      if (!config) {
        configRoot.value.innerHTML = "";
        loadStatus.value = "未载入";
        initialConfig = null;
        editedConfig = null;
        return;
      }
      if (typeof config !== "object") {
        logger.warn("handleConfigUpdate", "配置对象无效，期望为 object。");
        configRoot.value.innerHTML = "";
        loadStatus.value = "配置无效";
        initialConfig = null;
        editedConfig = null;
        return;
      }
      render(config);
    };
    (0, external_Vue_namespaceObject.watch)(() => props.config, config => {
      handleConfigUpdate(config);
    }, {
      immediate: true
    });
    (0, external_Vue_namespaceObject.onMounted)(() => {
      if (pendingConfig !== undefined) {
        const config = pendingConfig;
        pendingConfig = undefined;
        handleConfigUpdate(config);
      }
    });
    const pathLabel = segments => segments.length ? segments.join(".") : "config";
    const getValueAtPath = (root, segments) => segments.reduce((acc, key) => acc != null ? acc[key] : undefined, root);
    const setValueAtPath = (root, segments, value) => {
      if (!segments.length) {
        return;
      }
      let current = root;
      for (let i = 0; i < segments.length - 1; i++) {
        const key = segments[i];
        if (!isObj(current[key])) {
          current[key] = {};
        }
        current = current[key];
      }
      current[segments[segments.length - 1]] = value;
    };
    function createControl(segments, parent, key, value, docText) {
      const wrap = document.createElement("div");
      const keyEl = document.createElement("div");
      const box = document.createElement("div");
      wrap.style.margin = "10px 0";
      keyEl.style.fontWeight = "600";
      keyEl.style.color = "#5e5042";
      keyEl.textContent = pathLabel(segments);
      wrap.appendChild(keyEl);
      if (docText) {
        const docEl = document.createElement("div");
        docEl.style.color = "#857664";
        docEl.style.fontSize = ".9em";
        docEl.style.margin = "6px 0 10px";
        docEl.textContent = docText;
        wrap.appendChild(docEl);
      }
      wrap.appendChild(box);
      let getDomValue;
      if (typeof value === "boolean") {
        const el = document.createElement("input");
        el.type = "checkbox";
        el.checked = !!value;
        box.appendChild(el);
        getDomValue = () => !!el.checked;
      } else if (typeof value === "number") {
        const el = document.createElement("input");
        el.type = "number";
        el.value = String(value);
        el.style.width = "100%";
        box.appendChild(el);
        getDomValue = () => Number(el.value);
      } else if (Array.isArray(value)) {
        const isPrimitiveArray = value.every(v => v === null || [ "string", "number", "boolean" ].includes(typeof v));
        const el = document.createElement("textarea");
        el.style.width = "100%";
        el.style.minHeight = "100px";
        box.appendChild(el);
        if (isPrimitiveArray) {
          el.value = value.map(v => String(v)).join("\n");
          getDomValue = () => {
            const lines = (el.value || "").split("\n").map(s => s.trim()).filter(Boolean);
            const allNumbers = lines.every(s => /^-?\d+(?:\.\d+)?$/.test(s));
            return allNumbers ? lines.map(Number) : lines;
          };
        } else {
          el.value = JSON.stringify(value, null, 2);
          getDomValue = () => {
            try {
              const text = el.value.trim();
              return text ? JSON.parse(text) : [];
            } catch (e) {
              logger.error("createControl", `解析 JSON 失败，路径: ${pathLabel(segments)}`, e);
              return value;
            }
          };
        }
      } else {
        const el = document.createElement("input");
        el.type = "text";
        el.value = value == null ? "" : String(value);
        el.style.width = "100%";
        box.appendChild(el);
        getDomValue = () => el.value;
      }
      leafCount++;
      const initialValue = (0, external_namespaceObject.cloneDeep)(getValueAtPath(initialConfig, segments));
      wrap.__getDomValue = getDomValue;
      wrap.__applyValue = next => {
        parent[key] = next;
      };
      wrap.__initialValue = initialValue;
      wrap.__pathSegments = segments.slice();
      wrap.__pathLabel = pathLabel(segments);
      wrap.dataset.path = pathLabel(segments);
      return wrap;
    }
    function createGroup(obj, segments, docText, summaryLabel) {
      const box = document.createElement("details");
      box.open = false;
      const sum = document.createElement("summary");
      sum.textContent = summaryLabel ?? (segments.length ? segments[segments.length - 1] : "(root)");
      box.appendChild(sum);
      if (docText) {
        const d = document.createElement("div");
        d.style.color = "#857664";
        d.style.fontSize = ".9em";
        d.style.margin = "6px 0 10px";
        d.textContent = docText;
        box.appendChild(d);
      }
      groupCount++;
      Object.keys(obj).forEach(k => {
        if (k === "__doc" || k === "_doc" || k.endsWith("__doc") || k.startsWith("_")) return;
        const v = obj[k];
        const nextSegments = [ ...segments, k ];
        if (isObj(v)) {
          const child = createGroup(v, nextSegments, v?._doc || obj[`${k}__doc`], k);
          box.appendChild(child);
        } else {
          const leafDoc = obj[`${k}__doc`];
          const controlElement = createControl(nextSegments, obj, k, v, leafDoc);
          box.appendChild(controlElement);
        }
      });
      return box;
    }
    function render(config) {
      if (!configRoot.value) {
        logger.warn("render", "#cfg_root 容器尚未就绪，推迟渲染。");
        pendingConfig = config;
        return;
      }
      const t0 = performance.now();
      initialConfig = (0, external_namespaceObject.cloneDeep)(config);
      editedConfig = (0, external_namespaceObject.cloneDeep)(config);
      leafCount = 0;
      groupCount = 0;
      configRoot.value.innerHTML = "";
      const view = createGroup(editedConfig, [], editedConfig?._doc, "config");
      view.open = false;
      configRoot.value.appendChild(view);
      loadStatus.value = "已载入";
      const ms = (performance.now() - t0).toFixed(1);
      logger.log("render", `配置渲染完成`, {
        groups: groupCount,
        leaves: leafCount,
        ms
      });
    }
    function collectChanges() {
      const t0 = performance.now();
      const items = configRoot.value?.querySelectorAll("[data-path]") || [];
      const changes = [];
      let scanned = 0;
      items.forEach(el => {
        scanned++;
        const getDomValue = el.__getDomValue;
        const applyValue = el.__applyValue;
        const initialValue = el.__initialValue;
        const pathSegments = el.__pathSegments;
        const label = el.__pathLabel;
        if (!getDomValue || !applyValue || !pathSegments || !label) return;
        const currentValue = getDomValue();
        applyValue((0, external_namespaceObject.cloneDeep)(currentValue));
        if (!(0, external_namespaceObject.isEqual)(currentValue, initialValue)) {
          changes.push({
            path: pathSegments,
            pathLabel: label,
            from: initialValue,
            to: (0, external_namespaceObject.cloneDeep)(currentValue)
          });
        }
      });
      logger.log("collectChanges", `差异收集完成`, {
        scanned,
        changed: changes.length,
        ms: (performance.now() - t0).toFixed(1),
        sample: changes.slice(0, 5).map(item => ({
          path: item.pathLabel,
          to: item.to
        }))
      });
      return changes;
    }
    const buildPatchObject = changes => {
      const patch = {};
      changes.forEach(change => {
        setValueAtPath(patch, change.path, (0, external_namespaceObject.cloneDeep)(change.to));
      });
      return patch;
    };
    async function save() {
      const funcName = "save";
      try {
        const changes = collectChanges();
        if (!changes.length) {
          logger.log(funcName, "无变化，无需保存。");
          toastr.info("没有检测到任何更改。");
          return;
        }
        logger.log(funcName, `准备写入 ${changes.length} 项更改...`);
        toastr.info(`正在保存 ${changes.length} 项更改...`);
        const patch = buildPatchObject(changes);
        let ok = 0;
        let fail = 0;
        try {
          updateEraVariableByObject({
            config: patch
          });
          ok = changes.length;
          logger.log(funcName, `已发送 era:updateByObject`, {
            patch
          });
          toastr.success(`保存成功 ${ok} 项。`);
          emit("saved", {
            ok,
            fail,
            patch
          });
          if (editedConfig && typeof editedConfig === "object") {
            render(editedConfig);
            loadStatus.value = "已保存";
          } else {
            loadStatus.value = "已保存";
          }
        } catch (error) {
          fail = changes.length;
          logger.error(funcName, `写入失败`, error);
          toastr.error("保存过程中发生未知错误。");
          emit("saved", {
            ok,
            fail,
            patch
          });
        }
      } catch (e) {
        logger.error(funcName, `保存过程出现异常`, e);
        toastr.error("保存过程中发生未知错误。");
      }
    }
    function expandAll() {
      const list = configRoot.value?.querySelectorAll("details");
      list?.forEach(d => d.open = true);
      logger.log("expandAll", `展开了 ${list?.length || 0} 个分组。`);
    }
    function collapseAll() {
      const list = configRoot.value?.querySelectorAll("details");
      list?.forEach(d => d.open = false);
      logger.log("collapseAll", `折叠了 ${list?.length || 0} 个分组。`);
    }
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⚙️"), (0, external_Vue_namespaceObject.createTextVNode)("设置") ], -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_2, (0, 
    external_Vue_namespaceObject.toDisplayString)(loadStatus.value), 1), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_expand_all",
      onClick: expandAll
    }, "展开全部"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_collapse_all",
      onClick: collapseAll
    }, "折叠全部"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_save_cfg",
      onClick: save
    }, "保存更改") ]), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "hint"
    }, "布尔=勾选，数字=数字框，字符串=文本框，数组=每行一项。对象会折叠为分组。", -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "cfg_root",
      ref_key: "configRoot",
      ref: configRoot
    }, null, 512) ]));
  }
});

const ContentSettings_exports_ = (0, exportHelper.A)(ContentSettingsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-6e6f3416" ] ]);

const ContentSettings = ContentSettings_exports_;

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "incident-toolbar",
  class: "debug-select",
  style: {
    display: "flex",
    "align-items": "center",
    gap: "12px",
    "flex-wrap": "wrap"
  }
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_2 = {
  id: "incident-countdown"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "debug-switch",
  title: "来自 config.incident.forceTrigger；修改即写回到配置"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "debug-switch",
  title: "来自 config.incident.isRandomPool；修改即写回到配置"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_5 = {
  id: "incident-list",
  class: "incident-list"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "role-card-header"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "role-name"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "role-meta"
};

const Incidentsvue_type_script_setup_true_lang_ts_hoisted_9 = {
  key: 1,
  class: "role-card"
};

const Incidentsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Incidents",
  props: {
    stat: {},
    runtime: {}
  },
  setup(__props) {
    const logger = new Logger("GSKO-FACE/components/StatusTab/tabs/Incidents");
    const props = __props;
    const incidentCards = (0, external_Vue_namespaceObject.computed)(() => {
      const stat = props.stat;
      if (!stat || !stat.incidents) return [];
      const entries = Object.entries(stat.incidents).filter(([key, value]) => !key.startsWith("$") && !!value);
      return entries.map(([name, detail]) => {
        const incident = detail;
        const solver = incident.异变退治者;
        const solverText = Array.isArray(solver) ? solver.join("、") : solver ?? "";
        const mainLoc = incident.主要地区?.join("、") ?? "";
        const fields = [];
        if (incident.异变细节) {
          fields.push({
            label: "异变细节",
            value: incident.异变细节
          });
        }
        if (mainLoc) {
          fields.push({
            label: "主要地区",
            value: mainLoc
          });
        }
        if (solverText) {
          fields.push({
            label: "异变退治者",
            value: solverText
          });
        }
        return {
          key: name,
          name,
          statusText: incident.异变已结束 ? "已结束" : "进行中",
          fields
        };
      });
    });
    const countdownMinutes = (0, external_Vue_namespaceObject.computed)(() => {
      const runtimeCountdown = props.runtime?.incident?.remainingCooldown;
      if (typeof runtimeCountdown === "number" && Number.isFinite(runtimeCountdown)) {
        return Math.max(0, Math.floor(runtimeCountdown));
      }
      const config = props.stat?.config?.incident;
      const timeProgress = props.stat?.time?.timeProgress;
      if (!config || typeof config.cooldownMinutes !== "number" || typeof timeProgress !== "number") {
        return null;
      }
      const anchor = props.stat?.cache?.incident?.incidentCooldownAnchor;
      if (anchor == null) {
        return Math.max(0, Math.floor(config.cooldownMinutes));
      }
      const remaining = config.cooldownMinutes - (timeProgress - anchor);
      return Math.max(0, Math.floor(remaining));
    });
    const countdownText = (0, external_Vue_namespaceObject.computed)(() => {
      const value = countdownMinutes.value;
      return value == null ? "—" : String(value);
    });
    const immediateTrigger = (0, external_Vue_namespaceObject.ref)(false);
    const randomPool = (0, external_Vue_namespaceObject.ref)(false);
    let skipImmediatePropagation = false;
    let skipRandomPropagation = false;
    (0, external_Vue_namespaceObject.watch)(() => props.stat?.config?.incident?.forceTrigger ?? false, value => {
      if (immediateTrigger.value === value) {
        return;
      }
      skipImmediatePropagation = true;
      immediateTrigger.value = value;
      logger.log("syncImmediateTrigger", `已同步“立即引发异变”状态: ${value}`);
    }, {
      immediate: true
    });
    (0, external_Vue_namespaceObject.watch)(() => props.stat?.config?.incident?.isRandomPool ?? false, value => {
      if (randomPool.value === value) {
        return;
      }
      skipRandomPropagation = true;
      randomPool.value = value;
      logger.log("syncRandomPool", `已同步“乱序异变”状态: ${value}`);
    }, {
      immediate: true
    });
    (0, external_Vue_namespaceObject.watch)(immediateTrigger, value => {
      if (skipImmediatePropagation) {
        skipImmediatePropagation = false;
        return;
      }
      logger.log("onImmediateTriggerChange", `用户切换“立即引发异变”为: ${value}`);
      updateEraVariableByObject({
        config: {
          incident: {
            forceTrigger: value
          }
        }
      });
    }, {
      flush: "post"
    });
    (0, external_Vue_namespaceObject.watch)(randomPool, value => {
      if (skipRandomPropagation) {
        skipRandomPropagation = false;
        return;
      }
      logger.log("onRandomPoolChange", `用户切换“乱序异变”为: ${value}`);
      updateEraVariableByObject({
        config: {
          incident: {
            isRandomPool: value
          }
        }
      });
    }, {
      flush: "post"
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[7] || (_cache[7] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⚠️"), (0, external_Vue_namespaceObject.createTextVNode)("异变啊异变！") ], -1)), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ===== 异变工具栏（倒计时 + 立即引发） ===== "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_1, [ _cache[4] || (_cache[4] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "label",
      style: {
        "min-width": "auto",
        margin: "0"
      }
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⏳"), (0, external_Vue_namespaceObject.createTextVNode)("异变倒计时（分钟）: ") ], -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", Incidentsvue_type_script_setup_true_lang_ts_hoisted_2, (0, 
    external_Vue_namespaceObject.toDisplayString)(countdownText.value), 1), (0, external_Vue_namespaceObject.createElementVNode)("span", Incidentsvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      id: "incident-trigger-now",
      "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => immediateTrigger.value = $event),
      type: "checkbox"
    }, null, 512), [ [ external_Vue_namespaceObject.vModelCheckbox, immediateTrigger.value ] ]), _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" 立即引发异变 ", -1)) ]), (0, external_Vue_namespaceObject.createElementVNode)("span", Incidentsvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      id: "incident-pool-random",
      "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => randomPool.value = $event),
      type: "checkbox"
    }, null, 512), [ [ external_Vue_namespaceObject.vModelCheckbox, randomPool.value ] ]), _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" 乱序异变 ", -1)) ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_5, [ incidentCards.value.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, {
      key: 0
    }, (0, external_Vue_namespaceObject.renderList)(incidentCards.value, incident => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: incident.key,
      class: "role-card"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_6, [ _cache[5] || (_cache[5] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-avatar"
    }, "异", -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_7, (0, 
    external_Vue_namespaceObject.toDisplayString)(incident.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_8, "进程：" + (0, 
    external_Vue_namespaceObject.toDisplayString)(incident.statusText), 1) ]) ]), ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(incident.fields, field => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: field.label,
      class: "role-line"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("strong", null, (0, external_Vue_namespaceObject.toDisplayString)(field.label) + "：", 1), (0, 
    external_Vue_namespaceObject.createTextVNode)((0, external_Vue_namespaceObject.toDisplayString)(field.value), 1) ]))), 128)) ]))), 128)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", Incidentsvue_type_script_setup_true_lang_ts_hoisted_9, [ ..._cache[6] || (_cache[6] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-card-header"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-avatar"
    }, "✔"), (0, external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-name"
    }, "暂无记录"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "role-meta"
    }, "最近没有可展示的异变") ]) ], -1) ]) ])) ]) ]));
  }
});

const Incidents_exports_ = (0, exportHelper.A)(Incidentsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-431ddb4f" ] ]);

const Incidents = Incidents_exports_;

const FontSizeControlsvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "font-size-controls"
};

const FontSizeControlsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "FontSizeControls",
  props: {
    uiConfig: {}
  },
  setup(__props) {
    const props = __props;
    const logger = new Logger("GSKO-FACE/components/StatusTab/tabs/FontSizeControls");
    const currentPercent = (0, external_Vue_namespaceObject.ref)(100);
    const stepPct = (0, external_Vue_namespaceObject.ref)(10);
    const applyToDOM = pct => {
      const content = document.getElementById("content_main");
      if (content) {
        content.style.fontSize = `${pct}%`;
        logger.log("applyToDOM", `已应用字号: ${pct}%`);
      } else {
        logger.warn("applyToDOM", "未找到 #content_main 元素。");
      }
    };
    const clamp = n => Math.max(60, Math.min(200, Math.floor(Number(n) || 100)));
    const sanitizeStep = value => {
      const numeric = Number(value);
      if (!Number.isFinite(numeric) || numeric <= 0) {
        return 10;
      }
      return Math.floor(numeric);
    };
    const syncFromConfig = (percent, step) => {
      const clampedPercent = clamp(percent);
      const sanitizedStep = sanitizeStep(step);
      stepPct.value = sanitizedStep;
      currentPercent.value = clampedPercent;
      applyToDOM(clampedPercent);
      logger.log("syncFromConfig", `初始化字号: ${clampedPercent}%（步进: ${sanitizedStep}%）`);
    };
    const hasSyncedInitial = (0, external_Vue_namespaceObject.ref)(false);
    (0, external_Vue_namespaceObject.watch)(() => props.uiConfig, uiConfig => {
      if (!uiConfig) {
        hasSyncedInitial.value = false;
        return;
      }
      if (hasSyncedInitial.value) {
        return;
      }
      syncFromConfig(uiConfig.mainFontPercent, uiConfig.fontScaleStepPct);
      hasSyncedInitial.value = true;
    }, {
      immediate: true
    });
    const persistFontSize = pct => {
      currentPercent.value = pct;
      applyToDOM(pct);
      updateEraVariableByObject({
        config: {
          ui: {
            mainFontPercent: pct
          }
        }
      });
    };
    const increaseFont = () => {
      const newValue = clamp(currentPercent.value + stepPct.value);
      persistFontSize(newValue);
    };
    const decreaseFont = () => {
      const newValue = clamp(currentPercent.value - stepPct.value);
      persistFontSize(newValue);
    };
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", FontSizeControlsvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "decrease-font",
      class: "font-size-btn",
      onClick: decreaseFont
    }, "−"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "increase-font",
      class: "font-size-btn",
      onClick: increaseFont
    }, "+") ]));
  }
});

const FontSizeControls_exports_ = (0, exportHelper.A)(FontSizeControlsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-0a4b721e" ] ]);

const FontSizeControls = FontSizeControls_exports_;

const log_PROJECT_NAME = "GSKO-BASE";

const log_DEBUG_CONFIG_LS_KEY = "gsko_era_debug_config";

let log_enabledPatterns = [];

let log_disabledPatterns = [];

function log_loadDebugConfig() {
  try {
    const configStr = globalThis.localStorage?.getItem(log_DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
    const config = JSON.parse(configStr);
    const toRegex = p => new RegExp(`${p.replace(/\*/g, ".*")}`);
    log_enabledPatterns = (config.enabled || []).map(toRegex);
    log_disabledPatterns = (config.disabled || []).map(toRegex);
  } catch (e) {
    console.error(`《${log_PROJECT_NAME}-Log》: 加载调试配置失败。`, e);
    log_enabledPatterns = [];
    log_disabledPatterns = [];
  }
}

function log_isDebugEnabled(moduleName) {
  if (!moduleName) return false;
  if (log_disabledPatterns.some(re => re.test(moduleName))) {
    return false;
  }
  if (log_enabledPatterns.length === 0) {
    return false;
  }
  if (log_enabledPatterns.some(re => re.test(moduleName))) {
    return true;
  }
  return false;
}

function log_updateConfig(newConfig) {
  const uniqueConfig = {
    enabled: [ ...new Set(newConfig.enabled) ],
    disabled: [ ...new Set(newConfig.disabled) ]
  };
  globalThis.localStorage?.setItem(log_DEBUG_CONFIG_LS_KEY, JSON.stringify(uniqueConfig));
  log_loadDebugConfig();
  console.log(`%c《${log_PROJECT_NAME}-Log》调试模式已更新。`, "color: #3498db; font-weight: bold;", {
    "启用 (Enabled)": uniqueConfig.enabled,
    "禁用 (Disabled)": uniqueConfig.disabled
  });
}

log_loadDebugConfig();

if (typeof globalThis !== "undefined") {
  const eraDebug = {
    add(pattern) {
      const configStr = globalThis.localStorage?.getItem(log_DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      enabled.add(pattern);
      disabled.delete(pattern);
      log_updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    remove(pattern) {
      const configStr = globalThis.localStorage?.getItem(log_DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      disabled.add(pattern);
      enabled.delete(pattern);
      log_updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    status() {
      const configStr = globalThis.localStorage?.getItem(log_DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      console.log(`%c《${log_PROJECT_NAME}-Log》当前调试配置:`, "color: #3498db; font-weight: bold;", config);
    },
    clear() {
      log_updateConfig({
        enabled: [],
        disabled: []
      });
    }
  };
  globalThis.eraDebug = eraDebug;
}

const log_logContext = {
  mk: ""
};

class log_Logger {
  moduleName;
  constructor(...[moduleName]) {
    const maybeModuleName = moduleName;
    const injectedModuleName = typeof maybeModuleName === "string" ? maybeModuleName : undefined;
    this.moduleName = injectedModuleName || this._getModuleNameFromStack() || "unknown";
  }
  _getModuleNameFromStack() {
    try {
      const stack = (new Error).stack || "";
      const callerLine = stack.split("\n").find(line => (line.includes(`/src/${log_PROJECT_NAME}/`) || line.includes(`/dist/${log_PROJECT_NAME}/`) || line.includes(`\\src\\${log_PROJECT_NAME}\\`) || line.includes(`\\dist\\${log_PROJECT_NAME}\\`)) && !line.includes("/utils/log.ts"));
      if (!callerLine) {
        return null;
      }
      const match = callerLine.match(new RegExp(`(src|dist)[\\\\/]${log_PROJECT_NAME}[\\\\/]([^?:]+)`));
      if (!match || !match[2]) {
        return null;
      }
      const path = match[2];
      return path.replace(/\\/g, "/").replace(/\.(vue|ts|js)$/, "").replace(/\/index$/, "");
    } catch (e) {
      console.error(`《${log_PROJECT_NAME}-Log-Debug》: 解析模块名时发生意外错误。`, e);
      return null;
    }
  }
  formatMessage(funcName, message) {
    const mkString = log_logContext.mk ? `（${log_logContext.mk}）` : "";
    return `《${log_PROJECT_NAME}》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;
  }
  debug(funcName, message, obj) {
    if (!log_isDebugEnabled(this.moduleName)) {
      return;
    }
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.debug(formattedMessage, obj);
    } else {
      console.debug(formattedMessage);
    }
  }
  log(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.log(`%c${formattedMessage}`, "color: #3498db;", obj);
    } else {
      console.log(`%c${formattedMessage}`, "color: #3498db;");
    }
  }
  warn(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;", obj);
    } else {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;");
    }
  }
  error(funcName, message, errorObj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (errorObj !== undefined) {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;", errorObj);
    } else {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;");
    }
  }
}

const log = new log_Logger("GSKO-BASE/utils/message");

function getMessageContent(msg) {
  if (!msg) return null;
  let content = null;
  if (typeof msg.mes === "string") {
    content = msg.mes;
  } else if (Array.isArray(msg.swipes)) {
    const sid = Number(msg.swipe_id ?? 0);
    content = msg.swipes[sid] || null;
  } else if (typeof msg.message === "string") {
    content = msg.message;
  }
  if (content === null) {
    return null;
  }
  return content;
}

function escReg(s) {
  return String(s).replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
}

function extractContentForMatching(messages, options = {}) {
  const {mainBodyTags = [], excludeBodyTags = []} = options;
  const segs = [];
  for (const m of messages) {
    let messageContent = getMessageContent(m);
    if (messageContent === null) {
      continue;
    }
    if (excludeBodyTags.length > 0) {
      for (const tagName of excludeBodyTags) {
        const safeTagName = escReg(tagName);
        const containerRe = new RegExp(`<${safeTagName}\\b[^>]*>((?:(?!<${safeTagName}\\b)[\\s\\S])*?)<\\/${safeTagName}>`, "gi");
        const selfClosingRe = new RegExp(`<${safeTagName}\\b[^>]*\\/>`, "gi");
        let oldContent;
        do {
          oldContent = messageContent;
          messageContent = messageContent.replace(containerRe, "");
        } while (oldContent !== messageContent);
        messageContent = messageContent.replace(selfClosingRe, "");
      }
    }
    if (m.role === "user") {
      segs.push(messageContent);
      continue;
    }
    if (mainBodyTags.length > 0) {
      const mainBodySegs = [];
      for (const tagName of mainBodyTags) {
        const safeTagName = escReg(tagName);
        const extractRe = new RegExp(`<${safeTagName}\\b[^>]*>((?:(?!<${safeTagName}\\b)[\\s\\S])*?)<\\/${safeTagName}>`, "gi");
        let match;
        while ((match = extractRe.exec(messageContent)) !== null) {
          mainBodySegs.push(match[1].trim());
        }
      }
      if (mainBodySegs.length > 0) {
        segs.push(mainBodySegs.join("\n"));
      }
    } else {
      segs.push(messageContent);
    }
  }
  const result = segs.join("\n");
  return result;
}

async function matchMessages(keywords, options = {}) {
  const {depth = 5, includeSwipes = false, mainBodyTags, excludeBodyTags} = options;
  const funcName = "matchMessages";
  try {
    if (typeof getChatMessages !== "function") {
      log.warn(funcName, "getChatMessages 函数不可用，无法匹配消息。");
      return [];
    }
    const last = getLastMessageId();
    const begin = Math.max(0, last - (depth - 1));
    const msgs = getChatMessages(`${begin}-${last}`, {
      role: "all",
      hide_state: "all",
      include_swipes: includeSwipes
    });
    const pool = extractContentForMatching(msgs, {
      mainBodyTags,
      excludeBodyTags
    });
    if (!pool) {
      return [];
    }
    log.debug(funcName, `待匹配的文本池: ${pool}`);
    const hits = [];
    for (const kw of keywords) {
      if (!kw) continue;
      const re = new RegExp(escReg(kw), "i");
      if (re.test(pool)) {
        hits.push(kw);
      }
    }
    return hits;
  } catch (e) {
    log.error(funcName, "批量匹配消息时发生异常", e);
    return [];
  }
}

async function updateMessageContent(message, newContent) {
  const oldContent = getMessageContent(message);
  log.debug("updateMessageContent", "更新前的消息内容:", oldContent);
  log.debug("updateMessageContent", "更新后的消息内容:", newContent);
  const updatePayload = {
    message_id: message.message_id
  };
  if (Array.isArray(message.swipes)) {
    const sid = Number(message.swipe_id ?? 0);
    const newSwipes = [ ...message.swipes ];
    newSwipes[sid] = newContent;
    updatePayload.swipes = newSwipes;
  } else {
    updatePayload.message = newContent;
  }
  await setChatMessages([ updatePayload ], {
    refresh: "none"
  });
}

const MainContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "tag-editor-shell"
};

const MainContentvue_type_script_setup_true_lang_ts_hoisted_2 = [ "aria-expanded" ];

const MainContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "tag-editor-toggle-label"
};

const MainContentvue_type_script_setup_true_lang_ts_hoisted_4 = {
  id: "tag-editor-panel",
  class: "tag-editor"
};

const MainContentvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "tag-input-group"
};

const MainContentvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "tag-input-group"
};

const MainContentvue_type_script_setup_true_lang_ts_hoisted_7 = [ "innerHTML" ];

const MainContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "MainContent",
  setup(__props) {
    const logger = new Logger("StatusTab/MainContent");
    const latestMessage = (0, external_Vue_namespaceObject.ref)(null);
    const displayHtml = (0, external_Vue_namespaceObject.ref)("");
    const mainTagsInput = (0, external_Vue_namespaceObject.ref)("");
    const excludeTagsInput = (0, external_Vue_namespaceObject.ref)("");
    const showTagEditor = (0, external_Vue_namespaceObject.ref)(false);
    const tagsToString = tags => tags.join(" | ");
    const stringToTags = str => str.split("|").map(tag => tag.trim()).filter(tag => tag.length > 0);
    const saveTags = () => {
      const newMainBodyTags = stringToTags(mainTagsInput.value);
      const newExcludeBodyTags = stringToTags(excludeTagsInput.value);
      const patch = {
        config: {
          mainBodyTags: newMainBodyTags,
          excludeBodyTags: newExcludeBodyTags
        }
      };
      logger.log("saveTags", "正在保存标签配置...", patch);
      updateEraVariableByObject(patch);
    };
    const toggleTagEditor = () => {
      showTagEditor.value = !showTagEditor.value;
    };
    const extractAndDisplayContent = () => {
      if (!latestMessage.value) {
        logger.log("extractAndDisplayContent", "本地 message 为空，清空正文。");
        displayHtml.value = "";
        return;
      }
      const {message_id} = latestMessage.value;
      const chatVars = getVariables({
        type: "chat"
      });
      let mainBodyTags = [];
      let excludeBodyTags = [];
      if (chatVars?.stat_data?.config) {
        mainBodyTags = chatVars.stat_data.config.mainBodyTags ?? [];
        excludeBodyTags = chatVars.stat_data.config.excludeBodyTags ?? [];
      } else {
        logger.warn("extractAndDisplayContent", "在聊天变量中未找到 stat_data.config。");
      }
      logger.log("extractAndDisplayContent", "使用的标签:", {
        mainBodyTags,
        excludeBodyTags
      });
      const extracted = extractContentForMatching([ latestMessage.value ], {
        mainBodyTags: mainBodyTags.includes("*") ? [] : mainBodyTags,
        excludeBodyTags
      });
      if (extracted) {
        displayHtml.value = extracted;
        logger.debug("extractAndDisplayContent", `已刷新正文，来源消息 ID: ${message_id}`);
      } else {
        logger.warn("extractAndDisplayContent", `消息 ${message_id} 中未找到指定的主内容区块 (main: ${mainBodyTags.join(",")}, exclude: ${excludeBodyTags.join(",")})，清空正文。`);
        displayHtml.value = "";
      }
    };
    (0, external_Vue_namespaceObject.watch)(latestMessage, extractAndDisplayContent, {
      immediate: true,
      deep: true
    });
    const fetchAndUpdateMessage = async () => {
      try {
        const currentMessageId = await getCurrentMessageId();
        if (currentMessageId === null || currentMessageId === undefined) {
          logger.warn("fetchAndUpdateMessage", "无法获取当前消息 ID。");
          latestMessage.value = null;
          return;
        }
        const messages = await getChatMessages(currentMessageId);
        const currentMessage = messages[0];
        if (currentMessage) {
          latestMessage.value = currentMessage;
          logger.log("fetchAndUpdateMessage", `已成功获取并更新消息，ID: ${currentMessageId}`);
        } else {
          logger.warn("fetchAndUpdateMessage", `在消息列表中未找到 ID 为 ${currentMessageId} 的消息。`);
          latestMessage.value = null;
        }
      } catch (error) {
        logger.error("fetchAndUpdateMessage", "获取消息时发生错误:", error);
        latestMessage.value = null;
      }
    };
    (0, external_Vue_namespaceObject.onMounted)(async () => {
      try {
        const chatVars = getVariables({
          type: "chat"
        });
        if (chatVars?.stat_data?.config) {
          mainTagsInput.value = tagsToString(chatVars.stat_data.config.mainBodyTags ?? []);
          excludeTagsInput.value = tagsToString(chatVars.stat_data.config.excludeBodyTags ?? []);
          logger.log("onMounted", "已成功解析并填充标签输入框。");
        } else {
          logger.warn("onMounted", "在聊天变量中未找到 stat_data.config。");
        }
        await fetchAndUpdateMessage();
      } catch (error) {
        logger.error("onMounted", "在挂载过程中获取数据时发生错误:", error);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("section", MainContentvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "tag-editor-toggle",
      type: "button",
      "aria-expanded": showTagEditor.value,
      "aria-controls": "tag-editor-panel",
      onClick: toggleTagEditor
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", MainContentvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(showTagEditor.value ? "收起标签筛选" : "展开标签筛选"), 1), _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "tag-editor-toggle-icon",
      "aria-hidden": "true"
    }, null, -1)) ], 8, MainContentvue_type_script_setup_true_lang_ts_hoisted_2), (0, 
    external_Vue_namespaceObject.createVNode)(external_Vue_namespaceObject.Transition, {
      name: "tag-editor-slide",
      persisted: ""
    }, {
      default: (0, external_Vue_namespaceObject.withCtx)(() => [ (0, external_Vue_namespaceObject.withDirectives)((0, 
      external_Vue_namespaceObject.createElementVNode)("div", MainContentvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
      external_Vue_namespaceObject.createElementVNode)("div", MainContentvue_type_script_setup_true_lang_ts_hoisted_5, [ _cache[3] || (_cache[3] = (0, 
      external_Vue_namespaceObject.createElementVNode)("label", {
        for: "main-tags"
      }, "正文标签:", -1)), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
        id: "main-tags",
        "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => mainTagsInput.value = $event),
        type: "text",
        placeholder: "比如content"
      }, null, 512), [ [ external_Vue_namespaceObject.vModelText, mainTagsInput.value ] ]) ]), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", MainContentvue_type_script_setup_true_lang_ts_hoisted_6, [ _cache[4] || (_cache[4] = (0, 
      external_Vue_namespaceObject.createElementVNode)("label", {
        for: "exclude-tags"
      }, "排除标签:", -1)), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
        id: "exclude-tags",
        "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => excludeTagsInput.value = $event),
        type: "text",
        placeholder: "比如think"
      }, null, 512), [ [ external_Vue_namespaceObject.vModelText, excludeTagsInput.value ] ]) ]), (0, 
      external_Vue_namespaceObject.createElementVNode)("button", {
        class: "save-btn",
        onClick: saveTags
      }, "保存") ], 512), [ [ external_Vue_namespaceObject.vShow, showTagEditor.value ] ]) ]),
      _: 1
    }) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "main-content",
      class: "preserve-format",
      innerHTML: displayHtml.value
    }, null, 8, MainContentvue_type_script_setup_true_lang_ts_hoisted_7) ]));
  }
});

const MainContent_exports_ = (0, exportHelper.A)(MainContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-186515aa" ] ]);

const MainContent = MainContent_exports_;

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-tabs",
  class: "status-tabs"
};

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_2 = [ "data-tab", "onClick" ];

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  id: "status-tab-content-area",
  class: "status-tab-content-area"
};

const StatusTabContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StatusTabContent",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/StatusTab/StatusTabContent");
    const worldMap = (0, external_Vue_namespaceObject.ref)(null);
    const contentBio = (0, external_Vue_namespaceObject.ref)(null);
    const contentSettingsConfig = (0, external_Vue_namespaceObject.ref)(null);
    const fontSizeUiConfig = (0, external_Vue_namespaceObject.ref)(null);
    const tabs = [ {
      id: "main",
      name: "正文"
    }, {
      id: "status",
      name: "世界"
    }, {
      id: "incidents",
      name: "异变啊异变！"
    }, {
      id: "bio",
      name: "履历与关系"
    }, {
      id: "settings",
      name: "设置"
    } ];
    const activeTab = (0, external_Vue_namespaceObject.ref)("main");
    const mainContentRefreshKey = (0, external_Vue_namespaceObject.ref)(0);
    const latestMessage = (0, external_Vue_namespaceObject.ref)(null);
    const contextRef = (0, external_Vue_namespaceObject.ref)(null);
    const statForTabs = (0, external_Vue_namespaceObject.computed)(() => contextRef.value?.statWithoutMeta ?? null);
    const runtimeForTabs = (0, external_Vue_namespaceObject.computed)(() => contextRef.value?.runtime ?? null);
    const switchTab = tabId => {
      logger.log("switchTab", `切换选项卡到: ${tabId}`);
      activeTab.value = tabId;
    };
    const update = context => {
      contextRef.value = context;
      const funcName = "update";
      const {statWithoutMeta, latestMessage: msg} = context || {};
      latestMessage.value = msg || null;
      logger.log(funcName, `接收到更新请求，开始更新所有子组件...`, {
        context
      });
      if (!statWithoutMeta) {
        logger.warn(funcName, "传入的 context 或 statWithoutMeta 为空，无法更新 UI。");
        return;
      }
      fontSizeUiConfig.value = statWithoutMeta?.config?.ui ?? null;
      logger.debug(funcName, "已同步 FontSizeControls 配置", {
        hasUiConfig: !!fontSizeUiConfig.value
      });
      mainContentRefreshKey.value += 1;
      if (worldMap.value && typeof worldMap.value.update === "function") {
        worldMap.value.update(statWithoutMeta);
        logger.debug(funcName, "已调用 WorldMap.update");
      }
      if (contentBio.value && typeof contentBio.value.update === "function") {
        contentBio.value.update(context);
        logger.debug(funcName, "已调用 ContentBio.update");
      }
      contentSettingsConfig.value = statWithoutMeta?.config ?? null;
      logger.debug(funcName, "已同步 ContentSettings 配置", {
        hasConfig: !!contentSettingsConfig.value
      });
      const mainExtraEl = document.getElementById("main-extra");
      if (mainExtraEl) {
        const contentString = typeof statWithoutMeta.附加正文 === "string" ? statWithoutMeta.附加正文 : "";
        mainExtraEl.textContent = contentString;
        logger.debug(funcName, "已更新附加正文", {
          content: contentString.slice(0, 50) + "..."
        });
      }
      logger.log(funcName, "所有子组件更新完成。");
    };
    const handleContentSettingsSaved = payload => {
      logger.log("handleContentSettingsSaved", "设置页保存完成", payload);
    };
    __expose({
      update,
      worldMap,
      contentBio
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ▼ [移植] 这部分 HTML 结构严格复制自 app.vue "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_1, [ ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(tabs, tab => (0, external_Vue_namespaceObject.createElementVNode)("button", {
      key: tab.id,
      "data-tab": tab.id,
      class: (0, external_Vue_namespaceObject.normalizeClass)({
        active: activeTab.value === tab.id
      }),
      onClick: $event => switchTab(tab.id)
    }, (0, external_Vue_namespaceObject.toDisplayString)(tab.name), 11, StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_2)), 64)) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 正文 Tab "), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "content_main",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
        active: activeTab.value === "main"
      } ])
    }, [ (0, external_Vue_namespaceObject.createVNode)(FontSizeControls, {
      "ui-config": fontSizeUiConfig.value
    }, null, 8, [ "ui-config" ]), (0, external_Vue_namespaceObject.createVNode)(MainContent, {
      "latest-message": latestMessage.value,
      "refresh-key": mainContentRefreshKey.value,
      stat: statForTabs.value
    }, null, 8, [ "latest-message", "refresh-key", "stat" ]), _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      id: "main-extra",
      class: "preserve-format"
    }, null, -1)) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 世界 Tab (WorldMap) "), activeTab.value === "status" ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: 0,
      id: "content_status",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
        active: activeTab.value === "status"
      } ])
    }, [ (0, external_Vue_namespaceObject.createVNode)(Map_Map, {
      context: contextRef.value
    }, null, 8, [ "context" ]) ], 2)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 异变 Tab "), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "content_incidents",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
        active: activeTab.value === "incidents"
      } ])
    }, [ (0, external_Vue_namespaceObject.createVNode)(Incidents, {
      stat: statForTabs.value,
      runtime: runtimeForTabs.value
    }, null, 8, [ "stat", "runtime" ]) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 履历与关系 Tab "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      id: "content_bio",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
        active: activeTab.value === "bio"
      } ])
    }, [ (0, external_Vue_namespaceObject.createVNode)(ContentBio, {
      ref_key: "contentBio",
      ref: contentBio
    }, null, 512) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 设置 Tab "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      id: "content_settings",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
        active: activeTab.value === "settings"
      } ])
    }, [ (0, external_Vue_namespaceObject.createVNode)(ContentSettings, {
      config: contentSettingsConfig.value,
      onSaved: handleContentSettingsSaved
    }, null, 8, [ "config" ]) ], 2) ]), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ [移植] 结构结束 ") ]));
  }
});

const StatusTabContent_exports_ = (0, exportHelper.A)(StatusTabContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-089aff66" ] ]);

const StatusTabContent = StatusTabContent_exports_;

const AyaNewsButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsButtonClosed",
  emits: [ "open-news" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "aya-news-button-closed",
      onClick: _cache[0] || (_cache[0] = $event => emit("open-news"))
    }, "文文新闻"));
  }
});

const AyaNewsButtonClosed_exports_ = (0, exportHelper.A)(AyaNewsButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-74e497bf" ] ]);

const AyaNewsButtonClosed = AyaNewsButtonClosed_exports_;

const AyaNewsButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsButtonOpen",
  emits: [ "close-news" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "aya-news-button-open",
      onClick: _cache[0] || (_cache[0] = $event => emit("close-news"))
    }, "文文新闻"));
  }
});

const AyaNewsButtonOpen_exports_ = (0, exportHelper.A)(AyaNewsButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-91ed5eb4" ] ]);

const AyaNewsButtonOpen = AyaNewsButtonOpen_exports_;

const AyaNewsPopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "aya-news-popup",
  class: "aya-news-popup",
  role: "dialog"
};

const AyaNewsPopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsPopup",
  emits: [ "close" ],
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/AyaNews/AyaNewsPopup");
    const updateNews = stat => {
      const funcName = "updateNews";
      if (!stat || typeof stat !== "object") {
        logger.warn(funcName, "调用失败：传入的 stat 无效。", stat);
        return;
      }
      try {
        const newsContent = stat.AyaNews ?? "";
        logger.log(funcName, "将更新新闻文本", {
          preview: String(newsContent).slice(0, 50)
        });
        format_text("aya-news-content-popup", newsContent);
        logger.debug(funcName, "新闻文本已写入 DOM 完成");
      } catch (e) {
        logger.error(funcName, "更新新闻内容时发生异常", e);
      }
    };
    __expose({
      updateNews
    });
    (0, external_Vue_namespaceObject.onMounted)(() => {});
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", AyaNewsPopupvue_type_script_setup_true_lang_ts_hoisted_1, [ ..._cache[0] || (_cache[0] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📰"), (0, external_Vue_namespaceObject.createTextVNode)("文文新闻") ], -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      id: "aya-news-content-popup",
      class: "news-body preserve-format"
    }, "—", -1) ]) ]));
  }
});

const AyaNewsPopup_exports_ = (0, exportHelper.A)(AyaNewsPopupvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-fe9df0ce" ] ]);

const AyaNewsPopup = AyaNewsPopup_exports_;

const AyaNewsContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "aya-news-container"
};

const AyaNewsContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsContainer",
  setup(__props, {expose: __expose}) {
    const newsVisible = (0, external_Vue_namespaceObject.ref)(false);
    const ayaNewsPopup = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      updateNews: stat => {
        ayaNewsPopup.value?.updateNews(stat);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", AyaNewsContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !newsVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(AyaNewsButtonClosed, {
      key: 0,
      onOpenNews: _cache[0] || (_cache[0] = $event => newsVisible.value = true)
    })) : ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(AyaNewsButtonOpen, {
      key: 1,
      onCloseNews: _cache[1] || (_cache[1] = $event => newsVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(AyaNewsPopup, {
      ref_key: "ayaNewsPopup",
      ref: ayaNewsPopup
    }, null, 512), [ [ external_Vue_namespaceObject.vShow, newsVisible.value ] ]) ]));
  }
});

const AyaNewsContainer_exports_ = (0, exportHelper.A)(AyaNewsContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-5c15b776" ] ]);

const AyaNewsContainer = AyaNewsContainer_exports_;

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "GensokyoOrigin-RoleCard-portrait-container"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_2 = [ "src", "alt" ];

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "GensokyoOrigin-RoleCard-portrait-placeholder"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "GensokyoOrigin-RoleCard-content"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "GensokyoOrigin-RoleCard-title-section"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "GensokyoOrigin-RoleCard-name"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "GensokyoOrigin-RoleCard-meta"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "GensokyoOrigin-RoleCard-attrs"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_9 = [ "data-key" ];

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_10 = {
  class: "k"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_11 = [ "title" ];

const RoleCardvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleCard",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    }
  },
  emits: [ "show-details" ],
  setup(__props) {
    const props = __props;
    const particleEmitter = (0, external_Vue_namespaceObject.ref)(null);
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionState = (0, external_Vue_namespaceObject.computed)(() => {
      if (affectionValue.value >= loveThreshold.value) return "love";
      if (affectionValue.value <= hateThreshold.value) return "hate";
      return "neutral";
    });
    const statChar = (0, external_Vue_namespaceObject.computed)(() => {
      const id = props.character?.id;
      const chars = props.statWithoutMeta?.chars || {};
      return id ? chars?.[id] ?? null : null;
    });
    const getAttr = key => {
      const fromStat = (statChar.value && statChar.value[key]) ?? undefined;
      if (fromStat !== undefined && fromStat !== null && `${fromStat}`.trim() !== "") return String(fromStat);
      const fromCharacter = props.character?.[key];
      if (fromCharacter !== undefined && fromCharacter !== null && `${fromCharacter}`.trim() !== "") return String(fromCharacter);
      return "";
    };
    const displayAttrs = (0, external_Vue_namespaceObject.computed)(() => [ {
      k: "目标",
      v: getAttr("目标")
    }, {
      k: "身体状况",
      v: getAttr("身体状况")
    }, {
      k: "内心想法",
      v: getAttr("内心想法")
    } ]);
    (0, external_Vue_namespaceObject.watch)(affectionState, (newState, oldState) => {
      if (newState !== oldState && particleEmitter.value) {
        if (newState === "love") {
          particleEmitter.value.burst("heart", 10);
        } else if (newState === "hate") {
          particleEmitter.value.burst("skull", 8);
        }
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 组件模板开始 "), (0, external_Vue_namespaceObject.createCommentVNode)(" 外层卡片容器：点击整卡上抛详情事件，内部包含头部、好感度、属性区与粒子发射器 "), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 中文注释 "), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-RoleCard-wrapper",
      onClick: _cache[1] || (_cache[1] = $event => _ctx.$emit("show-details", __props.character))
    }, [ (0, external_Vue_namespaceObject.createCommentVNode)(" 点击整卡触发 show-details 事件 "), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 主要立绘 "), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_1, [ __props.character.pic ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("img", {
      key: 0,
      src: __props.character.pic,
      alt: __props.character.name,
      class: "GensokyoOrigin-RoleCard-portrait"
    }, null, 8, RoleCardvue_type_script_setup_true_lang_ts_hoisted_2)) : ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, {
      key: 1
    }, [ (0, external_Vue_namespaceObject.createCommentVNode)(" 如果没有图片，显示一个占位符 "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, (0, external_Vue_namespaceObject.toDisplayString)(__props.character.name.slice(0, 1)), 1) ]) ], 2112)) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 内容区域 "), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 名称与地区 "), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_5, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_6, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_7, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character["所在地区"] || "未知"), 1) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 好感度展示 "), (0, external_Vue_namespaceObject.createVNode)(AffectionDisplay, {
      character: __props.character,
      "stat-without-meta": __props.statWithoutMeta,
      runtime: __props.runtime,
      size: "small"
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]), (0, external_Vue_namespaceObject.createCommentVNode)(" 角色属性 "), (0, 
    external_Vue_namespaceObject.createElementVNode)("section", RoleCardvue_type_script_setup_true_lang_ts_hoisted_8, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(displayAttrs.value, item => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: item.k,
      class: "attr",
      "data-key": item.k,
      onClick: _cache[0] || (_cache[0] = (0, external_Vue_namespaceObject.withModifiers)(() => {}, [ "stop" ]))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", RoleCardvue_type_script_setup_true_lang_ts_hoisted_10, (0, 
    external_Vue_namespaceObject.toDisplayString)(item.k), 1), (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "v",
      title: item.v || "待填充"
    }, (0, external_Vue_namespaceObject.toDisplayString)(item.v || "待填充"), 9, RoleCardvue_type_script_setup_true_lang_ts_hoisted_11) ], 8, RoleCardvue_type_script_setup_true_lang_ts_hoisted_9))), 128)) ]) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 粒子发射器：根据爱/恨态激活，状态切换时触发一次性爆发 "), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 中文注释 "), (0, external_Vue_namespaceObject.createVNode)(ParticleEmitter, {
      ref_key: "particleEmitter",
      ref: particleEmitter,
      active: affectionState.value === "love" || affectionState.value === "hate",
      "particle-type": affectionState.value === "hate" ? "skull" : "heart",
      "emission-rate": 2
    }, null, 8, [ "active", "particle-type" ]), (0, external_Vue_namespaceObject.createCommentVNode)(" 粒子发射器结束 ") ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 外层卡片容器结束 ") ], 2112));
  }
});

const RoleCard_exports_ = RoleCardvue_type_script_setup_true_lang_ts;

const RoleCard = RoleCard_exports_;

const RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "role-ribbon-container"
};

const RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_2 = {
  key: 0,
  class: "role-card-placeholder"
};

const ribbonScrollStep = 320;

const RoleRibbonContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleRibbonContainer",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("RoleRibbon");
    const state = (0, external_Vue_namespaceObject.reactive)({
      stat: null,
      runtime: null
    });
    const ribbon = (0, external_Vue_namespaceObject.ref)(null);
    const selectedCharacter = (0, external_Vue_namespaceObject.ref)(null);
    const nearbyCharacters = (0, external_Vue_namespaceObject.computed)(() => {
      const funcName = "nearbyCharacters";
      const coLocatedIds = state.runtime?.character?.partitions?.coLocated;
      logger.debug(funcName, "coLocatedIds:", external_default().cloneDeep(coLocatedIds));
      if (!coLocatedIds || !state.stat?.chars || !state.runtime?.character?.chars) {
        logger.debug(funcName, "依赖数据不完整，返回空数组。");
        return [];
      }
      return coLocatedIds.map(charId => {
        const charStat = state.stat?.chars?.[charId];
        const charRuntime = state.runtime?.character?.chars?.[charId];
        logger.debug(funcName, `[${charId}] charStat:`, external_default().cloneDeep(charStat));
        logger.debug(funcName, `[${charId}] charRuntime:`, external_default().cloneDeep(charRuntime));
        if (!charStat) {
          logger.warn(funcName, `在 stat.chars 中未找到角色 ${charId} 的数据，已跳过。`);
          return null;
        }
        const displayName = charRuntime?.name || charId;
        logger.debug(funcName, `[${charId}] 最终显示名称: ${displayName}`);
        return {
          id: charId,
          ...charStat,
          ...charRuntime,
          name: displayName
        };
      }).filter(Boolean);
    });
    const scroll = direction => {
      ribbon.value?.scrollBy({
        left: direction * ribbonScrollStep,
        behavior: "smooth"
      });
    };
    const updateRibbon = context => {
      const funcName = "updateRibbon";
      logger.debug(funcName, "接收到新的上下文数据", {
        stat: external_default().cloneDeep(context.statWithoutMeta),
        runtime: external_default().cloneDeep(context.runtime)
      });
      state.stat = context.statWithoutMeta;
      state.runtime = context.runtime;
    };
    __expose({
      updateRibbon
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "ribbon-left",
      class: "ribbon-arrow left",
      onClick: _cache[0] || (_cache[0] = $event => scroll(-1))
    }, "‹"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "ribbon-right",
      class: "ribbon-arrow right",
      onClick: _cache[1] || (_cache[1] = $event => scroll(1))
    }, "›"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "role-ribbon",
      ref_key: "ribbon",
      ref: ribbon,
      class: "role-ribbon"
    }, [ ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(nearbyCharacters.value, char => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(RoleCard, {
      key: char.id,
      character: char,
      "stat-without-meta": state.stat,
      runtime: state.runtime,
      onShowDetails: _cache[2] || (_cache[2] = $event => selectedCharacter.value = $event)
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]))), 128)), !nearbyCharacters.value.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_2, "附近暂无角色")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ], 512), selectedCharacter.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(RoleDetailPopup, {
      key: 0,
      character: selectedCharacter.value,
      "stat-without-meta": state.stat,
      runtime: state.runtime,
      onClose: _cache[3] || (_cache[3] = $event => selectedCharacter.value = null)
    }, null, 8, [ "character", "stat-without-meta", "runtime" ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const RoleRibbonContainer_exports_ = (0, exportHelper.A)(RoleRibbonContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-1fb718a8" ] ]);

const RoleRibbonContainer = RoleRibbonContainer_exports_;

const TimeButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeButtonClosed",
  props: {
    clockInfo: {}
  },
  emits: [ "open-calendar" ],
  setup(__props) {
    const props = __props;
    const timeText = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.clockInfo) return "—:—";
      return props.clockInfo.hm ? `${props.clockInfo.hm} · ${props.clockInfo.periodName || ""}` : props.clockInfo.iso || "—";
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-time-closed",
      class: "banner-chip",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("open-calendar"))
    }, [ _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⏰", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(timeText.value), 1) ]));
  }
});

const TimeButtonClosed_exports_ = (0, exportHelper.A)(TimeButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-74147b2e" ] ]);

const TimeButtonClosed = TimeButtonClosed_exports_;

const TimeButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeButtonOpen",
  emits: [ "close-calendar" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-time-open",
      class: "banner-chip-open",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close-calendar"))
    }, [ ..._cache[1] || (_cache[1] = [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📅", -1), (0, external_Vue_namespaceObject.createElementVNode)("span", null, "日历", -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "close-icon"
    }, "收起", -1) ]) ]));
  }
});

const TimeButtonOpen_exports_ = (0, exportHelper.A)(TimeButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-4c237e38" ] ]);

const TimeButtonOpen = TimeButtonOpen_exports_;

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "cal-day-container"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_2 = [ "data-importance" ];

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "dnum"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_4 = {
  key: 1,
  class: "cal-day-placeholder"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_5 = {
  key: 2,
  class: "fest-popover"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "fest-header"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_7 = {
  key: 0,
  class: "fest-host"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_8 = {
  key: 0,
  class: "fest-customs"
};

const CalendarDayvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CalendarDay",
  props: {
    day: {}
  },
  setup(__props) {
    const props = __props;
    const hasFestivals = (0, external_Vue_namespaceObject.computed)(() => !!(props.day.festivals && props.day.festivals.length > 0));
    const showPopover = (0, external_Vue_namespaceObject.ref)(false);
    const highestImportance = (0, external_Vue_namespaceObject.computed)(() => {
      if (!hasFestivals.value || !props.day.festivals) return 0;
      return Math.max(...props.day.festivals.map(f => f.importance ?? 0));
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_1, [ !__props.day.isPlaceholder ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      key: 0,
      type: "button",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "cal-day-btn", {
        today: __props.day.isToday,
        "has-fest": hasFestivals.value
      } ]),
      "data-importance": highestImportance.value,
      onMouseenter: _cache[0] || (_cache[0] = $event => showPopover.value = hasFestivals.value),
      onMouseleave: _cache[1] || (_cache[1] = $event => showPopover.value = false)
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.day.date), 1) ], 42, CalendarDayvue_type_script_setup_true_lang_ts_hoisted_2)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_4)), showPopover.value && hasFestivals.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_5, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(__props.day.festivals, fest => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: fest.name,
      class: "fest-item"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, (0, external_Vue_namespaceObject.toDisplayString)(fest.name), 1), fest.host ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("span", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_7, "@ " + (0, 
    external_Vue_namespaceObject.toDisplayString)(fest.host), 1)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]), fest.customs?.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("ul", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_8, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(fest.customs, (custom, index) => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("li", {
      key: index
    }, (0, external_Vue_namespaceObject.toDisplayString)(custom), 1))), 128)) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]))), 128)) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const CalendarDay_exports_ = (0, exportHelper.A)(CalendarDayvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-42a71206" ] ]);

const CalendarDay = CalendarDay_exports_;

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "cal-content",
  class: "cal-content",
  role: "region"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "cal-head"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "cal-title"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_4 = {
  id: "cal-month",
  class: "month"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_5 = {
  id: "cal-year",
  class: "year"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "cal-nav"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "cal-body"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_8 = {
  id: "cal-grid",
  class: "cal-grid"
};

const CalendarContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CalendarContent",
  props: {
    clockInfo: {}
  },
  setup(__props) {
    const props = __props;
    const displayMonth = (0, external_Vue_namespaceObject.ref)(new Date);
    const monthLabel = (0, external_Vue_namespaceObject.computed)(() => `${displayMonth.value.getMonth() + 1}月`);
    const yearLabel = (0, external_Vue_namespaceObject.computed)(() => `${displayMonth.value.getFullYear()}年`);
    const festivals = (0, external_Vue_namespaceObject.computed)(() => props.clockInfo?.festivals || {});
    const updateMonth = direction => {
      const newMonth = new Date(displayMonth.value);
      newMonth.setMonth(newMonth.getMonth() + (direction === "prev" ? -1 : 1));
      displayMonth.value = newMonth;
    };
    const resetMonth = () => {
      displayMonth.value = props.clockInfo?.iso ? parseIsoAsLocal(props.clockInfo.iso) : new Date;
    };
    const calendarDays = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.clockInfo) return [];
      const year = displayMonth.value.getFullYear();
      const month = displayMonth.value.getMonth();
      const today = props.clockInfo.iso ? parseIsoAsLocal(props.clockInfo.iso) : new Date;
      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);
      const daysInMonth = lastDayOfMonth.getDate();
      const startDayOfWeek = (firstDayOfMonth.getDay() + 6) % 7;
      const days = [];
      for (let i = 0; i < startDayOfWeek; i++) {
        days.push({
          isPlaceholder: true
        });
      }
      for (let i = 1; i <= daysInMonth; i++) {
        const dayFestivals = Object.values(festivals.value).filter(f => f.month === month + 1 && i >= f.start_day && i <= f.end_day);
        const isToday = year === today.getFullYear() && month === today.getMonth() && i === today.getDate();
        days.push({
          date: i,
          isToday,
          isPlaceholder: false,
          festivals: dayFestivals
        });
      }
      return days;
    });
    (0, external_Vue_namespaceObject.watch)(() => props.clockInfo, newClockInfo => {
      if (newClockInfo?.iso) {
        displayMonth.value = parseIsoAsLocal(newClockInfo.iso);
      }
    }, {
      immediate: true
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_4, (0, 
    external_Vue_namespaceObject.toDisplayString)(monthLabel.value), 1), (0, external_Vue_namespaceObject.createElementVNode)("span", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_5, (0, 
    external_Vue_namespaceObject.toDisplayString)(yearLabel.value), 1) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-prev",
      class: "cal-btn",
      title: "上一月",
      onClick: _cache[0] || (_cache[0] = $event => updateMonth("prev"))
    }, "◀"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-today",
      class: "cal-btn",
      title: "回到今天",
      onClick: resetMonth
    }, "●"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-next",
      class: "cal-btn",
      title: "下一月",
      onClick: _cache[1] || (_cache[1] = $event => updateMonth("next"))
    }, "▶") ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_7, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createStaticVNode)('<div class="cal-week" data-v-7ee51604><div class="w" data-v-7ee51604>一</div><div class="w" data-v-7ee51604>二</div><div class="w" data-v-7ee51604>三</div><div class="w" data-v-7ee51604>四</div><div class="w" data-v-7ee51604>五</div><div class="w" data-v-7ee51604>六</div><div class="w" data-v-7ee51604>日</div></div>', 1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_8, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(calendarDays.value, (day, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(CalendarDay, {
      key: index,
      day
    }, null, 8, [ "day" ]))), 128)) ]) ]) ]));
  }
});

const CalendarContent_exports_ = (0, exportHelper.A)(CalendarContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-7ee51604" ] ]);

const CalendarContent = CalendarContent_exports_;

const TimeContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "time-container"
};

const TimeContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeContainer",
  props: {
    stat: {},
    runtime: {}
  },
  setup(__props) {
    const props = __props;
    const calendarVisible = (0, external_Vue_namespaceObject.ref)(false);
    const clockInfo = (0, external_Vue_namespaceObject.computed)(() => {
      const clockNow = props.runtime?.clock?.now;
      const festivals = props.stat?.festivals_list;
      if (clockNow && festivals) {
        return {
          ...clockNow,
          festivals
        };
      }
      return null;
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", TimeContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !calendarVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(TimeButtonClosed, {
      key: 0,
      onOpenCalendar: _cache[0] || (_cache[0] = $event => calendarVisible.value = true),
      "clock-info": clockInfo.value
    }, null, 8, [ "clock-info" ])) : ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(TimeButtonOpen, {
      key: 1,
      onCloseCalendar: _cache[1] || (_cache[1] = $event => calendarVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(CalendarContent, {
      "clock-info": clockInfo.value
    }, null, 8, [ "clock-info" ]), [ [ external_Vue_namespaceObject.vShow, calendarVisible.value ] ]) ]));
  }
});

const TimeContainer_exports_ = (0, exportHelper.A)(TimeContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-6d680f10" ] ]);

const TimeContainer = TimeContainer_exports_;

const WeatherButtonClosedvue_type_script_setup_true_lang_ts_hoisted_1 = [ "disabled" ];

const WeatherButtonClosedvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "summary"
};

const WeatherButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherButtonClosed",
  props: {
    summary: {},
    disabled: {
      type: Boolean
    }
  },
  emits: [ "open-weather" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-weather-closed",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "banner-chip", {
        "banner-chip--disabled": __props.disabled
      } ]),
      disabled: __props.disabled,
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("open-weather"))
    }, [ _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🌤️", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", WeatherButtonClosedvue_type_script_setup_true_lang_ts_hoisted_2, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.summary), 1) ], 10, WeatherButtonClosedvue_type_script_setup_true_lang_ts_hoisted_1));
  }
});

const WeatherButtonClosed_exports_ = (0, exportHelper.A)(WeatherButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-388e9674" ] ]);

const WeatherButtonClosed = WeatherButtonClosed_exports_;

const WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "open-left"
};

const WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "open-text"
};

const WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "summary"
};

const WeatherButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherButtonOpen",
  props: {
    summary: {}
  },
  emits: [ "close-weather" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-weather-open",
      class: "banner-chip-open",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close-weather"))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_1, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "☀️", -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_2, [ _cache[1] || (_cache[1] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "title"
    }, "天气详情", -1)), (0, external_Vue_namespaceObject.createElementVNode)("small", WeatherButtonOpenvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.summary), 1) ]) ]), _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "close-icon"
    }, "收起", -1)) ]));
  }
});

const WeatherButtonOpen_exports_ = (0, exportHelper.A)(WeatherButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-162a8616" ] ]);

const WeatherButtonOpen = WeatherButtonOpen_exports_;

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "weather-content"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_2 = {
  key: 0,
  class: "current-weather"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "current-header"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "header-left"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "label"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "date"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "temperature"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "current-body"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_9 = {
  class: "condition"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_10 = {
  class: "narrative"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_11 = {
  class: "current-stats"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_12 = {
  key: 1,
  class: "forecast-list"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_13 = {
  class: "item-header"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_14 = {
  class: "label"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_15 = {
  class: "date"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_16 = {
  class: "condition"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_17 = {
  class: "temp"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_18 = {
  class: "meta"
};

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_19 = {
  key: 2,
  class: "generated-at"
};

const WeatherContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherContent",
  props: {
    current: {},
    forecast: {},
    generatedAt: {}
  },
  setup(__props) {
    const props = __props;
    const generatedLabel = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.generatedAt) {
        return null;
      }
      const date = new Date(props.generatedAt);
      if (Number.isNaN(date.getTime())) {
        return null;
      }
      return date.toLocaleString("zh-CN", {
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        hour12: false
      });
    });
    function formatPercent(value) {
      if (typeof value !== "number" || Number.isNaN(value)) {
        return "—";
      }
      return `${Math.round(value * 100)}%`;
    }
    function formatTemperature(day) {
      const {maxC, minC} = day.temperature;
      return `${maxC}° / ${minC}°`;
    }
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_1, [ __props.current ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("section", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("header", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_5, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.current.label), 1), (0, external_Vue_namespaceObject.createElementVNode)("span", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_6, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.current.dateText), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_7, (0, 
    external_Vue_namespaceObject.toDisplayString)(formatTemperature(__props.current)), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_8, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_9, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.current.condition.label), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_10, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.current.narrative), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("ul", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_11, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("li", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "降水概率", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, (0, external_Vue_namespaceObject.toDisplayString)(formatPercent(__props.current.precipitationChance)), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("li", null, [ _cache[1] || (_cache[1] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "湿度", -1)), (0, external_Vue_namespaceObject.createElementVNode)("strong", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(formatPercent(__props.current.humidity)), 1) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("li", null, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("span", null, "风力", -1)), (0, external_Vue_namespaceObject.createElementVNode)("strong", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.current.windLevel) + "级", 1) ]) ]) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), __props.forecast.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("section", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_12, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(__props.forecast, item => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("article", {
      key: item.label + item.dateText,
      class: "forecast-item"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_13, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_14, (0, 
    external_Vue_namespaceObject.toDisplayString)(item.label), 1), (0, external_Vue_namespaceObject.createElementVNode)("span", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_15, (0, 
    external_Vue_namespaceObject.toDisplayString)(item.dateText), 1) ]), (0, external_Vue_namespaceObject.createElementVNode)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_16, (0, 
    external_Vue_namespaceObject.toDisplayString)(item.condition.label), 1), (0, external_Vue_namespaceObject.createElementVNode)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_17, (0, 
    external_Vue_namespaceObject.toDisplayString)(formatTemperature(item)), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_18, " 降水 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(formatPercent(item.precipitationChance)) + " · 湿度 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(formatPercent(item.humidity)) + " · 风 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(item.windLevel) + "级 ", 1) ]))), 128)) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), generatedLabel.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("p", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_19, "更新于 " + (0, 
    external_Vue_namespaceObject.toDisplayString)(generatedLabel.value), 1)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const WeatherContent_exports_ = (0, exportHelper.A)(WeatherContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-05fe1e8e" ] ]);

const WeatherContent = WeatherContent_exports_;

const WeatherContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "weather-container"
};

const WeatherContainervue_type_script_setup_true_lang_ts_hoisted_2 = {
  key: 3,
  class: "weather-empty"
};

const WeatherContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherContainer",
  props: {
    runtime: {
      type: Object,
      required: true
    }
  },
  setup(__props) {
    const props = __props;
    const weatherVisible = (0, external_Vue_namespaceObject.ref)(false);
    const weatherRuntime = (0, external_Vue_namespaceObject.computed)(() => props.runtime?.weather ?? null);
    const generatedAtISO = (0, external_Vue_namespaceObject.computed)(() => weatherRuntime.value?.generatedAtISO ?? null);
    const anchorDate = (0, external_Vue_namespaceObject.computed)(() => parseAnchorDate(weatherRuntime.value?.anchorDayISO));
    const forecastWithLabels = (0, external_Vue_namespaceObject.computed)(() => decorateForecast(weatherRuntime.value, anchorDate.value));
    const currentWeather = (0, external_Vue_namespaceObject.computed)(() => forecastWithLabels.value[0] ?? null);
    const upcomingForecast = (0, external_Vue_namespaceObject.computed)(() => forecastWithLabels.value.length > 1 ? forecastWithLabels.value.slice(1, 6) : []);
    const hasWeather = (0, external_Vue_namespaceObject.computed)(() => Boolean(currentWeather.value));
    const currentSummary = (0, external_Vue_namespaceObject.computed)(() => currentWeather.value?.condition.label ?? "天气未刷新");
    const handleOpen = () => {
      if (!hasWeather.value) {
        return;
      }
      weatherVisible.value = true;
    };
    const handleClose = () => {
      weatherVisible.value = false;
    };
    (0, external_Vue_namespaceObject.watch)(hasWeather, ready => {
      if (!ready) {
        weatherVisible.value = false;
      }
    });
    function parseAnchorDate(anchorISO) {
      if (!anchorISO) {
        return null;
      }
      const date = new Date(`${anchorISO}T00:00:00Z`);
      return Number.isNaN(date.getTime()) ? null : date;
    }
    function decorateForecast(runtime, baseDate) {
      const days = runtime?.days ?? [];
      return days.map((day, index) => {
        const date = baseDate ? new Date(baseDate.getTime() + index * 864e5) : null;
        return {
          ...day,
          label: labelForIndex(index, date),
          dateText: formatDateLabel(date, index)
        };
      });
    }
    function labelForIndex(index, date) {
      if (index === 0) return "今天";
      if (index === 1) return "明天";
      if (index === 2) return "后天";
      return date ? date.toLocaleDateString("zh-CN", {
        weekday: "short"
      }) : `+${index}天`;
    }
    function formatDateLabel(date, index) {
      if (!date) {
        return `+${index}天`;
      }
      return `${date.getMonth() + 1}月${date.getDate()}日`;
    }
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", WeatherContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !weatherVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(WeatherButtonClosed, {
      key: 0,
      summary: currentSummary.value,
      disabled: !hasWeather.value,
      onOpenWeather: handleOpen
    }, null, 8, [ "summary", "disabled" ])) : ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(WeatherButtonOpen, {
      key: 1,
      summary: currentSummary.value,
      onCloseWeather: handleClose
    }, null, 8, [ "summary" ])), hasWeather.value ? (0, external_Vue_namespaceObject.withDirectives)(((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(WeatherContent, {
      key: 2,
      current: currentWeather.value,
      forecast: upcomingForecast.value,
      "generated-at": generatedAtISO.value
    }, null, 8, [ "current", "forecast", "generated-at" ])), [ [ external_Vue_namespaceObject.vShow, weatherVisible.value ] ]) : (0, 
    external_Vue_namespaceObject.withDirectives)(((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", WeatherContainervue_type_script_setup_true_lang_ts_hoisted_2, "暂未生成天气数据，请等待下一次时间推进。", 512)), [ [ external_Vue_namespaceObject.vShow, weatherVisible.value ] ]) ]));
  }
});

const WeatherContainer_exports_ = (0, exportHelper.A)(WeatherContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-10d6ba33" ] ]);

const WeatherContainer = WeatherContainer_exports_;

const StatusBannerContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-banner",
  class: "status-banner"
};

const StatusBannerContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StatusBannerContent",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/StatusBanner/StatusBannerContent");
    const statData = (0, external_Vue_namespaceObject.ref)(null);
    const runtimeData = (0, external_Vue_namespaceObject.ref)(null);
    const update = ({statWithoutMeta, runtime}) => {
      const funcName = "update";
      logger.log(funcName, "状态横幅内容区开始更新，接收到的数据：", {
        statWithoutMeta,
        runtime
      });
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 statWithoutMeta 无效。", {
          statWithoutMeta,
          runtime
        });
        return;
      }
      statData.value = statWithoutMeta;
      runtimeData.value = runtime;
    };
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ===== 状态横幅：时间（可点弹日历） | 天气（预留点击） ===== "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", StatusBannerContentvue_type_script_setup_true_lang_ts_hoisted_1, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "banner-title"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📡"), (0, external_Vue_namespaceObject.createElementVNode)("span", null, "世界状态") ], -1)), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 日期和日历组件 "), (0, external_Vue_namespaceObject.createVNode)(TimeContainer, {
      ref: "timeContainer",
      stat: statData.value,
      runtime: runtimeData.value
    }, null, 8, [ "stat", "runtime" ]), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "banner-sep",
      "aria-hidden": "true"
    }, null, -1)), (0, external_Vue_namespaceObject.createCommentVNode)(" 天气组件 "), (0, 
    external_Vue_namespaceObject.createVNode)(WeatherContainer, {
      runtime: runtimeData.value
    }, null, 8, [ "runtime" ]) ]) ], 2112));
  }
});

const StatusBannerContent_exports_ = (0, exportHelper.A)(StatusBannerContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-82d21eb8" ] ]);

const StatusBannerContent = StatusBannerContent_exports_;

const ThemeTogglevue_type_script_setup_true_lang_ts_hoisted_1 = [ "aria-label", "title", "aria-pressed" ];

const LIGHT = "light";

const DARK = "dark";

const ThemeTogglevue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ThemeToggle",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/ThemeToggle");
    const currentTheme = (0, external_Vue_namespaceObject.ref)(LIGHT);
    const icon = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "🌙" : "🌞");
    const ariaLabel = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "切换为黑夜模式" : "切换为白日模式");
    const title = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "切换为黑夜模式" : "切换为白日模式");
    const isDark = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === DARK);
    const applyThemeToDOM = theme => {
      const root = document.documentElement;
      if (root) {
        root.setAttribute("data-theme", theme);
        logger.log("applyThemeToDOM", `已将主题应用到 DOM: ${theme}`);
      } else {
        logger.warn("applyThemeToDOM", "未找到 document.documentElement 元素。");
      }
    };
    const updateTheme = context => {
      const funcName = "updateTheme";
      const {statWithoutMeta} = context || {};
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 context 或 statWithoutMeta 无效。", context);
        return;
      }
      const newTheme = statWithoutMeta.config?.ui?.theme;
      const validatedTheme = newTheme === DARK ? DARK : LIGHT;
      currentTheme.value = validatedTheme;
      applyThemeToDOM(validatedTheme);
      logger.log(funcName, `从 statWithoutMeta 更新主题为: ${validatedTheme}`);
    };
    (0, external_Vue_namespaceObject.onMounted)(() => {
      const funcName = "onMounted";
      const btn = document.getElementById("theme-toggle");
      if (btn) {
        btn.onclick = () => {
          const nextTheme = currentTheme.value === DARK ? LIGHT : DARK;
          logger.log(`${funcName}:onclick`, `按钮被点击，准备切换到主题: ${nextTheme}`);
          currentTheme.value = nextTheme;
          applyThemeToDOM(nextTheme);
          const updateObject = {
            config: {
              ui: {
                theme: nextTheme
              }
            }
          };
          updateEraVariableByObject(updateObject);
          logger.log(`${funcName}:onclick`, `已通过 eraWriter 请求更新主题变量为:`, updateObject);
        };
        logger.log(funcName, "主题切换按钮的点击事件已成功绑定。");
      } else {
        logger.warn(funcName, "未找到 #theme-toggle 按钮元素，事件绑定失败。");
      }
    });
    __expose({
      updateTheme
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 主题切换按钮 "), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "theme-toggle",
      class: "theme-toggle",
      "aria-label": ariaLabel.value,
      title: title.value,
      "aria-pressed": isDark.value
    }, (0, external_Vue_namespaceObject.toDisplayString)(icon.value), 9, ThemeTogglevue_type_script_setup_true_lang_ts_hoisted_1) ], 2112));
  }
});

const ThemeToggle_exports_ = (0, exportHelper.A)(ThemeTogglevue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-ff947948" ] ]);

const ThemeToggle = ThemeToggle_exports_;

const UserStateButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateButtonClosed",
  emits: [ "open-sidebar" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "user-state-button-closed",
      onClick: _cache[0] || (_cache[0] = $event => emit("open-sidebar"))
    }, "用户信息"));
  }
});

const UserStateButtonClosed_exports_ = (0, exportHelper.A)(UserStateButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-adf20512" ] ]);

const UserStateButtonClosed = UserStateButtonClosed_exports_;

const UserStateButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateButtonOpen",
  emits: [ "close-sidebar" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "user-state-button-open",
      onClick: _cache[0] || (_cache[0] = $event => emit("close-sidebar"))
    }, "用户信息"));
  }
});

const UserStateButtonOpen_exports_ = (0, exportHelper.A)(UserStateButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-2c96c0f8" ] ]);

const UserStateButtonOpen = UserStateButtonOpen_exports_;

const UserStatePopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "user-state-popup",
  class: "user-state-popup",
  role: "region",
  "aria-label": "用户状态"
};

const UserStatePopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStatePopup",
  emits: [ "close" ],
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/UserState/UserStatePopup");
    const style = (0, external_Vue_namespaceObject.ref)({});
    const positionPopup = _anchorEl => {
      style.value = {};
    };
    const updateUserStatus = (stat, anchorEl) => {
      if (anchorEl) {
        positionPopup(anchorEl);
      }
      const funcName = "updateUserStatus";
      logger.debug(funcName, "函数入口，接收到的 stat:", stat);
      if (!stat || typeof stat !== "object" || !stat.user) {
        logger.warn(funcName, "调用失败：传入的 stat 无效或缺少 user 属性。", stat);
        return;
      }
      const {user} = stat;
      const map = [ [ "user-name-popup", user.姓名 ], [ "user-identity-popup", user.身份 ], [ "user-gender-popup", user.性别 ], [ "user-age-popup", user.年龄 ], [ "user-abilities-popup", user.特殊能力 ], [ "user-location-popup", user.所在地区 ], [ "user-home-popup", user.居住地区 ] ];
      map.forEach(([id, value]) => {
        const displayValue = value ?? "—";
        logger.debug(funcName, `[写入DOM] 准备向 #${id} 写入内容:`, displayValue);
        format_text(id, displayValue);
      });
      logger.debug(funcName, "所有字段更新完成。");
    };
    __expose({
      updateUserStatus,
      positionPopup
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", UserStatePopupvue_type_script_setup_true_lang_ts_hoisted_1, [ ..._cache[0] || (_cache[0] = [ (0, 
    external_Vue_namespaceObject.createStaticVNode)('<h4 data-v-a159b4b2><span class="emoji" data-v-a159b4b2>👤</span>用户状态</h4><div class="sidebar-content" data-v-a159b4b2><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>📝</span>姓名:</span> <span id="user-name-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>🪪</span>身份:</span> <span id="user-identity-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>⚧️</span>性别:</span> <span id="user-gender-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>🎂</span>年龄:</span> <span id="user-age-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>✨</span>特殊能力:</span> <span id="user-abilities-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>📍</span>所在地区:</span> <span id="user-location-popup" data-v-a159b4b2>—</span></p><p data-v-a159b4b2><span class="label" data-v-a159b4b2><span class="emoji" data-v-a159b4b2>🏠</span>居住地区:</span> <span id="user-home-popup" data-v-a159b4b2>—</span></p></div>', 2) ]) ]));
  }
});

const UserStatePopup_exports_ = (0, exportHelper.A)(UserStatePopupvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-a159b4b2" ] ]);

const UserStatePopup = UserStatePopup_exports_;

const UserStateContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "user-state-container"
};

const UserStateContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateContainer",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("GSKO-FACE/components/UserState/UserStateContainer");
    const sidebarVisible = (0, external_Vue_namespaceObject.ref)(false);
    const userStatePopup = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      updateUserStatus: stat => {
        logger.debug("updateUserStatus", "更新用户状态数据", stat);
        userStatePopup.value?.updateUserStatus(stat);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", UserStateContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !sidebarVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(UserStateButtonClosed, {
      key: 0,
      onOpenSidebar: _cache[0] || (_cache[0] = $event => sidebarVisible.value = true)
    })) : ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(UserStateButtonOpen, {
      key: 1,
      onCloseSidebar: _cache[1] || (_cache[1] = $event => sidebarVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(UserStatePopup, {
      ref_key: "userStatePopup",
      ref: userStatePopup
    }, null, 512), [ [ external_Vue_namespaceObject.vShow, sidebarVisible.value ] ]) ]));
  }
});

const UserStateContainer_exports_ = (0, exportHelper.A)(UserStateContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-6840cc77" ] ]);

const UserStateContainer = UserStateContainer_exports_;

const appvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-container",
  class: "status-ui-container"
};

const appvue_type_script_setup_true_lang_ts_hoisted_2 = {
  id: "status-duo",
  class: "status-duo"
};

const appvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "status-main-content"
};

const __default__ = (0, external_Vue_namespaceObject.defineComponent)({
  name: "App"
});

const appvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  ...__default__,
  setup(__props, {expose: __expose}) {
    const themeToggle = (0, external_Vue_namespaceObject.ref)(null);
    const userState = (0, external_Vue_namespaceObject.ref)(null);
    const ayaNews = (0, external_Vue_namespaceObject.ref)(null);
    const statusBanner = (0, external_Vue_namespaceObject.ref)(null);
    const statusTabContent = (0, external_Vue_namespaceObject.ref)(null);
    const roleRibbon = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      themeToggle,
      userState,
      ayaNews,
      statusBanner,
      statusTabContent,
      roleRibbon
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", appvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ▼ 新增：右上角主题切换按钮 "), (0, external_Vue_namespaceObject.createVNode)(ThemeToggle, {
      ref_key: "themeToggle",
      ref: themeToggle
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ 新增 "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", appvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createVNode)(UserStateContainer, {
      ref_key: "userState",
      ref: userState
    }, null, 512), (0, external_Vue_namespaceObject.createVNode)(AyaNewsContainer, {
      ref_key: "ayaNews",
      ref: ayaNews
    }, null, 512) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", appvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createVNode)(RoleRibbonContainer, {
      ref_key: "roleRibbon",
      ref: roleRibbon
    }, null, 512), (0, external_Vue_namespaceObject.createVNode)(StatusBannerContent, {
      ref_key: "statusBanner",
      ref: statusBanner
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▼ [重构] 选项卡区域已被封装到 StatusTabContent 组件中 "), (0, 
    external_Vue_namespaceObject.createVNode)(StatusTabContent, {
      ref_key: "statusTabContent",
      ref: statusTabContent
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ [重构] ") ]) ]));
  }
});

const app_exports_ = appvue_type_script_setup_true_lang_ts;

const GSKO_FACE_app = app_exports_;

$(() => {
  const app = (0, external_Vue_namespaceObject.createApp)(GSKO_FACE_app);
  const appInstance = app.mount("#app");
  window.vueApp = appInstance;
  const logger = new Logger("GSKO-FACE");
  eventOn("GSKO:showUI", detail => {
    const funcName = "onShowUI";
    try {
      logContext.mk = String(detail?.mk || "");
    } catch {
      logContext.mk = "";
    }
    logger.log(funcName, "收到 GSKO:showUI 事件", detail);
    const eventMessageId = detail?.message_id;
    if (typeof eventMessageId !== "number") {
      logger.warn(funcName, "事件中未提供有效的 message_id，无法刷新 UI。");
      return;
    }
    const currentMessageId = getCurrentMessageId();
    if (eventMessageId !== currentMessageId) {
      logger.log(funcName, `事件 messageId (${eventMessageId}) 与当前的 ID (${currentMessageId}) 不匹配，跳过刷新。`);
      return;
    }
    const latestMessage = getChatMessages(currentMessageId)?.[0];
    if (!latestMessage) {
      logger.warn(funcName, `无法找到 message_id 为 ${currentMessageId} 的消息，跳过刷新。`);
      return;
    }
    if (detail?.actions?.apiWrite === true) {
      logger.log(funcName, "检测到 apiWrite 标记事件，跳过刷新逻辑");
      return;
    }
    logger.debug(funcName, "GSKO:showUI 事件详细内容", detail);
    try {
      const {statWithoutMeta, runtime} = detail || {};
      if (!statWithoutMeta) {
        logger.warn(funcName, "事件中未找到 statWithoutMeta，无法刷新 UI。");
        return;
      }
      if (!runtime) {
        logger.warn(funcName, "事件中未找到 runtime 数据，界面渲染可能不完整。");
      }
      const parsedStat = StatSchema.parse(statWithoutMeta);
      const parsedRuntime = RuntimeSchema.parse(runtime);
      const context = {
        statWithoutMeta: parsedStat,
        runtime: parsedRuntime,
        messageId: currentMessageId,
        latestMessage
      };
      logger.debug(funcName, "传给各子模块的上下文对象:", context);
      const {themeToggle, userState, statusBanner, ayaNews, statusTabContent, roleRibbon} = appInstance;
      try {
        if (themeToggle && typeof themeToggle.updateTheme === "function") {
          logger.debug(funcName, "调用 ThemeToggle.updateTheme");
          themeToggle.updateTheme(context);
          logger.debug(funcName, "ThemeToggle.updateTheme 执行完毕");
        } else {
          logger.warn(funcName, "ThemeToggle 组件缺少 updateTheme 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "ThemeToggle.updateTheme 执行失败，错误信息如下", e);
      }
      try {
        if (userState && typeof userState.updateUserStatus === "function") {
          logger.debug(funcName, "调用 UserState.updateUserStatus");
          userState.updateUserStatus(parsedStat);
          logger.debug(funcName, "UserState.updateUserStatus 执行完毕");
        } else {
          logger.warn(funcName, "UserState 组件缺少 updateUserStatus 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "UserState.updateUserStatus 执行失败，错误信息如下", e);
      }
      try {
        if (statusBanner && typeof statusBanner.update === "function") {
          logger.debug(funcName, "调用 StatusBanner.update");
          statusBanner.update(context);
          logger.debug(funcName, "StatusBanner.update 执行完毕");
        } else {
          logger.warn(funcName, "StatusBanner 组件缺少 update 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "StatusBanner.update 执行失败，错误信息如下", e);
      }
      try {
        if (ayaNews && typeof ayaNews.updateNews === "function") {
          logger.debug(funcName, "调用 AyaNews.updateNews");
          ayaNews.updateNews(parsedStat);
          logger.debug(funcName, "AyaNews.updateNews 执行完毕");
        } else {
          logger.warn(funcName, "AyaNews 组件缺少 updateNews 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "AyaNews.updateNews 执行失败，错误信息如下", e);
      }
      try {
        if (statusTabContent && typeof statusTabContent.update === "function") {
          logger.log(funcName, "调用 StatusTabContent.update...");
          statusTabContent.update(context);
          logger.debug(funcName, "StatusTabContent.update 执行完毕");
        } else {
          logger.warn(funcName, "StatusTabContent 组件缺少 update 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "StatusTabContent.update 执行失败，错误信息如下", e);
      }
      try {
        if (roleRibbon && typeof roleRibbon.updateRibbon === "function") {
          logger.log(funcName, "调用 RoleRibbon.updateRibbon...");
          roleRibbon.updateRibbon(context);
          logger.debug(funcName, "RoleRibbon.updateRibbon 执行完毕");
        } else {
          logger.warn(funcName, "RoleRibbon 组件缺少 updateRibbon 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "RoleRibbon.updateRibbon 执行失败，错误信息如下", e);
      }
    } catch (e) {
      logger.error(funcName, "GSKO:showUI 处理流程出现未捕获异常", e);
    } finally {
      logContext.mk = "";
    }
  });
  if (typeof eventEmit === "function") {
    Promise.resolve(eventEmit("GSKO:requireData")).then(() => {
      logger.log("requestDataOnInit", "已在初始化时请求最新数据。");
    }).catch(error => {
      logger.error("requestDataOnInit", "初始化请求数据时发生异常。", error);
    });
  } else {
    logger.warn("requestDataOnInit", "eventEmit 未定义，无法在初始化时请求数据。");
  }
});</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap);
.styled-progress-bar[data-v-5c2b1dc4]{background:var(--bar-bg);border:1px solid var(--line);border-radius:5px;overflow:hidden;position:relative;flex-grow:1}.styled-progress-bar.size-large[data-v-5c2b1dc4]{height:10px}.styled-progress-bar.size-small[data-v-5c2b1dc4]{height:8px;max-width:80px}.styled-progress-bar .val[data-v-5c2b1dc4]{position:absolute;top:0;bottom:0;height:100%;width:0%;background:linear-gradient(90deg,#c0a58a,#8c7b6a);transition:width .3s ease}.styled-progress-bar.rtl .val[data-v-5c2b1dc4]{left:auto;right:0}.styled-progress-bar.negative .val[data-v-5c2b1dc4]{background:#b00020}.styled-progress-bar.very-hate .val[data-v-5c2b1dc4]{background:#000}.styled-progress-bar.very-love .val[data-v-5c2b1dc4]{background:linear-gradient(90deg,#7e3ff2,#c084fc)}
.affection-display[data-v-72c13fe5]{width:100%}.info-line[data-v-72c13fe5]{display:flex;align-items:center;gap:8px;font-size:.9em;margin-bottom:4px}.aff-stage[data-v-72c13fe5]{font-size:.9em;color:var(--muted);margin-left:auto}
.GensokyoOrigin-Particle{position:absolute;line-height:1;-webkit-user-select:none;user-select:none;opacity:0;filter:drop-shadow(0 0 6px rgba(0,0,0,0.25));animation:GensokyoOrigin-Particle-pop 1.2s ease-out forwards;font-size:16px}@keyframes GensokyoOrigin-Particle-pop{0%{transform:translate(0,0) scale(0.8) rotate(0deg);opacity:0}20%{opacity:1}100%{transform:translate(var(--dx,0),var(--dy,-40px)) scale(1.1) rotate(var(--rot,0deg));opacity:0}}.GensokyoOrigin-Particle--heart{color:#b65ff7;text-shadow:0 0 8px rgba(182,95,247,.7),0 0 4px hsla(0,0%,100%,.8)}.GensokyoOrigin-Particle--skull{color:#222;text-shadow:0 0 6px rgba(0,0,0,.5),0 0 3px #fff}:root[data-theme=dark] .GensokyoOrigin-Particle--skull{color:#714f4f;text-shadow:0 0 7px rgba(185,88,88,.7),0 0 3px rgba(255,210,210,.8)}
.particle-emitter-root{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden}
.GensokyoOrigin-CharacterEntryEditor-container{display:flex;flex-direction:column;gap:12px}.GensokyoOrigin-CharacterEntryEditor-grid{display:grid;gap:12px}.GensokyoOrigin-CharacterEntryEditor-grid--two{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.GensokyoOrigin-CharacterEntryEditor-grid--three{grid-template-columns:repeat(auto-fit,minmax(150px,1fr));align-items:end}.GensokyoOrigin-CharacterEntryEditor-grid--equal label{display:flex;flex-direction:column}.GensokyoOrigin-CharacterEntryEditor-details{border:1px dashed color-mix(in srgb,var(--line) 70%,transparent);border-radius:10px;padding:12px;background:color-mix(in srgb,var(--paper) 96%,transparent)}.GensokyoOrigin-CharacterEntryEditor-details>summary{font-weight:700;cursor:pointer;margin-bottom:12px}.GensokyoOrigin-CharacterEntryEditor-conditions-wrapper{display:flex;flex-direction:column;gap:16px}.GensokyoOrigin-CharacterEntryEditor-condition-group{padding:12px;border:1px solid color-mix(in srgb,var(--line) 50%,transparent);border-radius:8px;background:var(--bg)}.GensokyoOrigin-CharacterEntryEditor-condition-group--festival{display:flex;flex-direction:column;align-items:flex-start;gap:8px}.GensokyoOrigin-CharacterEntryEditor-festival-controls{display:flex;align-items:flex-end;gap:8px;width:100%}.GensokyoOrigin-CharacterEntryEditor-festival-label{flex-grow:1}.GensokyoOrigin-CharacterEntryEditor-festival-label select{width:100%}.GensokyoOrigin-CharacterEntryEditor-flag-groups{display:flex;flex-direction:column;gap:10px}.GensokyoOrigin-CharacterEntryEditor-flag-group__title{font-weight:600;color:var(--muted);margin-bottom:4px}.GensokyoOrigin-CharacterEntryEditor-flag-group__options{display:flex;flex-wrap:wrap;gap:10px}.GensokyoOrigin-CharacterEntryEditor-flag-group__options label{display:flex;align-items:center;gap:4px;font-size:.85rem}.GensokyoOrigin-CharacterEntryEditor-selected-flags{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}.GensokyoOrigin-CharacterEntryEditor-selected-flag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:999px;background:color-mix(in srgb,var(--line) 10%,transparent);font-size:.8rem}.GensokyoOrigin-CharacterEntryEditor-selected-flag button{border:none;background:rgba(0,0,0,0);cursor:pointer;color:var(--muted)}.GensokyoOrigin-CharacterEntryEditor-hint{font-size:.85rem;color:var(--muted);margin-top:6px}
.role-settings-modal[data-v-5aa4d780]{position:fixed;inset:0;z-index:2000}.role-settings-modal__backdrop[data-v-5aa4d780]{position:absolute;inset:0;background:rgba(0,0,0,0.55)}.role-settings-modal__panel[data-v-5aa4d780]{position:relative;background:var(--paper);border-radius:16px;border:1px solid var(--line);width:min(1080px,96vw);max-height:94vh;margin:3vh auto;padding:24px;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.45)}.role-settings-modal__header[data-v-5aa4d780]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:16px}.role-settings-modal__subtitle[data-v-5aa4d780]{margin-top:4px;color:var(--muted);font-size:0.9rem}.role-settings-modal__close[data-v-5aa4d780]{border:none;background:transparent;font-size:1.8rem;cursor:pointer;color:var(--muted)}.role-settings-modal__body[data-v-5aa4d780]{display:flex;flex-direction:column;gap:20px}.role-settings-modal__section[data-v-5aa4d780]{border:1px dashed color-mix(in srgb,var(--line) 70%,transparent);border-radius:12px;padding:16px;background:color-mix(in srgb,var(--paper) 92%,transparent)}.section-heading[data-v-5aa4d780]{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;cursor:pointer}.card[data-v-5aa4d780]{border:1px solid color-mix(in srgb,var(--line) 80%,transparent);border-radius:12px;padding:0 16px 16px;background:color-mix(in srgb,var(--paper) 80%,transparent);margin-bottom:12px}details.card[open][data-v-5aa4d780]{padding-top:16px}.card__header[data-v-5aa4d780]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;cursor:pointer;position:relative;padding-left:1.2em}details.card>summary.card__header[data-v-5aa4d780]{padding:16px 0 16px 1.2em;margin-bottom:0}details.card>summary.card__header[data-v-5aa4d780]::before{content:'▶';position:absolute;left:0;top:50%;transform:translateY(-50%) rotate(0deg);transition:transform 0.2s;font-size:0.8em}details.card[open]>summary.card__header[data-v-5aa4d780]::before{transform:translateY(-50%) rotate(90deg)}details.card[open]>summary.card__header[data-v-5aa4d780]{margin-bottom:12px}.sub-card[data-v-5aa4d780]{border:1px solid color-mix(in srgb,var(--line) 60%,transparent);border-radius:10px;padding:0 12px 12px;margin-top:12px;background:color-mix(in srgb,var(--paper) 90%,transparent)}details.sub-card[open][data-v-5aa4d780]{padding-top:12px}.sub-card__header[data-v-5aa4d780]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;cursor:pointer;position:relative;padding-left:1.2em}details.sub-card>summary.sub-card__header[data-v-5aa4d780]{padding:12px 0 12px 1.2em;margin-bottom:0}details.sub-card>summary.sub-card__header[data-v-5aa4d780]::before{content:'▶';position:absolute;left:0;top:50%;transform:translateY(-50%) rotate(0deg);transition:transform 0.2s;font-size:0.8em}details.sub-card[open]>summary.sub-card__header[data-v-5aa4d780]::before{transform:translateY(-50%) rotate(90deg)}details.sub-card[open]>summary.sub-card__header[data-v-5aa4d780]{margin-bottom:8px}.form-grid[data-v-5aa4d780]{display:grid;gap:12px}.form-grid--two[data-v-5aa4d780]{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.form-grid--equal label[data-v-5aa4d780]{display:flex;flex-direction:column}label span[data-v-5aa4d780]{font-size:0.85rem;color:var(--muted);margin-bottom:4px}input[data-v-5aa4d780],select[data-v-5aa4d780],textarea[data-v-5aa4d780]{width:100%;border:1px solid var(--line);border-radius:8px;padding:8px 10px;background:var(--paper);color:var(--ink)}textarea[data-v-5aa4d780]{resize:vertical}.toggle[data-v-5aa4d780]{display:flex;align-items:center;gap:6px;font-size:0.9rem;color:var(--muted)}.ghost-btn[data-v-5aa4d780]{border:1px solid color-mix(in srgb,var(--line) 70%,transparent);border-radius:999px;background:transparent;padding:6px 16px;cursor:pointer;color:var(--ink);font-weight:600}.ghost-btn--small[data-v-5aa4d780]{padding:4px 12px;font-size:0.85rem}.ghost-btn--danger[data-v-5aa4d780]{color:#c0392b;border-color:color-mix(in srgb,#c0392b 40%,transparent)}.primary-btn[data-v-5aa4d780]{border:none;border-radius:999px;padding:10px 22px;background:linear-gradient(135deg,#c471ed,#f64f59);color:#fff;font-weight:700;cursor:pointer}.ghost-btn[data-v-5aa4d780]:disabled,.primary-btn[data-v-5aa4d780]:disabled{opacity:0.6;cursor:not-allowed}.empty-hint[data-v-5aa4d780]{color:var(--muted);font-size:0.9rem}.rule-row[data-v-5aa4d780]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;align-items:end;margin-bottom:12px}.role-settings-modal__footer[data-v-5aa4d780]{margin-top:20px;display:flex;align-items:center}.footer-spacer[data-v-5aa4d780]{flex:1}.role-settings-modal__empty[data-v-5aa4d780]{border:1px dashed var(--line);border-radius:12px;padding:24px;margin:18px 0;text-align:center}

.GensokyoOrigin-RoleDetailPopup-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.GensokyoOrigin-RoleDetailPopup-popup{position:relative;width:90vw;max-width:800px;max-height:80vh;background:var(--paper);border:1px solid var(--line);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.2);display:flex;overflow:hidden}.GensokyoOrigin-RoleDetailPopup-close-btn{position:absolute;top:12px;right:12px;width:30px;height:30px;border:none;background:rgba(0,0,0,.3);border-radius:50%;font-size:20px;line-height:30px;text-align:center;cursor:pointer;color:#fff;z-index:10;transition:background .2s ease}.GensokyoOrigin-RoleDetailPopup-close-btn:hover{background:rgba(0,0,0,.6)}.GensokyoOrigin-RoleDetailPopup-portrait-section{flex:0 0 300px;position:relative;background-color:var(--bg)}.GensokyoOrigin-RoleDetailPopup-portrait-image{width:100%;height:100%;object-fit:cover;object-position:center top}.GensokyoOrigin-RoleDetailPopup-portrait-placeholder{width:100%;height:100%;display:grid;place-items:center;font-size:6rem;font-weight:800;color:color-mix(in srgb,var(--muted) 50%,transparent)}.GensokyoOrigin-RoleDetailPopup-content-section{flex:1;min-width:0;padding:24px;overflow-y:auto}.GensokyoOrigin-RoleDetailPopup-header{display:flex;align-items:center;gap:16px;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--line)}.GensokyoOrigin-RoleDetailPopup-name{font-size:1.8em;font-weight:700}.GensokyoOrigin-RoleDetailPopup-meta{font-size:1em;color:var(--muted)}.GensokyoOrigin-RoleDetailPopup-details-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}.GensokyoOrigin-RoleDetailPopup-section{margin-top:20px;padding-top:16px;border-top:1px dashed var(--line)}.GensokyoOrigin-RoleDetailPopup-section-title{font-size:1.1em;font-weight:700;margin-bottom:8px}.GensokyoOrigin-RoleDetailPopup-section-desc{font-size:.9em;color:var(--muted);margin-bottom:12px}.GensokyoOrigin-RoleDetailPopup-detail-item{background:var(--bg);padding:8px;border-radius:4px;font-size:.95em}.GensokyoOrigin-RoleDetailPopup-detail-item strong{color:var(--muted);margin-right:8px}.GensokyoOrigin-RoleDetailPopup-detail-item.full-width{grid-column:1/-1}.role-detail-popup-actions{margin-top:16px;display:flex;justify-content:flex-end}.role-settings-btn{padding:10px 20px;border-radius:999px;border:1px solid color-mix(in srgb,var(--line) 70%,transparent);background:linear-gradient(135deg,var(--btn-accent),color-mix(in srgb,var(--btn-accent) 85%,white 15%));color:#fff;font-weight:700;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease;box-shadow:0 10px 20px rgba(0,0,0,.15)}.role-settings-btn:disabled{opacity:.6;cursor:not-allowed;box-shadow:none}.role-settings-btn:not(:disabled):hover{transform:translateY(-1px);box-shadow:0 16px 26px rgba(0,0,0,.2)}@media (max-width:640px){.GensokyoOrigin-RoleDetailPopup-popup{flex-direction:column;width:95vw;max-height:90vh}.GensokyoOrigin-RoleDetailPopup-portrait-section{flex:0 0 auto;width:100%;aspect-ratio:4/3}.GensokyoOrigin-RoleDetailPopup-content-section{padding:16px}.GensokyoOrigin-RoleDetailPopup-name{font-size:1.5em}}
.map-component{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden;margin-bottom:20px;border-radius:12px;touch-action:none;-webkit-user-select:none;user-select:none}.map-component .map-wrapper{position:relative;width:100%;height:100%;background:#f0f0f0;border-radius:12px}.map-component .map-container{white-space:nowrap;position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;cursor:grab;border-radius:12px;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none}.map-component #mapCanvas{display:block;border-radius:12px}.map-component .marker{position:absolute;transform:translate(-50%,-50%);cursor:pointer;z-index:10;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:manipulation}.map-component .location-marker{font-size:14px;background:var(--bg);border-radius:8px;padding:6px 10px;box-shadow:0 2px 8px rgba(0,0,0,.15),inset 0 1px 0 hsla(0,0%,100%,.8);border:1px solid hsla(0,0%,100%,.5);min-width:60px;text-align:center;font-weight:500;color:var(--ink)}@media (max-width:768px){.map-component .location-marker{font-size:12px;padding:5px 8px;min-width:50px}}.map-component .location-marker:hover{background:linear-gradient(145deg,#4fc3f7,#29b6f6);color:#fff;box-shadow:0 4px 16px rgba(41,182,246,.4)}.map-component .location-marker:active{background:linear-gradient(145deg,#4fc3f7,#29b6f6);color:#fff;transform:translate(-50%,-50%) scale(0.95)}.map-component .marker-highlighted{background:linear-gradient(145deg,#ff9800,#f57c00) !important;color:#fff !important;box-shadow:0 4px 20px rgba(255,152,0,.6) !important;z-index:20 !important}.map-component .marker-highlighted::before{border-top-color:#ff9800 !important}.map-component .player-marker{background:none !important;border:none !important;box-shadow:none !important;font-size:24px;z-index:25;filter:drop-shadow(0 2px 8px rgba(255,235,59,0.6));cursor:default}.map-component .player-marker .player-icon{display:block;animation:float 3s ease-in-out infinite}.map-component .map-info{position:absolute;top:20px;left:20px;background:hsla(0,0%,100%,.95);padding:8px 16px;border-radius:8px;font-size:.9rem;z-index:40;box-shadow:0 2px 8px rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.1)}.map-component .map-operate{position:absolute;top:20px;right:20px;z-index:40;display:flex;gap:10px;flex-direction:column}.map-component .map-operate>div{background:hsla(0,0%,100%,.95);box-shadow:0 2px 8px rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.1);padding:8px;border-radius:8px;cursor:pointer;text-align:center;font-size:20px}@media (max-width:768px){.map-component .map-operate>div{font-size:16px}}@keyframes bounce{0%,20%,50%,80%,100%{transform:translate(-50%,-100%)}40%{transform:translate(-50%,calc(-100% - 30px))}60%{transform:translate(-50%,calc(-100% - 15px))}}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}.map-component .pulsate{animation:bounce 2s infinite}.map-component .tip-container{position:absolute;transform-origin:bottom center;z-index:30;opacity:0}.map-component .tip-container.tip-visible{opacity:1;animation:tipAppear .3s ease}@keyframes tipAppear{from{opacity:0;transform:translate(-50%,-80%) scale(0.8)}to{opacity:1;transform:translate(-50%,-100%) scale(1)}}.map-component .dialog{border-radius:12px;padding:0;box-shadow:0 8px 32px rgba(0,0,0,.2),0 2px 8px rgba(0,0,0,.1);color:var(--ink);background:linear-gradient(145deg,#ffffff,#f8f9fa);position:relative;border:1px solid hsla(0,0%,100%,.8);min-width:200px;backdrop-filter:blur(10px)}@media (max-width:768px){.map-component .dialog{min-width:180px;max-width:90vw}}.map-component .dialog .dialog-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid rgba(0,0,0,.1);background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:12px 12px 0 0;color:#fff}.map-component .dialog .dialog-header .location-name{font-size:18px;font-weight:600;margin:0;color:#fff}@media (max-width:768px){.map-component .dialog .dialog-header .location-name{font-size:16px}}.map-component .dialog .dialog-header .close-btn{background:hsla(0,0%,100%,.2);border:none;color:#fff;width:24px;height:24px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:background .2s ease}.map-component .dialog .dialog-header .close-btn:hover{background:hsla(0,0%,100%,.3)}@media (max-width:768px){.map-component .dialog .dialog-header .close-btn{width:28px;height:28px;font-size:18px}}.map-component .dialog .dialog-content{padding:20px}.map-component .dialog .dialog-content .npc-list{display:flex;flex-direction:column;gap:12px}.map-component .dialog .dialog-content .npc-item{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,0,0,.03);border-radius:6px;transition:background .2s ease;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0)}.map-component .dialog .dialog-content .npc-item:hover{background:rgba(0,0,0,.06)}.map-component .dialog .dialog-content .npc-item:active{background:rgba(0,0,0,.1)}@media (max-width:768px){.map-component .dialog .dialog-content .npc-item{padding:10px 12px;flex-direction:column;align-items:flex-start;gap:4px}}.map-component .dialog .dialog-content .npc-name{font-weight:500;color:#2c3e50}.map-component .dialog .dialog-content .npc-target{color:#7f8c8d;font-size:.9em}.map-component .dialog .dialog-content .empty-location{text-align:center;color:#95a5a6;font-style:italic;padding:20px}.map-component .dialog::after{content:"";position:absolute;top:100%;left:50%;transform:translateX(-50%);border:12px solid rgba(0,0,0,0);border-top-color:#fff;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.1))}@media (max-width:768px){.map-component .map-operate{top:10px;right:10px;padding:6px 12px;font-size:14px}.map-component .map-info{top:10px;left:10px;padding:6px 12px;font-size:.8rem}}
h4[data-v-57d1591c]{display:flex;align-items:center;font-size:1.1em;color:var(--muted);margin:0 0 10px}h4 .emoji[data-v-57d1591c]{margin-right:8px;font-size:1.1em}.preserve-format[data-v-57d1591c]{white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word;line-height:1.6;font-size:.95em}hr.dashed[data-v-57d1591c]{border:none;border-top:1px dashed var(--line);margin:20px 0}
[data-v-6e6f3416] [data-path]{background:rgba(255,247,232,.06);border:1px dashed var(--line);border-radius:8px;padding:10px 12px;margin:10px 0}[data-v-6e6f3416] input[type="text"],[data-v-6e6f3416] input[type="number"],[data-v-6e6f3416] textarea,[data-v-6e6f3416] select{width:100%;background:var(--control-bg);border:1px solid var(--control-border);border-radius:6px;padding:9px 11px;font-size:14px;color:var(--ink);box-shadow:0 1px 0 rgba(0,0,0,.03) inset}[data-v-6e6f3416] input:focus,[data-v-6e6f3416] textarea:focus,[data-v-6e6f3416] select:focus{outline:none;border-color:var(--control-focus);box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 28%,transparent)}[data-v-6e6f3416] input[type="checkbox"]{accent-color:var(--control-focus)}[data-v-6e6f3416] button{cursor:pointer;border:1px solid rgba(0,0,0,0);border-radius:6px;padding:10px 14px;font-weight:700;background:var(--btn-accent);color:#fff;transition:background .2s,box-shadow .2s,border-color .2s,transform .02s}[data-v-6e6f3416] button:hover{background:var(--btn-accent-hover)}[data-v-6e6f3416] button:active{transform:translateY(1px)}[data-v-6e6f3416] .muted-btn{background:var(--btn-muted);color:var(--muted);border-color:var(--btn-muted-border)}[data-v-6e6f3416] .muted-btn:hover{filter:brightness(0.97)}[data-v-6e6f3416] details{border:1px solid var(--line);border-radius:8px;background:var(--paper);margin:10px 0;padding:8px 10px 10px}[data-v-6e6f3416] summary{font-weight:700;color:var(--muted);background:color-mix(in srgb,var(--paper) 88%,black 0%);border-radius:6px;padding:6px 8px;cursor:pointer;-webkit-user-select:none;user-select:none}[data-v-6e6f3416] details[open]>summary{background:color-mix(in srgb,var(--paper) 78%,black 0%)}[data-v-6e6f3416] #cfg_status{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border:1px solid color-mix(in srgb,var(--control-focus) 35%,white 65%);background:color-mix(in srgb,var(--control-focus) 10%,white 90%);color:color-mix(in srgb,var(--control-focus) 70%,black 30%);border-radius:999px;font-weight:700;line-height:1.8}
#content_incidents h4[data-v-431ddb4f]{display:flex;align-items:center;margin:0 0 15px;padding-bottom:10px;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}#content_incidents .emoji[data-v-431ddb4f]{font-size:1em;line-height:1;margin-right:8px}#incident-toolbar[data-v-431ddb4f]{margin-bottom:15px}.debug-select[data-v-431ddb4f],.debug-switch[data-v-431ddb4f]{display:flex;align-items:center;gap:6px;font-size:.9em;padding:4px 8px;border:1px dashed var(--line);border-radius:6px;background:color-mix(in srgb,var(--paper) 50%,var(--bg) 50%)}:root[data-theme="dark"],:root[data-theme="dark"]{background:hsla(0,0%,100%,.05)}.incident-list[data-v-431ddb4f]{display:flex;flex-direction:column;gap:12px}.incident-list[data-v-431ddb4f] .role-card{background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:var(--pad);overflow:hidden}.incident-list[data-v-431ddb4f] .role-card .role-card-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding-bottom:8px;border-bottom:1px dashed var(--line)}.incident-list[data-v-431ddb4f] .role-card .role-avatar{width:40px;height:40px;border-radius:50%;border:1px solid var(--line);background:var(--avatar-bg);display:grid;place-items:center;font-weight:700;color:var(--muted)}.incident-list[data-v-431ddb4f] .role-card .role-name{font-weight:700}.incident-list[data-v-431ddb4f] .role-card .role-meta{font-size:.85em;color:var(--muted)}.incident-list[data-v-431ddb4f] .role-card .role-line{margin:6px 0;font-size:.9em}
.font-size-controls[data-v-0a4b721e]{display:flex;justify-content:flex-end;gap:6px;margin-bottom:10px}.font-size-btn[data-v-0a4b721e]{width:28px;height:28px;border:1px solid var(--line);background:var(--paper);border-radius:4px;cursor:pointer;font-weight:700}
.tag-editor-shell[data-v-186515aa]{display:flex;flex-direction:column;gap:14px;margin-bottom:22px}.tag-editor-toggle[data-v-186515aa]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 18px;border-radius:16px;border:1px dashed color-mix(in srgb,var(--line) 70%,transparent);background:color-mix(in srgb,var(--paper) 94%,var(--bg) 6%);color:var(--muted);font-weight:600;letter-spacing:0.01em;cursor:pointer;transition:background 0.2s ease,border-color 0.2s ease,box-shadow 0.2s ease}.tag-editor-toggle[data-v-186515aa]:hover{background:color-mix(in srgb,var(--paper) 88%,var(--bg) 12%);border-color:color-mix(in srgb,var(--line) 85%,transparent);box-shadow:0 10px 18px rgba(0,0,0,0.08)}.tag-editor-toggle[data-v-186515aa]:focus-visible{outline:none;border-color:var(--control-focus);box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 28%,transparent)}:root[data-theme='dark']{background:color-mix(in srgb,var(--paper) 70%,transparent);border-color:color-mix(in srgb,var(--line) 75%,black 25%);color:var(--ink)}.tag-editor-toggle-label[data-v-186515aa]{flex:1;text-align:left;font-size:0.95rem}.tag-editor-toggle-icon[data-v-186515aa]{width:28px;height:28px;border-radius:50%;border:1px solid color-mix(in srgb,var(--line) 65%,transparent);display:inline-flex;align-items:center;justify-content:center;position:relative;color:var(--muted)}:root[data-theme='dark']{color:var(--ink);border-color:color-mix(in srgb,var(--line) 75%,black 25%)}.tag-editor-toggle-icon[data-v-186515aa]::before{content:'';width:8px;height:8px;border-right:2px solid currentColor;border-bottom:2px solid currentColor;transform:rotate(45deg);transition:transform 0.2s ease}.tag-editor-toggle[aria-expanded='true'] .tag-editor-toggle-icon[data-v-186515aa]::before{transform:rotate(-135deg)}.tag-editor-slide-enter-active[data-v-186515aa],.tag-editor-slide-leave-active[data-v-186515aa]{transition:opacity 0.25s ease,transform 0.25s ease;transform-origin:top}.tag-editor-slide-enter-from[data-v-186515aa],.tag-editor-slide-leave-to[data-v-186515aa]{opacity:0;transform:translateY(-8px)}.tag-editor[data-v-186515aa]{--tag-panel-bg:color-mix(in srgb,var(--paper) 90%,var(--bg) 10%);--tag-panel-border:color-mix(in srgb,var(--line) 85%,transparent);--tag-panel-shadow:0 12px 28px rgba(0,0,0,0.08);width:100%;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px 20px;margin:0;padding:20px;border-radius:18px;border:1px solid var(--tag-panel-border);background:var(--tag-panel-bg);box-shadow:var(--tag-panel-shadow);transition:background 0.25s ease,border-color 0.25s ease,box-shadow 0.25s ease}:root[data-theme='dark']{--tag-panel-bg:color-mix(in srgb,var(--paper) 78%,black 22%);--tag-panel-border:color-mix(in srgb,var(--line) 60%,black 40%);--tag-panel-shadow:0 18px 30px rgba(0,0,0,0.55)}.tag-input-group[data-v-186515aa]{display:flex;flex-direction:column;gap:6px;padding:12px 14px;border-radius:12px;min-width:0;background:color-mix(in srgb,var(--paper) 95%,var(--bg) 5%);border:1px solid color-mix(in srgb,var(--line) 65%,transparent);transition:background 0.2s ease,border-color 0.2s ease,box-shadow 0.2s ease}.tag-input-group[data-v-186515aa]:hover{border-color:color-mix(in srgb,var(--line) 80%,transparent);box-shadow:0 10px 20px rgba(0,0,0,0.08)}:root[data-theme='dark']{background:color-mix(in srgb,var(--paper) 70%,transparent);border-color:color-mix(in srgb,var(--line) 80%,transparent);box-shadow:inset 0 1px 0 rgba(255,255,255,0.03)}:root[data-theme='dark']{box-shadow:0 12px 25px rgba(0,0,0,0.35)}.tag-input-group label[data-v-186515aa]{font-size:0.9rem;font-weight:600;color:var(--muted);letter-spacing:0.02em;white-space:nowrap}.tag-input-group input[data-v-186515aa]{width:100%;padding:10px 12px;border:1px solid var(--control-border);border-radius:10px;background:var(--control-bg);color:var(--ink);font-size:0.95rem;transition:border-color 0.15s ease,box-shadow 0.15s ease,background 0.15s ease}.tag-input-group input[data-v-186515aa]::placeholder{color:color-mix(in srgb,var(--muted) 55%,transparent)}.tag-input-group input[data-v-186515aa]:focus-visible{outline:none;border-color:var(--control-focus);box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 30%,transparent);background:color-mix(in srgb,var(--control-bg) 92%,white 8%)}.save-btn[data-v-186515aa]{align-self:stretch;justify-self:end;height:48px;padding:0 26px;border-radius:999px;border:none;background:linear-gradient(135deg,var(--btn-accent),color-mix(in srgb,var(--btn-accent) 80%,white 20%));color:#fff;font-size:0.95rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;box-shadow:0 16px 30px rgba(0,0,0,0.15);transition:transform 0.15s ease,box-shadow 0.15s ease,filter 0.15s ease}.save-btn[data-v-186515aa]:hover{transform:translateY(-1px);box-shadow:0 20px 32px rgba(0,0,0,0.2);filter:brightness(1.03)}.save-btn[data-v-186515aa]:active{transform:translateY(1px);box-shadow:0 10px 18px rgba(0,0,0,0.2)}.save-btn[data-v-186515aa]:focus-visible{outline:none;box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 30%,transparent),0 16px 30px rgba(0,0,0,0.2)}#main-content[data-v-186515aa]{border:1px solid color-mix(in srgb,var(--line) 80%,transparent);border-radius:18px;background:color-mix(in srgb,var(--paper) 93%,var(--bg) 7%);padding:20px;line-height:1.7;font-size:clamp(0.95em,0.4vw + 0.85em,1.05em);max-height:clamp(260px,55vh,620px);overflow-y:auto;box-shadow:0 24px 35px rgba(0,0,0,0.06);transition:background 0.3s ease,border-color 0.3s ease,box-shadow 0.3s ease}:root[data-theme='dark']{background:color-mix(in srgb,var(--paper) 75%,black 25%);border-color:color-mix(in srgb,var(--line) 70%,black 30%);box-shadow:0 28px 40px rgba(0,0,0,0.65)}#main-content[data-v-186515aa]::-webkit-scrollbar{width:6px}#main-content[data-v-186515aa]::-webkit-scrollbar-thumb{background:color-mix(in srgb,var(--muted) 60%,transparent);border-radius:999px}#main-content[data-v-186515aa]::-webkit-scrollbar-track{background:transparent}@media (max-width:640px){.tag-editor[data-v-186515aa]{grid-template-columns:1fr;padding:16px;gap:12px}.tag-input-group[data-v-186515aa]{padding:10px 12px}.save-btn[data-v-186515aa]{width:100%;justify-self:stretch}}

.status-tabs[data-v-089aff66]{display:flex;gap:8px;border-bottom:1px solid var(--line);background:var(--paper);padding:0 15px;overflow:auto hidden;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity}.status-tabs button[data-v-089aff66]{padding:12px 16px;cursor:pointer;font-size:.95em;color:var(--muted);border:none;background:none;border-bottom:3px solid rgba(0,0,0,0);margin-bottom:-1px;flex:0 0 auto;scroll-snap-align:start}.status-tabs button.active[data-v-089aff66]{color:var(--ink);border-bottom-color:var(--tab-active);font-weight:700}.status-tab-content-area[data-v-089aff66]{flex:1;overflow:auto;padding:20px}.status-tab-content[data-v-089aff66]{display:none;line-height:1.6;font-size:.95em}.status-tab-content.active[data-v-089aff66]{display:block}:root[data-theme="dark"]{color:var(--muted)}:root[data-theme="dark"]{color:var(--ink)}@media (max-width:768px){.status-tab-content-area[data-v-089aff66]{padding:15px}}[data-v-089aff66] .font-size-controls{display:flex;justify-content:flex-end;gap:6px;margin-bottom:10px}[data-v-089aff66] .font-size-btn{width:28px;height:28px;border:1px solid var(--line);background:var(--paper);border-radius:4px;cursor:pointer;font-weight:700}[data-v-089aff66] .incident-list{display:flex;flex-direction:column;gap:12px}
.aya-news-button-closed[data-v-74e497bf]{padding:8px 12px;border:1px solid var(--line);border-radius:4px;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%}.aya-news-button-closed[data-v-74e497bf]:hover{background-color:var(--paper)}
.aya-news-button-open[data-v-91ed5eb4]{padding:12px 14px;border:1px solid var(--line);border-bottom-left-radius:0;border-bottom-right-radius:0;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%;box-shadow:0 2px 0 var(--line) inset;transition:padding .15s ease}.aya-news-button-open[data-v-91ed5eb4]:hover{background-color:var(--paper)}
.aya-news-popup[data-v-fe9df0ce]{width:100%;max-height:60vh;overflow:auto;padding:16px 20px;background:var(--paper);border:1px solid var(--line);border-top:none;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:0 8px 16px rgba(0,0,0,.05);display:flex;flex-direction:column;gap:10px}#aya-news-popup h4[data-v-fe9df0ce]{display:flex;align-items:center;height:var(--duo-head-h);margin:0 0 10px;padding:0;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}#aya-news-popup h4 .emoji[data-v-fe9df0ce]{font-size:1em;line-height:1;display:inline-grid;place-items:center;width:1.25em;height:1.25em;margin-right:8px}.news-body[data-v-fe9df0ce]{flex:1 1 auto;min-height:0;background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:10px;overflow:auto;white-space:normal;overflow-wrap:anywhere;word-break:break-word}
.aya-news-container[data-v-5c15b776]{position:relative}

.GensokyoOrigin-RoleCard-wrapper{position:relative;flex:0 0 260px;min-width:0;background:var(--bg);border:1px solid color-mix(in srgb,var(--line) 70%,transparent);border-radius:12px;scroll-snap-align:start;cursor:pointer;transition:transform .18s ease,box-shadow .18s ease;box-shadow:0 2px 10px rgba(0,0,0,.04);box-sizing:border-box;overflow-y:auto;overflow-x:hidden;max-width:100%;isolation:isolate;display:flex;flex-direction:column;max-height:500px}.GensokyoOrigin-RoleCard-wrapper:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.08)}.GensokyoOrigin-RoleCard-portrait-container{width:100%;aspect-ratio:3/4;background-color:color-mix(in srgb,var(--bg) 90%,var(--ink) 10%);overflow:hidden;flex-shrink:0}.GensokyoOrigin-RoleCard-portrait{width:100%;height:100%;object-fit:cover;object-position:center top;transition:transform .3s ease}.GensokyoOrigin-RoleCard-wrapper:hover .GensokyoOrigin-RoleCard-portrait{transform:scale(1.05)}.GensokyoOrigin-RoleCard-portrait-placeholder{width:100%;height:100%;display:grid;place-items:center;font-size:4rem;font-weight:800;color:color-mix(in srgb,var(--muted) 50%,transparent)}.GensokyoOrigin-RoleCard-content{padding:12px;display:flex;flex-direction:column;gap:10px}.GensokyoOrigin-RoleCard-title-section{padding-bottom:10px;border-bottom:1px dashed color-mix(in srgb,var(--line) 85%,transparent)}.GensokyoOrigin-RoleCard-name{font-weight:800;font-size:1.1rem;letter-spacing:.2px;line-height:1.2}.GensokyoOrigin-RoleCard-meta{margin-top:4px;font-size:.85rem;color:color-mix(in srgb,var(--muted) 90%,var(--ink))}.GensokyoOrigin-RoleCard-attrs{margin-top:10px;display:grid;grid-template-columns:1fr;gap:8px 12px;align-items:start;width:100%;box-sizing:border-box}.GensokyoOrigin-RoleCard-attrs .attr{display:grid;grid-template-columns:max-content minmax(0,1fr);align-items:start;gap:6px;padding:6px 8px;border:1px solid color-mix(in srgb,var(--line) 65%,transparent);border-radius:8px;background:color-mix(in srgb,var(--bg) 96%,transparent);transition:background .18s ease,border-color .18s ease;min-height:34px;max-width:100%;box-sizing:border-box}.GensokyoOrigin-RoleCard-attrs .attr:hover{background:color-mix(in srgb,var(--bg) 92%,var(--ink) 8%);border-color:color-mix(in srgb,var(--line) 80%,var(--ink))}.GensokyoOrigin-RoleCard-attrs .k{font-size:.82rem;color:color-mix(in srgb,var(--muted) 85%,var(--ink));font-weight:650;white-space:nowrap}.GensokyoOrigin-RoleCard-attrs .v{display:block;white-space:normal;overflow-wrap:anywhere;word-break:break-word;word-break:break-all;line-break:anywhere;max-width:100%;font-size:.9rem;color:color-mix(in srgb,var(--ink) 92%,var(--muted));line-height:1.35}@media (max-width:520px){.GensokyoOrigin-RoleCard-wrapper{flex:0 0 100%}.GensokyoOrigin-RoleCard-attrs .attr{grid-template-columns:max-content minmax(0,1fr)}}.GensokyoOrigin-RoleCard-wrapper::-webkit-scrollbar{width:6px}.GensokyoOrigin-RoleCard-wrapper::-webkit-scrollbar-track{background:rgba(0,0,0,0);margin:4px 0}.GensokyoOrigin-RoleCard-wrapper::-webkit-scrollbar-thumb{background-color:color-mix(in srgb,var(--line) 50%,transparent);border-radius:10px;border:2px solid rgba(0,0,0,0);background-clip:content-box}.GensokyoOrigin-RoleCard-wrapper::-webkit-scrollbar-thumb:hover{background-color:color-mix(in srgb,var(--line) 80%,transparent)}
.role-ribbon-container[data-v-1fb718a8]{position:relative;background:var(--paper);border-bottom:1px solid var(--line);padding:10px 40px;max-width:100%;overflow-x:hidden}.role-ribbon[data-v-1fb718a8]{display:flex;gap:12px;overflow:auto hidden;scroll-snap-type:x proximity;padding-bottom:6px}.ribbon-arrow[data-v-1fb718a8]{position:absolute;top:50%;transform:translateY(-50%);width:26px;height:26px;display:grid;place-items:center;border:1px solid var(--line);background:var(--bg);border-radius:4px;cursor:pointer;z-index:10}.ribbon-arrow.left[data-v-1fb718a8]{left:8px}.ribbon-arrow.right[data-v-1fb718a8]{right:8px}.role-card-placeholder[data-v-1fb718a8]{flex:0 0 260px;padding:16px;background:var(--bg);border:1px dashed var(--line);border-radius:6px;color:var(--muted);display:grid;place-items:center}
.emoji[data-v-74147b2e]{margin-right:0;font-size:1.1em}.banner-chip[data-v-74147b2e]{display:inline-flex;align-items:center;gap:.5em;padding:6px 10px;background:color-mix(in srgb,var(--paper) 90%,var(--tab-active) 10%);border:1px solid var(--line);border-radius:999px;font-weight:700;color:var(--ink);cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .08s ease,box-shadow .12s ease,background .2s ease}.banner-chip[data-v-74147b2e]:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}.banner-chip[data-v-74147b2e]:active{transform:translateY(1px) scale(0.99)}
.banner-chip-open[data-v-4c237e38]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 16px;background:var(--tab-active);border:1px solid var(--line);border-top-left-radius:10px;border-top-right-radius:10px;font-weight:700;color:var(--ink-bright);cursor:pointer;-webkit-user-select:none;user-select:none}.emoji[data-v-4c237e38]{font-size:1.2em;margin-right:8px}.close-icon[data-v-4c237e38]{font-size:.9em;color:var(--ink)}
.cal-day-container[data-v-42a71206]{position:relative;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;aspect-ratio:1/1;min-width:0;min-height:0}.cal-day-btn[data-v-42a71206]{width:100%;height:100%;padding:6px;border:1px solid var(--line);border-radius:8px;background:var(--paper);cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .2s ease,box-shadow .2s ease,transform .06s ease}.cal-day-btn[data-v-42a71206]:hover{background:color-mix(in srgb,var(--paper) 92%,black 8%)}.cal-day-btn[data-v-42a71206]:active{transform:translateY(1px)}.cal-day-btn.today[data-v-42a71206]{outline:2px solid var(--tab-active);outline-offset:0;box-shadow:0 0 0 2px color-mix(in srgb,var(--tab-active) 35%,transparent) inset}.cal-day-btn.has-fest[data-v-42a71206]{--fest-color:color-mix(in srgb,var(--tab-active) calc(var(--importance,1) * 20%),transparent);background:color-mix(in srgb,var(--fest-color) 50%,var(--paper) 50%);border-color:var(--fest-color)}.cal-day-btn[data-importance="5"][data-v-42a71206]{--importance:5}.cal-day-btn[data-importance="4"][data-v-42a71206]{--importance:4}.cal-day-btn[data-importance="3"][data-v-42a71206]{--importance:3}.cal-day-btn[data-importance="2"][data-v-42a71206]{--importance:2}.cal-day-btn[data-importance="1"][data-v-42a71206]{--importance:1}.dnum[data-v-42a71206]{font-weight:800;color:var(--ink);text-align:right;line-height:1}.cal-day-placeholder[data-v-42a71206]{width:100%;height:100%;border-radius:8px;background:color-mix(in srgb,var(--paper) 95%,black 5%)}.fest-popover[data-v-42a71206]{position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:250px;padding:12px;background:var(--bg);border:1px solid var(--line);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1);z-index:10;pointer-events:none;display:flex;flex-direction:column;gap:8px}.fest-item[data-v-42a71206]{border-top:1px solid var(--line);padding-top:8px}.fest-item[data-v-42a71206]:first-child{border-top:none;padding-top:0}.fest-header[data-v-42a71206]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:6px}.fest-header strong[data-v-42a71206]{font-weight:bold;color:var(--ink-bright)}.fest-host[data-v-42a71206]{font-size:.85em;color:var(--muted)}.fest-customs[data-v-42a71206]{list-style-type:disc;padding-left:20px;margin:0;font-size:.9em;color:var(--ink);display:flex;flex-direction:column;gap:4px}
.cal-content[data-v-7ee51604]{position:static;width:100%;max-height:none;margin-top:-1px;padding:12px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:none;overflow:visible}.cal-head[data-v-7ee51604]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}.cal-title[data-v-7ee51604]{display:flex;align-items:baseline;gap:.5em;color:var(--ink)}.cal-title .month[data-v-7ee51604]{font-size:1.25em;font-weight:800}.cal-title .year[data-v-7ee51604]{font-size:.95em;color:var(--muted)}.cal-nav[data-v-7ee51604]{display:flex;gap:6px}.cal-btn[data-v-7ee51604]{cursor:pointer;-webkit-user-select:none;user-select:none;border:1px solid var(--line);background:var(--paper);border-radius:8px;padding:6px 10px;font-weight:700}.cal-btn[data-v-7ee51604]:active{transform:translateY(1px)}.cal-body[data-v-7ee51604]{padding:10px 12px 12px}.cal-week[data-v-7ee51604]{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px;margin-bottom:6px;color:var(--muted);font-weight:700}.cal-week .w[data-v-7ee51604]{text-align:center;padding:4px 0;border-bottom:1px dashed var(--line)}.cal-grid[data-v-7ee51604]{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px;align-items:stretch;position:relative}
.time-container[data-v-6d680f10]{position:relative}

.banner-chip[data-v-388e9674]{display:inline-flex;align-items:center;gap:.65em;padding:8px 14px;background:color-mix(in srgb,var(--paper) 90%,var(--tab-active) 10%);border:1px solid var(--line);border-radius:999px;font-weight:700;color:var(--ink);cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .08s ease,box-shadow .12s ease,background .2s ease;min-width:150px}.banner-chip[data-v-388e9674]:hover:not(.banner-chip--disabled){box-shadow:0 2px 10px rgba(0,0,0,.06)}.banner-chip[data-v-388e9674]:active:not(.banner-chip--disabled){transform:translateY(1px) scale(0.99)}.banner-chip--disabled[data-v-388e9674]{cursor:not-allowed;opacity:.6}.emoji[data-v-388e9674]{font-size:1.2em}.summary[data-v-388e9674]{font-size:1em}
.banner-chip-open[data-v-162a8616]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:12px 16px;background:var(--tab-active);border:1px solid var(--line);border-top-left-radius:10px;border-top-right-radius:10px;font-weight:700;color:var(--ink-bright);cursor:pointer;-webkit-user-select:none;user-select:none}.open-left[data-v-162a8616]{display:flex;align-items:center;gap:10px}.open-text[data-v-162a8616]{display:flex;flex-direction:column;gap:2px}.emoji[data-v-162a8616]{font-size:1.2em}.title[data-v-162a8616]{font-size:1em}.summary[data-v-162a8616]{font-size:.78em;color:color-mix(in srgb,var(--ink-bright) 70%,white 30%)}.close-icon[data-v-162a8616]{font-size:.9em;color:var(--ink)}
.weather-content[data-v-05fe1e8e]{width:100%;padding:16px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;color:var(--ink);display:flex;flex-direction:column;gap:16px}.current-weather[data-v-05fe1e8e]{display:flex;flex-direction:column;gap:10px}.current-header[data-v-05fe1e8e]{display:flex;align-items:center;justify-content:space-between;gap:10px}.header-left[data-v-05fe1e8e]{display:flex;align-items:baseline;gap:8px}.label[data-v-05fe1e8e]{font-weight:700}.date[data-v-05fe1e8e]{font-size:0.85em;color:var(--muted)}.temperature[data-v-05fe1e8e]{font-size:1.1em;font-variant-numeric:tabular-nums}.current-body .condition[data-v-05fe1e8e]{font-size:1em;font-weight:600}.current-body .narrative[data-v-05fe1e8e]{margin-top:2px;color:var(--muted);font-size:0.9em}.current-stats[data-v-05fe1e8e]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;padding:0;margin:0;list-style:none}.current-stats li[data-v-05fe1e8e]{padding:8px 10px;background:color-mix(in srgb,var(--tab-active) 15%,transparent);border-radius:8px;display:flex;flex-direction:column;gap:4px;font-size:0.85em}.current-stats strong[data-v-05fe1e8e]{font-size:1.05em}.forecast-list[data-v-05fe1e8e]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px}.forecast-item[data-v-05fe1e8e]{padding:10px;border:1px solid color-mix(in srgb,var(--line) 70%,transparent);border-radius:8px;display:flex;flex-direction:column;gap:4px;background:color-mix(in srgb,var(--paper) 80%,var(--tab-active) 20%)}.forecast-item .condition[data-v-05fe1e8e]{font-weight:600}.forecast-item .temp[data-v-05fe1e8e]{font-size:0.95em}.forecast-item .meta[data-v-05fe1e8e]{font-size:0.8em;color:var(--muted)}.generated-at[data-v-05fe1e8e]{font-size:0.78em;color:var(--muted);text-align:right}

.weather-container[data-v-10d6ba33]{position:relative}.weather-empty[data-v-10d6ba33]{padding:16px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;color:var(--muted);font-size:0.95em}

.emoji[data-v-82d21eb8]{margin-right:8px;font-size:1.1em}.status-banner[data-v-82d21eb8]{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:8px 10px 6px;padding:10px 12px;background:var(--paper);border:1px solid var(--line);border-radius:10px;box-shadow:0 1px 0 rgba(0,0,0,.03),0 6px 18px rgba(0,0,0,.05);position:relative}.status-banner .banner-title[data-v-82d21eb8]{display:flex;align-items:center;gap:8px;color:var(--muted);font-weight:700;margin-right:6px}.status-banner .banner-title .emoji[data-v-82d21eb8]{margin-right:0}.banner-sep[data-v-82d21eb8]{width:1px;height:18px;background:var(--line);align-self:center;margin:0 2px}:root[data-theme="dark"]{box-shadow:0 1px 0 rgba(0,0,0,.1),0 6px 18px rgba(0,0,0,.2)}
.theme-toggle[data-v-ff947948]{position:absolute;top:8px;right:8px;width:34px;height:34px;display:grid;place-items:center;border-radius:8px;border:1px solid var(--line);background:var(--paper);color:var(--muted);font-size:18px;cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .05s ease,box-shadow .15s ease,background .15s ease,border-color .15s ease;z-index:20}.theme-toggle[data-v-ff947948]:active{transform:translateY(1px)}.theme-toggle[data-v-ff947948]:focus-visible{outline:none;box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 25%,transparent);border-color:var(--control-focus)}:root[data-theme="light"],:root:not([data-theme]){box-shadow:0 2px 10px rgba(0,0,0,.05)}:root[data-theme="light"],:root:not([data-theme]){background:color-mix(in srgb,var(--paper) 88%,black 12%)}:root[data-theme="dark"]{border-color:color-mix(in srgb,var(--line) 70%,white 30%);background:color-mix(in srgb,var(--paper) 85%,white 0%);color:var(--ink);box-shadow:0 2px 12px rgba(0,0,0,.35)}:root[data-theme="dark"]{background:color-mix(in srgb,var(--paper) 75%,white 0%)}
.user-state-button-closed[data-v-adf20512]{padding:8px 12px;border:1px solid var(--line);border-radius:4px;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%}.user-state-button-closed[data-v-adf20512]:hover{background-color:var(--paper)}
.user-state-button-open[data-v-2c96c0f8]{padding:12px 14px;border:1px solid var(--line);border-bottom-left-radius:0;border-bottom-right-radius:0;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%;box-shadow:0 2px 0 var(--line) inset;transition:padding .15s ease}.user-state-button-open[data-v-2c96c0f8]:hover{background-color:var(--paper)}
.user-state-popup[data-v-a159b4b2]{position:static;width:100%;max-height:none;margin-top:-1px;padding:16px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:none;display:flex;flex-direction:column}.sidebar-content[data-v-a159b4b2]{overflow:visible}h4[data-v-a159b4b2]{display:flex;align-items:center;height:var(--duo-head-h);margin:0 0 10px;padding:0;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}h4 .emoji[data-v-a159b4b2]{font-size:1em;line-height:1;display:inline-grid;place-items:center;width:1.25em;height:1.25em;margin-right:8px}p[data-v-a159b4b2]{margin:8px 0;font-size:.9em;line-height:1.5}p>span[data-v-a159b4b2]:last-child{flex:1 1 auto;min-width:0;white-space:normal;overflow-wrap:anywhere;word-break:break-word}
.user-state-container[data-v-6840cc77]{position:relative}

.status-ui-container{position:relative;display:flex;flex-direction:column;margin:10px;border:1px solid var(--line);border-radius:4px;overflow-x:hidden;overflow-y:visible;background:var(--bg)}.status-main-content{flex:1;display:flex;flex-direction:column;min-height:0;overflow:visible}.status-duo{display:flex;flex-wrap:nowrap;align-items:flex-start;gap:10px;overflow-x:auto;overflow-y:visible;border-bottom:1px dashed var(--line);padding:12px;margin-bottom:12px;width:100%}@media (min-width:1100px){.status-ui-container{display:grid;grid-template-columns:380px minmax(0,1fr);grid-template-rows:auto;grid-auto-rows:auto}.status-duo{grid-column:1;grid-row:1;flex-direction:column;align-items:stretch;overflow-y:visible;overflow-x:hidden;border-right:1px dashed var(--line);border-bottom:none;padding:12px;margin-bottom:0;max-height:none}.status-main-content{grid-column:2}.status-duo>.user-state-container{flex:0 0 auto;border-right:none;border-bottom:1px solid var(--line)}}@media (max-width:768px){.status-ui-container{flex-direction:column;margin:5px}}
/*! tailwindcss v4.1.17 | MIT License | https://tailwindcss.com */:root{--duo-head-h:38px}*{box-sizing:border-box}body{margin:0;font-family:"Noto Serif SC",serif;color:var(--ink);font-size:14px;background:linear-gradient(var(--grid) 1px,transparent 1px),linear-gradient(90deg,var(--grid) 1px,transparent 1px),var(--bg);background-size:20px 20px}.preserve-format{white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.label{font-weight:600;color:var(--muted);min-width:90px;margin-right:5px}hr.dashed{border:none;border-top:1px dashed var(--line);margin:20px 0}html,body,.status-ui-container,.status-main-content,.status-tab-content-area,.role-ribbon-container{max-width:100%;overflow-x:hidden}#content_main,#main-content{max-width:100%;contain:inline-size}#main-content,#main-content *{max-width:100% !important}#main-content img,#main-content video{height:auto}#main-content table{display:block;overflow-x:auto}#main-content pre{white-space:pre-wrap;overflow-x:auto}.debug-console{font-family:ui-monospace,SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;background:#0f0f0f;color:#e7e7e7;border:1px solid var(--line);border-radius:4px;padding:10px;height:260px;overflow:auto;white-space:pre-wrap;word-break:break-word}.debug-line{padding:2px 0;border-bottom:1px dashed hsla(0,0%,100%,.08)}.debug-badge{font-size:.75em;padding:2px 6px;border-radius:10px;margin-right:6px;background:#333;color:#eee}.debug-line.warn .debug-badge{background:#9b7b2f}.debug-line.error .debug-badge{background:#b2453d}.debug-stats{font-size:.85em;color:#cfcfcf;margin:6px 0 0;opacity:.9}:root,:root[data-theme=light]{--bg:#fffdf7;--paper:#fcfaf5;--ink:#4a3f35;--muted:#6b5a4b;--line:#d3c8b8;--tile:#e0d5c4;--pad:12px;--control-bg:#fff7e8;--control-border:#c9b59e;--control-focus:#b6782b;--btn-accent:#b76e2b;--btn-accent-hover:#a95f1e;--btn-muted:#efe8de;--btn-muted-border:#d3c8b8;--grid:rgba(224,213,196,0.1);--avatar-bg:#f5f1e8;--bar-bg:#f0ece4;--tab-active:#8c7b6a;--cal-cell-bg:var(--bg);--cal-cell-border:var(--line);--cal-hover-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-hover-bg:color-mix(in srgb,var(--paper) 88%,black 12%)}--cal-festival-bg:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-bg:color-mix(in srgb,var(--btn-accent) 10%,white 90%)}--cal-festival-border:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-border:color-mix(in srgb,var(--btn-accent) 30%,white 70%)}--cal-festival-text:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-text:color-mix(in srgb,var(--btn-accent) 75%,black 25%)}--cal-today-ring:var(--control-focus)}:root[data-theme=dark]{--bg:#13110f;--paper:#1b1916;--ink:#efe8de;--muted:#b7a899;--line:#4b433a;--tile:#2a241e;--pad:12px;--control-bg:#1f1b16;--control-border:#5b4e41;--control-focus:#d89a4a;--btn-accent:#c57a33;--btn-accent-hover:#b56b24;--btn-muted:#2a241e;--btn-muted-border:#4b433a;--grid:rgba(255,255,255,0.04);--avatar-bg:#1f1b17;--bar-bg:#2a2520;--tab-active:#c8b49d;--cal-cell-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-cell-bg:color-mix(in srgb,var(--paper) 92%,black 8%)}--cal-cell-border:var(--line);@supports (color:color-mix(in lab,red,red)){--cal-cell-border:color-mix(in srgb,var(--line) 85%,white 15%)}--cal-hover-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-hover-bg:color-mix(in srgb,var(--paper) 80%,white 0%)}--cal-festival-bg:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-bg:color-mix(in srgb,var(--btn-accent) 14%,var(--paper) 86%)}--cal-festival-border:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-border:color-mix(in srgb,var(--btn-accent) 45%,var(--line) 55%)}--cal-festival-text:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-text:color-mix(in srgb,var(--btn-accent) 80%,white 20%)}--cal-today-ring:var(--control-focus)}@media (max-width:480px){.calendar-day .fest{font-size:.75em}}input[type=text],input[type=number],input[type=search],select,textarea{background-color:var(--control-bg);border:1px solid var(--control-border);border-radius:4px;padding:6px 8px;color:var(--ink);transition:border-color .2s,box-shadow .2s}input[type=text]:focus,input[type=number]:focus,input[type=search]:focus,select:focus,textarea:focus{outline:none;border-color:var(--control-focus);box-shadow:0 0 0 2px var(--control-focus);@supports (color:color-mix(in lab,red,red)){box-shadow:0 0 0 2px color-mix(in srgb,var(--control-focus) 25%,transparent)}}.collapsible-section>summary{position:relative;padding-left:1.2em;cursor:pointer;list-style:none}.collapsible-section>summary::before{content:"▶";position:absolute;left:0;top:50%;transform:translateY(-50%) rotate(0deg);transition:transform .2s;font-size:.8em;color:var(--muted)}.collapsible-section[open]>summary::before{transform:translateY(-50%) rotate(90deg)}
</style></head><body><div id="app"></div></body></html>