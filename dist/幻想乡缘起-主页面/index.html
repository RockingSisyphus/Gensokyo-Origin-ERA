<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>系统状态</title><script type="module">var __webpack_modules__ = {
  441: (__unused_webpack_module, exports) => {
    var __webpack_unused_export__;
    __webpack_unused_export__ = {
      value: true
    };
    exports.A = (sfc, props) => {
      const target = sfc.__vccOpts || sfc;
      for (const [key, val] of props) {
        target[key] = val;
      }
      return target;
    };
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

var __webpack_exports__ = {};

const external_Vue_namespaceObject = Vue;

const external_z_namespaceObject = z;

const mkValueSchema = external_z_namespaceObject.z.string().nullable();

const PeriodAnchorSchema = external_z_namespaceObject.z.object({
  newDawn: mkValueSchema,
  newMorning: mkValueSchema,
  newNoon: mkValueSchema,
  newAfternoon: mkValueSchema,
  newDusk: mkValueSchema,
  newNight: mkValueSchema,
  newFirstHalfNight: mkValueSchema,
  newSecondHalfNight: mkValueSchema
}).partial().default({});

const SeasonAnchorSchema = external_z_namespaceObject.z.object({
  newSpring: mkValueSchema,
  newSummer: mkValueSchema,
  newAutumn: mkValueSchema,
  newWinter: mkValueSchema
}).partial().default({});

const TimeChatMkAnchorsSchema = external_z_namespaceObject.z.object({
  newPeriod: mkValueSchema,
  period: PeriodAnchorSchema,
  newDay: mkValueSchema,
  newWeek: mkValueSchema,
  newMonth: mkValueSchema,
  newSeason: mkValueSchema,
  season: SeasonAnchorSchema,
  newYear: mkValueSchema
}).partial().default({});

const createEmptyAnchors = () => ({});

const TimeChatMkSyncCacheSchema = external_z_namespaceObject.z.object({
  anchors: TimeChatMkAnchorsSchema.optional()
}).optional().default(() => ({
  anchors: createEmptyAnchors()
}));

const TimeChatMkSyncRuntimeSchema = external_z_namespaceObject.z.object({
  anchors: TimeChatMkAnchorsSchema.optional()
}).optional().default(() => ({
  anchors: createEmptyAnchors()
}));

const BY_PERIOD_KEYS = null && TIME_PERIOD_KEYS;

const BY_SEASON_KEYS = null && TIME_SEASON_KEYS;

const ClockAckSchema = external_z_namespaceObject.z.object({
  dayID: external_z_namespaceObject.z.number(),
  weekID: external_z_namespaceObject.z.number(),
  monthID: external_z_namespaceObject.z.number(),
  yearID: external_z_namespaceObject.z.number(),
  periodID: external_z_namespaceObject.z.number(),
  periodIdx: external_z_namespaceObject.z.number(),
  seasonID: external_z_namespaceObject.z.number(),
  seasonIdx: external_z_namespaceObject.z.number()
});

const NowSchema = external_z_namespaceObject.z.object({
  iso: external_z_namespaceObject.z.string(),
  year: external_z_namespaceObject.z.number(),
  month: external_z_namespaceObject.z.number(),
  day: external_z_namespaceObject.z.number(),
  weekdayIndex: external_z_namespaceObject.z.number(),
  weekdayName: external_z_namespaceObject.z.string(),
  periodName: external_z_namespaceObject.z.string(),
  periodIdx: external_z_namespaceObject.z.number(),
  minutesSinceMidnight: external_z_namespaceObject.z.number(),
  seasonName: external_z_namespaceObject.z.string(),
  seasonIdx: external_z_namespaceObject.z.number(),
  hour: external_z_namespaceObject.z.number(),
  minute: external_z_namespaceObject.z.number(),
  hm: external_z_namespaceObject.z.string()
});

const ClockFlagsSchema = external_z_namespaceObject.z.object({
  newPeriod: external_z_namespaceObject.z.boolean(),
  byPeriod: external_z_namespaceObject.z.object({
    newDawn: external_z_namespaceObject.z.boolean(),
    newMorning: external_z_namespaceObject.z.boolean(),
    newNoon: external_z_namespaceObject.z.boolean(),
    newAfternoon: external_z_namespaceObject.z.boolean(),
    newDusk: external_z_namespaceObject.z.boolean(),
    newNight: external_z_namespaceObject.z.boolean(),
    newFirstHalfNight: external_z_namespaceObject.z.boolean(),
    newSecondHalfNight: external_z_namespaceObject.z.boolean()
  }),
  newDay: external_z_namespaceObject.z.boolean(),
  newWeek: external_z_namespaceObject.z.boolean(),
  newMonth: external_z_namespaceObject.z.boolean(),
  newSeason: external_z_namespaceObject.z.boolean(),
  bySeason: external_z_namespaceObject.z.object({
    newSpring: external_z_namespaceObject.z.boolean(),
    newSummer: external_z_namespaceObject.z.boolean(),
    newAutumn: external_z_namespaceObject.z.boolean(),
    newWinter: external_z_namespaceObject.z.boolean()
  }),
  newYear: external_z_namespaceObject.z.boolean()
});

const CLOCK_ROOT_FLAG_KEYS = null && [ "newPeriod", "newDay", "newWeek", "newMonth", "newSeason", "newYear" ];

const ClockSchema = external_z_namespaceObject.z.object({
  now: NowSchema,
  flags: ClockFlagsSchema,
  mkAnchors: TimeChatMkAnchorsSchema.optional(),
  previousMkAnchors: TimeChatMkAnchorsSchema.optional()
});

const EMPTY_NOW = {
  iso: "",
  year: 0,
  month: 0,
  day: 0,
  weekdayIndex: 0,
  weekdayName: "",
  periodName: "",
  periodIdx: 0,
  minutesSinceMidnight: 0,
  seasonName: "",
  seasonIdx: 0,
  hour: 0,
  minute: 0,
  hm: ""
};

const EMPTY_FLAGS = {
  newPeriod: false,
  byPeriod: {
    newDawn: false,
    newMorning: false,
    newNoon: false,
    newAfternoon: false,
    newDusk: false,
    newNight: false,
    newFirstHalfNight: false,
    newSecondHalfNight: false
  },
  newDay: false,
  newWeek: false,
  newMonth: false,
  newSeason: false,
  bySeason: {
    newSpring: false,
    newSummer: false,
    newAutumn: false,
    newWinter: false
  },
  newYear: false
};

const OtherCharacterInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  target: external_z_namespaceObject.z.string()
});

const AyaNewsEntrySchema = external_z_namespaceObject.z.object({
  location: external_z_namespaceObject.z.string(),
  otherCharacters: external_z_namespaceObject.z.array(OtherCharacterInfoSchema),
  target: external_z_namespaceObject.z.string(),
  clockAck: ClockAckSchema
});

const AyaNewsSchema = external_z_namespaceObject.z.object({
  entries: external_z_namespaceObject.z.array(AyaNewsEntrySchema)
});

const ERA_EVENT_NAMES = {
  INSERT_BY_OBJECT: "era:insertByObject",
  UPDATE_BY_OBJECT: "era:updateByObject",
  INSERT_BY_PATH: "era:insertByPath",
  UPDATE_BY_PATH: "era:updateByPath",
  DELETE_BY_OBJECT: "era:deleteByObject",
  DELETE_BY_PATH: "era:deleteByPath",
  GET_CURRENT_VARS: "era:getCurrentVars",
  GET_SNAPSHOT_AT_MK: "era:getSnapshotAtMk",
  GET_SNAPSHOTS_BETWEEN_MKS: "era:getSnapshotsBetweenMks",
  GET_SNAPSHOT_AT_MID: "era:getSnapshotAtMId",
  GET_SNAPSHOTS_BETWEEN_MIDS: "era:getSnapshotsBetweenMIds",
  REQUEST_WRITE_DONE: "era:requestWriteDone"
};

const ERA_BROADCAST_EVENT_NAMES = {
  WRITE_DONE: "era:writeDone",
  QUERY_RESULT: "era:queryResult"
};

const QueryResultItemSchema = external_z_namespaceObject.z.object({
  mk: external_z_namespaceObject.z.string(),
  message_id: external_z_namespaceObject.z.number(),
  is_user: external_z_namespaceObject.z.boolean(),
  stat: external_z_namespaceObject.z.any(),
  statWithoutMeta: external_z_namespaceObject.z.any()
});

const PreprocessStringifiedObject = schema => external_z_namespaceObject.z.preprocess(val => {
  if (typeof val === "string") {
    try {
      return JSON.parse(val);
    } catch (e) {
      return val;
    }
  }
  return val;
}, schema);

const TimeUnitSchema = external_z_namespaceObject.z.enum([ "period", "day", "week", "month", "season", "year" ]);

const ForgettingRuleSchema = external_z_namespaceObject.z.object({
  triggerFlag: external_z_namespaceObject.z.string(),
  decrease: external_z_namespaceObject.z.number()
});

const AffectionStageWithForgetSchema = external_z_namespaceObject.z.object({
  threshold: external_z_namespaceObject.z.number(),
  name: external_z_namespaceObject.z.string(),
  describe: external_z_namespaceObject.z.string().nullable().optional(),
  patienceUnit: TimeUnitSchema.optional(),
  visit: external_z_namespaceObject.z.object({
    enabled: external_z_namespaceObject.z.boolean().optional(),
    probBase: external_z_namespaceObject.z.number().optional(),
    probK: external_z_namespaceObject.z.number().optional(),
    coolUnit: TimeUnitSchema.optional()
  }).optional(),
  forgettingSpeed: external_z_namespaceObject.z.array(PreprocessStringifiedObject(ForgettingRuleSchema)).optional(),
  affectionGrowthLimit: external_z_namespaceObject.z.object({
    max: external_z_namespaceObject.z.number(),
    divisor: external_z_namespaceObject.z.number()
  }).optional()
}).passthrough();

const ActionSchema = external_z_namespaceObject.z.object({
  do: external_z_namespaceObject.z.string(),
  to: external_z_namespaceObject.z.string().optional(),
  from: external_z_namespaceObject.z.string().optional(),
  source: external_z_namespaceObject.z.string().optional()
});

const EntrySchema = external_z_namespaceObject.z.object({
  when: external_z_namespaceObject.z.any(),
  action: ActionSchema,
  priority: external_z_namespaceObject.z.number().optional()
});

const CharacterSettingsSchema = external_z_namespaceObject.z.object({
  id: external_z_namespaceObject.z.string(),
  name: external_z_namespaceObject.z.string(),
  affectionStages: external_z_namespaceObject.z.array(AffectionStageWithForgetSchema),
  specials: external_z_namespaceObject.z.array(EntrySchema),
  routine: external_z_namespaceObject.z.array(EntrySchema)
});

const CharacterSettingsMapSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterSettingsSchema);

const IncidentDetailSchema = external_z_namespaceObject.z.object({
  异变细节: external_z_namespaceObject.z.string(),
  主要地区: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  异变退治者: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional(),
  异变已结束: external_z_namespaceObject.z.boolean()
});

const IncidentsSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), IncidentDetailSchema);

const MapSizeSchema = external_z_namespaceObject.z.object({
  width: external_z_namespaceObject.z.number(),
  height: external_z_namespaceObject.z.number()
});

const MapPositionSchema = external_z_namespaceObject.z.object({
  x: external_z_namespaceObject.z.number(),
  y: external_z_namespaceObject.z.number()
});

const MapLeafSchema = external_z_namespaceObject.z.object({
  pos: MapPositionSchema,
  htmlEle: external_z_namespaceObject.z.string()
}).passthrough();

const MapTreeSchema = external_z_namespaceObject.z.lazy(() => external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.union([ MapLeafSchema, MapTreeSchema ])));

const MapGraphSchema = external_z_namespaceObject.z.object({
  mapSize: MapSizeSchema,
  tree: MapTreeSchema,
  edges: external_z_namespaceObject.z.array(PreprocessStringifiedObject(external_z_namespaceObject.z.object({
    a: external_z_namespaceObject.z.string(),
    b: external_z_namespaceObject.z.string()
  }))).optional(),
  aliases: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string())).optional()
});

const WORLD_DEFAULTS = {
  fallbackPlace: "博丽神社",
  mainStoryTag: "gensokyo"
};

const WorldSchema = external_z_namespaceObject.z.object({
  map_graph: MapGraphSchema.optional(),
  fallbackPlace: external_z_namespaceObject.z.string().default(WORLD_DEFAULTS.fallbackPlace)
}).passthrough();

const 世界Schema = external_z_namespaceObject.z.object({
  timeProgress: external_z_namespaceObject.z.number()
}).passthrough();

const IncidentRuntimeInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  detail: external_z_namespaceObject.z.string(),
  solver: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  mainLoc: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  isFinished: external_z_namespaceObject.z.boolean(),
  raw: IncidentDetailSchema
});

const runtime_ActionSchema = external_z_namespaceObject.z.object({
  do: external_z_namespaceObject.z.string(),
  to: external_z_namespaceObject.z.string().optional(),
  from: external_z_namespaceObject.z.string().optional(),
  source: external_z_namespaceObject.z.string().optional()
});

const IncidentSchema = external_z_namespaceObject.z.object({
  decision: external_z_namespaceObject.z.enum([ "continue", "start_new", "daily" ]),
  current: IncidentRuntimeInfoSchema.optional(),
  spawn: IncidentRuntimeInfoSchema.optional(),
  remainingCooldown: external_z_namespaceObject.z.number().optional(),
  isIncidentActive: external_z_namespaceObject.z.boolean()
});

const CurrentFestivalInfoSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  host: external_z_namespaceObject.z.string(),
  customs: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  month: external_z_namespaceObject.z.number(),
  start_day: external_z_namespaceObject.z.number(),
  end_day: external_z_namespaceObject.z.number()
});

const NextFestivalInfoSchema = CurrentFestivalInfoSchema.extend({
  days_until: external_z_namespaceObject.z.number()
});

const FestivalSchema = external_z_namespaceObject.z.object({
  ongoing: external_z_namespaceObject.z.boolean(),
  upcoming: external_z_namespaceObject.z.boolean(),
  current: CurrentFestivalInfoSchema.nullable(),
  next: NextFestivalInfoSchema.nullable()
});

const CharacterDistributionSchema = external_z_namespaceObject.z.object({
  playerLocation: external_z_namespaceObject.z.string().nullable(),
  npcByLocation: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()))
});

const CharacterRuntimeSchema = external_z_namespaceObject.z.object({
  affectionStage: AffectionStageWithForgetSchema.optional(),
  decision: runtime_ActionSchema.optional(),
  companionDecision: runtime_ActionSchema.optional()
});

const BfsPathSchema = external_z_namespaceObject.z.object({
  hops: external_z_namespaceObject.z.number(),
  steps: external_z_namespaceObject.z.array(external_z_namespaceObject.z.object({
    from: external_z_namespaceObject.z.string(),
    to: external_z_namespaceObject.z.string()
  }))
});

const RouteSchema = external_z_namespaceObject.z.object({
  destination: external_z_namespaceObject.z.string(),
  path: BfsPathSchema
});

const RouteInfoSchema = external_z_namespaceObject.z.object({
  candidates: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  routes: external_z_namespaceObject.z.array(RouteSchema)
});

const FullMapLeafSchema = MapLeafSchema.extend({
  name: external_z_namespaceObject.z.string()
});

const AreaRuntimeInfoSchema = external_z_namespaceObject.z.object({
  graph: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), external_z_namespaceObject.z.boolean())),
  legal_locations: external_z_namespaceObject.z.array(FullMapLeafSchema),
  neighbors: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  loadArea: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  route: RouteInfoSchema,
  mapSize: MapSizeSchema.optional()
});

const RuntimeSchema = external_z_namespaceObject.z.object({
  incident: IncidentSchema.optional(),
  clock: ClockSchema.optional(),
  area: AreaRuntimeInfoSchema.optional(),
  festival: FestivalSchema.optional(),
  characterDistribution: CharacterDistributionSchema.optional(),
  character: external_z_namespaceObject.z.object({
    chars: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterRuntimeSchema),
    partitions: external_z_namespaceObject.z.object({
      coLocated: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
      remote: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string())
    })
  }).optional(),
  characterLog: external_z_namespaceObject.z.object({}).passthrough().optional(),
  characterSettings: CharacterSettingsMapSchema.optional(),
  snapshots: external_z_namespaceObject.z.array(QueryResultItemSchema).optional(),
  ayaNews: AyaNewsSchema.optional()
});

const CharacterCacheSchema = external_z_namespaceObject.z.object({
  visit: external_z_namespaceObject.z.object({
    cooling: external_z_namespaceObject.z.boolean().optional()
  }).optional()
});

const IncidentCacheSchema = external_z_namespaceObject.z.object({
  incidentCooldownAnchor: external_z_namespaceObject.z.number().nullable().optional()
});

const CacheSchema = external_z_namespaceObject.z.object({
  time: external_z_namespaceObject.z.object({
    clockAck: ClockAckSchema.optional()
  }).optional().default({}),
  incident: IncidentCacheSchema.optional().default({}),
  character: external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterCacheSchema).optional().default({}),
  timeChatMkSync: TimeChatMkSyncCacheSchema.optional().default({})
});

const CharacterSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  好感度: external_z_namespaceObject.z.number(),
  所在地区: external_z_namespaceObject.z.string().nullable(),
  居住地区: external_z_namespaceObject.z.string().nullable(),
  affectionStages: external_z_namespaceObject.z.array(PreprocessStringifiedObject(AffectionStageWithForgetSchema)).default([]),
  specials: external_z_namespaceObject.z.array(PreprocessStringifiedObject(EntrySchema)).default([]),
  routine: external_z_namespaceObject.z.array(PreprocessStringifiedObject(EntrySchema)).default([]),
  目标: external_z_namespaceObject.z.string().optional()
});

const CharsSchema = external_z_namespaceObject.z.record(external_z_namespaceObject.z.string(), CharacterSchema);

const CHARACTER_FIELDS = {
  affection: "好感度",
  currentLocation: "所在地区",
  home: "居住地区"
};

const UiConfigSchema = external_z_namespaceObject.z.object({
  theme: external_z_namespaceObject.z.enum([ "light", "dark" ]).default("light")
});

const IncidentPoolItemSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  detail: external_z_namespaceObject.z.string(),
  mainLoc: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ])
});

const IncidentConfigSchema = external_z_namespaceObject.z.object({
  cooldownMinutes: external_z_namespaceObject.z.number(),
  forceTrigger: external_z_namespaceObject.z.boolean(),
  isRandomPool: external_z_namespaceObject.z.boolean(),
  pool: external_z_namespaceObject.z.array(PreprocessStringifiedObject(IncidentPoolItemSchema)),
  randomCore: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()),
  randomType: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string())
});

const FlagHistoryLimitSchema = external_z_namespaceObject.z.number().int().min(0);

const PeriodFlagHistoryLimitSchema = external_z_namespaceObject.z.object({
  newDawn: FlagHistoryLimitSchema,
  newMorning: FlagHistoryLimitSchema,
  newNoon: FlagHistoryLimitSchema,
  newAfternoon: FlagHistoryLimitSchema,
  newDusk: FlagHistoryLimitSchema,
  newNight: FlagHistoryLimitSchema,
  newFirstHalfNight: FlagHistoryLimitSchema,
  newSecondHalfNight: FlagHistoryLimitSchema
}).partial().default({});

const SeasonFlagHistoryLimitSchema = external_z_namespaceObject.z.object({
  newSpring: FlagHistoryLimitSchema,
  newSummer: FlagHistoryLimitSchema,
  newAutumn: FlagHistoryLimitSchema,
  newWinter: FlagHistoryLimitSchema
}).partial().default({});

const TimeFlagHistoryLimitsSchema = external_z_namespaceObject.z.object({
  newPeriod: FlagHistoryLimitSchema.optional(),
  newDay: FlagHistoryLimitSchema.optional(),
  newWeek: FlagHistoryLimitSchema.optional(),
  newMonth: FlagHistoryLimitSchema.optional(),
  newSeason: FlagHistoryLimitSchema.optional(),
  newYear: FlagHistoryLimitSchema.optional(),
  period: PeriodFlagHistoryLimitSchema.optional(),
  season: SeasonFlagHistoryLimitSchema.optional()
}).default({});

const TimeConfigSchema = external_z_namespaceObject.z.object({
  epochISO: external_z_namespaceObject.z.string().datetime({
    message: "无效的 ISO 8601 日期时间格式"
  }),
  flagHistoryLimits: TimeFlagHistoryLimitsSchema
}).passthrough();

const DEFAULT_TIME_CONFIG = {
  epochISO: "2025-10-24T06:00:00+09:00",
  flagHistoryLimits: {}
};

const AffectionConfigSchema = external_z_namespaceObject.z.object({
  affectionStages: external_z_namespaceObject.z.array(PreprocessStringifiedObject(AffectionStageWithForgetSchema)),
  loveThreshold: external_z_namespaceObject.z.number().optional(),
  hateThreshold: external_z_namespaceObject.z.number().optional()
});

const ConfigSchema = external_z_namespaceObject.z.object({
  affection: AffectionConfigSchema,
  time: TimeConfigSchema.default(DEFAULT_TIME_CONFIG),
  incident: IncidentConfigSchema.optional(),
  ui: UiConfigSchema
}).passthrough();

const FestivalDefinitionSchema = external_z_namespaceObject.z.object({
  name: external_z_namespaceObject.z.string(),
  month: external_z_namespaceObject.z.number(),
  start_day: external_z_namespaceObject.z.number(),
  end_day: external_z_namespaceObject.z.number(),
  host: external_z_namespaceObject.z.string().optional(),
  customs: external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()).optional()
});

const FestivalsListSchema = external_z_namespaceObject.z.array(PreprocessStringifiedObject(FestivalDefinitionSchema)).default([]);

const UserSchema = external_z_namespaceObject.z.object({
  姓名: external_z_namespaceObject.z.string().nullable(),
  身份: external_z_namespaceObject.z.string().nullable(),
  性别: external_z_namespaceObject.z.string().nullable(),
  年龄: external_z_namespaceObject.z.string().nullable(),
  特殊能力: external_z_namespaceObject.z.string().nullable(),
  所在地区: external_z_namespaceObject.z.string().nullable(),
  居住地区: external_z_namespaceObject.z.string().nullable(),
  重要经历: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional().nullable(),
  人际关系: external_z_namespaceObject.z.union([ external_z_namespaceObject.z.string(), external_z_namespaceObject.z.array(external_z_namespaceObject.z.string()) ]).optional().nullable()
});

const USER_FIELDS = {
  name: "姓名",
  identity: "身份",
  gender: "性别",
  age: "年龄",
  abilities: "特殊能力",
  currentLocation: "所在地区",
  home: "居住地区",
  events: "重要经历",
  relationships: "人际关系"
};

const StatSchema = external_z_namespaceObject.z.object({
  config: ConfigSchema,
  chars: CharsSchema,
  user: UserSchema,
  world: WorldSchema.optional(),
  世界: 世界Schema,
  cache: CacheSchema.optional(),
  incidents: IncidentsSchema.default({}),
  festivals_list: FestivalsListSchema,
  weather: external_z_namespaceObject.z.string().optional(),
  文文新闻: external_z_namespaceObject.z.string().optional()
});

const ERA_VARIABLE_PATH = {
  MAIN_FONT_PERCENT: "config.ui.mainFontPercent",
  FONT_SCALE_STEP_PCT: "config.ui.fontScaleStepPct",
  UI_THEME: "config.ui.theme",
  MAP_ASCII: "world.map_ascii",
  MAP_GRAPH: "world.map_graph",
  FALLBACK_PLACE: "world.fallbackPlace",
  INCIDENT_IMMEDIATE_TRIGGER: "config.incident.immediate_trigger",
  INCIDENT_RANDOM_POOL: "config.incident.random_pool",
  RUNTIME_PREFIX: "runtime.",
  INCIDENT_COOLDOWN: "config.incident.cooldown",
  TIME_PROGRESS: "世界.timeProgress",
  FESTIVALS_LIST: "festivals_list",
  NEWS_TEXT: "文文新闻",
  EXTRA_MAIN: "附加正文",
  USER_LOCATION: "user.所在地区",
  USER_HOME: "user.居住地区",
  CHARS: "chars",
  CHAR_HOME: "居住地区",
  CHAR_LOCATION: "所在地区",
  CHAR_AFFECTION: "好感度",
  CHAR_AFFECTION_STAGE: "好感度等级",
  USER_DATA: "user",
  USER_EVENTS: "重要经历",
  USER_RELATIONSHIPS: "人际关系",
  SKIP_VISIT_HUNTERS: "config.meetStuff.skipVisitHunters",
  SKIP_SLEEP_HUNTERS: "config.nightStuff.skipSleepHunters",
  UI_RIBBON_STEP: "config.ui.ribbonStep",
  AFFECTION_STAGES: "config.affection.affectionStages",
  AFFECTION_LOVE_THRESHOLD: "config.affection.loveThreshold",
  AFFECTION_HATE_THRESHOLD: "config.affection.hateThreshold",
  CONFIG_ROOT: "config",
  RUNTIME_AFFECTION_STAGE_NAME_PATH: charId => `character.chars.${charId}.affectionStage.name`
};

const PROJECT_NAME = "GSKO-FACE";

const DEBUG_CONFIG_LS_KEY = "gsko_era_debug_config";

let enabledPatterns = [];

let disabledPatterns = [];

function loadDebugConfig() {
  try {
    const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
    const config = JSON.parse(configStr);
    const toRegex = p => new RegExp(`^${p.replace(/\*/g, ".*?")}$`);
    enabledPatterns = (config.enabled || []).map(toRegex);
    disabledPatterns = (config.disabled || []).map(toRegex);
  } catch (e) {
    console.error(`《${PROJECT_NAME}-Log》: 加载调试配置失败。`, e);
    enabledPatterns = [];
    disabledPatterns = [];
  }
}

function isDebugEnabled(moduleName) {
  if (!moduleName) return false;
  if (disabledPatterns.some(re => re.test(moduleName))) {
    return false;
  }
  if (enabledPatterns.length === 0) {
    return false;
  }
  if (enabledPatterns.some(re => re.test(moduleName))) {
    return true;
  }
  return false;
}

function updateConfig(newConfig) {
  const uniqueConfig = {
    enabled: [ ...new Set(newConfig.enabled) ],
    disabled: [ ...new Set(newConfig.disabled) ]
  };
  globalThis.localStorage?.setItem(DEBUG_CONFIG_LS_KEY, JSON.stringify(uniqueConfig));
  loadDebugConfig();
  console.log(`%c《${PROJECT_NAME}-Log》调试模式已更新。`, "color: #3498db; font-weight: bold;", {
    "启用 (Enabled)": uniqueConfig.enabled,
    "禁用 (Disabled)": uniqueConfig.disabled
  });
}

loadDebugConfig();

if (typeof globalThis !== "undefined") {
  const eraDebug = {
    add(pattern) {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      enabled.add(pattern);
      disabled.delete(pattern);
      updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    remove(pattern) {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      const enabled = new Set(config.enabled || []);
      const disabled = new Set(config.disabled || []);
      disabled.add(pattern);
      enabled.delete(pattern);
      updateConfig({
        enabled: Array.from(enabled),
        disabled: Array.from(disabled)
      });
    },
    status() {
      const configStr = globalThis.localStorage?.getItem(DEBUG_CONFIG_LS_KEY) || '{"enabled":[],"disabled":[]}';
      const config = JSON.parse(configStr);
      console.log(`%c《${PROJECT_NAME}-Log》当前调试配置:`, "color: #3498db; font-weight: bold;", config);
    },
    clear() {
      updateConfig({
        enabled: [],
        disabled: []
      });
    }
  };
  globalThis.eraDebug = eraDebug;
}

const logContext = {
  mk: ""
};

class Logger {
  moduleName;
  constructor(moduleName) {
    this.moduleName = moduleName || this._getModuleNameFromStack() || "unknown";
  }
  _getModuleNameFromStack() {
    try {
      const stack = (new Error).stack || "";
      const callerLine = stack.split("\n").find(line => (line.includes(`/src/${PROJECT_NAME}/`) || line.includes(`/dist/${PROJECT_NAME}/`) || line.includes(`\\src\\${PROJECT_NAME}\\`) || line.includes(`\\dist\\${PROJECT_NAME}\\`)) && !line.includes("/utils/log.ts"));
      if (!callerLine) {
        return null;
      }
      const match = callerLine.match(new RegExp(`(src|dist)[\\\\/]${PROJECT_NAME}[\\\\/]([^?:]+)`));
      if (!match || !match[2]) {
        return null;
      }
      const path = match[2];
      return path.replace(/\\/g, "/").replace(/\.(vue|ts|js)$/, "").replace(/\/index$/, "");
    } catch (e) {
      console.error(`《${PROJECT_NAME}-Log-Debug》: 解析模块名时发生意外错误。`, e);
      return null;
    }
  }
  formatMessage(funcName, message) {
    const mkString = logContext.mk ? `（${logContext.mk}）` : "";
    return `《${PROJECT_NAME}》${mkString}「${this.moduleName}」【${funcName}】${String(message)}`;
  }
  debug(funcName, message, obj) {
    if (!isDebugEnabled(this.moduleName)) {
      return;
    }
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.debug(formattedMessage, obj);
    } else {
      console.debug(formattedMessage);
    }
  }
  log(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.log(`%c${formattedMessage}`, "color: #3498db;", obj);
    } else {
      console.log(`%c${formattedMessage}`, "color: #3498db;");
    }
  }
  warn(funcName, message, obj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (obj !== undefined) {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;", obj);
    } else {
      console.warn(`%c${formattedMessage}`, "color: #f39c12;");
    }
  }
  error(funcName, message, errorObj) {
    const formattedMessage = this.formatMessage(funcName, message);
    if (errorObj !== undefined) {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;", errorObj);
    } else {
      console.error(`%c${formattedMessage}`, "color: #e74c3c; font-weight: bold;");
    }
  }
}

const logger = new Logger("幻想乡缘起-主页面/utils/format");

function firstVal(x) {
  return Array.isArray(x) ? x.length ? x[0] : "" : x;
}

function get(obj, path, fallback = "") {
  try {
    const ks = Array.isArray(path) ? path : String(path).split(".");
    let cur = obj;
    for (const k of ks) {
      if (!cur || typeof cur !== "object" || !(k in cur)) {
        logger.debug("get", "未找到键，使用默认值。", {
          路径: String(path),
          缺失键: String(k),
          默认值: fallback
        });
        return fallback;
      }
      cur = cur[k];
    }
    const v = firstVal(cur);
    if (v == null) {
      logger.debug("get", "路径存在但值为空(null/undefined)，使用默认值。", {
        路径: String(path),
        默认值: fallback
      });
      return fallback;
    }
    return v;
  } catch (e) {
    logger.error("get", "异常，使用默认值。", {
      路径: String(path),
      异常: String(e),
      默认值: fallback
    });
    return fallback;
  }
}

function format_text(id, raw) {
  const el = document.getElementById(id);
  if (!el) {
    logger.warn("text", "目标元素不存在，跳过写入。", {
      元素ID: id
    });
    return;
  }
  el.textContent = toText(raw);
}

function getRaw(obj, path, fallback = null) {
  try {
    const ks = Array.isArray(path) ? path : String(path).split(".");
    let cur = obj;
    for (const k of ks) {
      if (!cur || typeof cur !== "object" || !(k in cur)) {
        return fallback;
      }
      cur = cur[k];
    }
    return cur == null ? fallback : cur;
  } catch (e) {
    logger.error("getRaw", "异常，使用默认值。", {
      路径: String(path),
      异常: String(e),
      默认值: fallback
    });
    return fallback;
  }
}

function toText(v) {
  if (v == null || v === "") return "—";
  if (Array.isArray(v)) return v.length ? v.join("；") : "—";
  if (typeof v === "object") return JSON.stringify(v);
  return String(v);
}

function getStr(obj, path, fallback = "") {
  const rawValue = getRaw(obj, path, null);
  if (rawValue === null) {
    return toText(fallback);
  }
  return toText(rawValue);
}

const ContentBiovue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ContentBio",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/tabs/ContentBio");
    const userEvents = (0, external_Vue_namespaceObject.ref)(null);
    const userRelationships = (0, external_Vue_namespaceObject.ref)(null);
    function update({statWithoutMeta: stat}) {
      const funcName = "update";
      logger.log(funcName, "接收到更新指令，开始更新履历与关系", {
        stat
      });
      const userData = stat.user;
      logger.debug(funcName, "提取的用户数据", {
        userData
      });
      const eventsText = toText(userData.重要经历);
      const relationshipsText = toText(userData.人际关系);
      logger.debug(funcName, "处理后的待显示文本", {
        eventsText,
        relationshipsText
      });
      if (userEvents.value) {
        userEvents.value.textContent = eventsText;
        logger.log(funcName, "成功更新“重要经历”内容。");
      } else {
        logger.warn(funcName, "无法找到“重要经历”的 DOM 元素 (userEvents ref)，请检查模板。");
      }
      if (userRelationships.value) {
        userRelationships.value.textContent = relationshipsText;
        logger.log(funcName, "成功更新“人际关系”内容。");
      } else {
        logger.warn(funcName, "无法找到“人际关系”的 DOM 元素 (userRelationships ref)，请检查模板。");
      }
    }
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🧭"), (0, external_Vue_namespaceObject.createTextVNode)("重要经历") ], -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      ref_key: "userEvents",
      ref: userEvents,
      class: "preserve-format"
    }, "—", 512), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("hr", {
      class: "dashed"
    }, null, -1)), _cache[2] || (_cache[2] = (0, external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🤝"), (0, external_Vue_namespaceObject.createTextVNode)("人际关系") ], -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      ref_key: "userRelationships",
      ref: userRelationships,
      class: "preserve-format"
    }, "—", 512) ]));
  }
});

var exportHelper = __webpack_require__(441);

const __exports__ = (0, exportHelper.A)(ContentBiovue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-3e602d5b" ] ]);

const ContentBio = __exports__;

const eraWriter_logger = new Logger("幻想乡缘起-主页面/utils/eraWriter");

function updateEraVariable(path, value) {
  const funcName = "updateEraVariable";
  if (!path || typeof path !== "string") {
    eraWriter_logger.warn(funcName, "调用失败：path 无效。", {
      path
    });
    return;
  }
  const eventData = {
    path,
    value
  };
  try {
    eraWriter_logger.log(funcName, `准备发送 era:updateByPath 事件`, eventData);
    eventEmit("era:updateByPath", eventData);
  } catch (e) {
    eraWriter_logger.error(funcName, "发送 era:updateByPath 事件时出现异常", e);
  }
}

function updateEraVariableByObject(obj) {
  const funcName = "updateEraVariableByObject";
  if (!obj || typeof obj !== "object") {
    eraWriter_logger.warn(funcName, "调用失败：传入的 obj 无效。", {
      obj
    });
    return;
  }
  try {
    eraWriter_logger.log(funcName, `准备发送 era:updateByObject 事件`, obj);
    eventEmit("era:updateByObject", obj);
  } catch (e) {
    eraWriter_logger.error(funcName, "发送 era:updateByObject 事件时出现异常", e);
  }
}

const StyledProgressBarvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StyledProgressBar",
  props: {
    value: {},
    max: {},
    loveThreshold: {},
    hateThreshold: {},
    size: {}
  },
  setup(__props) {
    const props = __props;
    const barWidth = (0, external_Vue_namespaceObject.computed)(() => {
      const max = props.max || 100;
      return `${Math.min(Math.abs(props.value) / max * 100, 100)}%`;
    });
    const barClasses = (0, external_Vue_namespaceObject.computed)(() => {
      const classes = {
        "size-small": props.size === "small",
        "size-large": props.size !== "small",
        rtl: props.value < 0
      };
      if (props.hateThreshold !== undefined && props.value <= props.hateThreshold) {
        classes["very-hate"] = true;
      } else if (props.value < 0) {
        classes["negative"] = true;
      } else if (props.loveThreshold !== undefined && props.value >= props.loveThreshold) {
        classes["very-love"] = true;
      }
      return classes;
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "styled-progress-bar", barClasses.value ])
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "val",
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        width: barWidth.value
      })
    }, null, 4) ], 2));
  }
});

const StyledProgressBar_exports_ = (0, exportHelper.A)(StyledProgressBarvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-0390f826" ] ]);

const StyledProgressBar = StyledProgressBar_exports_;

const _hoisted_1 = {
  class: "affection-display"
};

const _hoisted_2 = {
  class: "info-line"
};

const _hoisted_3 = {
  class: "aff-num"
};

const _hoisted_4 = {
  class: "aff-stage"
};

const AffectionDisplayvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AffectionDisplay",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    },
    size: {
      type: String,
      required: true
    }
  },
  setup(__props) {
    const props = __props;
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionStage = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.runtime || !props.character?.name) return "—";
      return props.runtime.character?.chars[props.character.name]?.affectionStage?.name || "—";
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_2, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "好感度：", -1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", _hoisted_3, (0, external_Vue_namespaceObject.toDisplayString)(affectionValue.value), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", _hoisted_4, (0, external_Vue_namespaceObject.toDisplayString)(affectionStage.value), 1) ]), (0, 
    external_Vue_namespaceObject.createVNode)(StyledProgressBar, {
      value: affectionValue.value,
      "love-threshold": loveThreshold.value,
      "hate-threshold": hateThreshold.value,
      size: __props.size
    }, null, 8, [ "value", "love-threshold", "hate-threshold", "size" ]) ]));
  }
});

const AffectionDisplay_exports_ = (0, exportHelper.A)(AffectionDisplayvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-78646038" ] ]);

const AffectionDisplay = AffectionDisplay_exports_;

const Particlevue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Particle",
  props: {
    particleType: {},
    dx: {},
    dy: {},
    rot: {},
    delay: {},
    initialX: {},
    initialY: {}
  },
  emits: [ "destroy" ],
  setup(__props, {emit: __emit}) {
    const props = __props;
    const emit = __emit;
    const particleContent = (0, external_Vue_namespaceObject.computed)(() => props.particleType === "skull" ? "☠" : "❤");
    const particleStyle = (0, external_Vue_namespaceObject.computed)(() => ({
      left: `${props.initialX}%`,
      top: `${props.initialY}%`,
      "--dx": `${props.dx}px`,
      "--dy": `${props.dy}px`,
      "--rot": `${props.rot}deg`,
      animationDelay: `${props.delay}s`
    }));
    (0, external_Vue_namespaceObject.onMounted)(() => {
      setTimeout(() => {
        emit("destroy");
      }, 1500);
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("span", {
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "GensokyoOrigin-Particle", `GensokyoOrigin-Particle--${__props.particleType}` ]),
      style: (0, external_Vue_namespaceObject.normalizeStyle)(particleStyle.value)
    }, (0, external_Vue_namespaceObject.toDisplayString)(particleContent.value), 7));
  }
});

const Particle_exports_ = Particlevue_type_script_setup_true_lang_ts;

const Particle = Particle_exports_;

const ParticleEmittervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "particle-emitter-root"
};

const ParticleEmittervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ParticleEmitter",
  props: {
    active: {
      type: Boolean
    },
    particleType: {},
    emissionRate: {}
  },
  setup(__props, {expose: __expose}) {
    const props = __props;
    const particles = (0, external_Vue_namespaceObject.ref)([]);
    let particleIdCounter = 0;
    const ticker = (0, external_Vue_namespaceObject.ref)(null);
    const createParticle = (type, delay = 0) => {
      particleIdCounter++;
      particles.value.push({
        id: particleIdCounter,
        type,
        initialX: 5 + Math.random() * 90,
        initialY: 10 + Math.random() * 80,
        dx: (Math.random() - .5) * 60,
        dy: -40 - Math.random() * 40,
        rot: (Math.random() - .5) * 40,
        delay
      });
    };
    const removeParticle = id => {
      particles.value = particles.value.filter(p => p.id !== id);
    };
    const startTicker = () => {
      if (ticker.value) return;
      const rate = props.emissionRate || 2;
      ticker.value = setInterval(() => {
        createParticle(props.particleType);
      }, 1e3 / rate);
    };
    const stopTicker = () => {
      if (ticker.value) {
        clearInterval(ticker.value);
        ticker.value = null;
      }
    };
    (0, external_Vue_namespaceObject.watch)(() => props.active, isActive => {
      if (isActive) {
        startTicker();
      } else {
        stopTicker();
      }
    }, {
      immediate: true
    });
    const burst = (type, count) => {
      for (let i = 0; i < count; i++) {
        createParticle(type, i * .05);
      }
    };
    (0, external_Vue_namespaceObject.onUnmounted)(() => {
      stopTicker();
    });
    __expose({
      burst
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", ParticleEmittervue_type_script_setup_true_lang_ts_hoisted_1, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(particles.value, p => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(Particle, {
      key: p.id,
      "particle-type": p.type,
      "initial-x": p.initialX,
      "initial-y": p.initialY,
      dx: p.dx,
      dy: p.dy,
      rot: p.rot,
      delay: p.delay,
      onDestroy: $event => removeParticle(p.id)
    }, null, 8, [ "particle-type", "initial-x", "initial-y", "dx", "dy", "rot", "delay", "onDestroy" ]))), 128)) ]));
  }
});

const ParticleEmitter_exports_ = ParticleEmittervue_type_script_setup_true_lang_ts;

const ParticleEmitter = ParticleEmitter_exports_;

const ContentOthersvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "others-toolbar",
  class: "GensokyoOrigin-ContentOthers-debug-toolbar",
  style: {
    margin: "6px 0 10px"
  }
};

const ContentOthersvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "GensokyoOrigin-ContentOthers-debug-switch",
  title: "config.mvuLifeMeet.rules.incident.skipVisitHunters"
};

const ContentOthersvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "GensokyoOrigin-ContentOthers-debug-switch",
  title: "config.mvuLifeMeet.rules.incident.skipSleepHunters"
};

const ContentOthersvue_type_script_setup_true_lang_ts_hoisted_4 = [ "data-name" ];

const _hoisted_5 = {
  class: "GensokyoOrigin-ContentOthers-role-card-header"
};

const _hoisted_6 = {
  class: "GensokyoOrigin-ContentOthers-role-avatar"
};

const _hoisted_7 = {
  class: "GensokyoOrigin-ContentOthers-role-name"
};

const _hoisted_8 = {
  class: "GensokyoOrigin-ContentOthers-role-meta"
};

const _hoisted_9 = {
  class: "GensokyoOrigin-ContentOthers-role-body"
};

const _hoisted_10 = {
  key: 1,
  class: "GensokyoOrigin-ContentOthers-role-card"
};

const ContentOthersvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ContentOthers",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/tabs/ContentOthers");
    const otherRoles = (0, external_Vue_namespaceObject.ref)([]);
    const stat = (0, external_Vue_namespaceObject.ref)({});
    const runtime = (0, external_Vue_namespaceObject.ref)({});
    const skipVisitHunters = (0, external_Vue_namespaceObject.ref)(false);
    const skipSleepHunters = (0, external_Vue_namespaceObject.ref)(false);
    const particleEmitters = (0, external_Vue_namespaceObject.ref)([]);
    const update = context => {
      const funcName = "update";
      const {statWithoutMeta, runtime: newRuntime} = context || {};
      logger.log(funcName, `开始更新“其他角色”组件`, {
        statWithoutMeta,
        newRuntime
      });
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 statWithoutMeta 无效。");
        return;
      }
      stat.value = statWithoutMeta;
      runtime.value = newRuntime || {};
      try {
        skipVisitHunters.value = !!get(statWithoutMeta, ERA_VARIABLE_PATH.SKIP_VISIT_HUNTERS, false);
        skipSleepHunters.value = !!get(statWithoutMeta, ERA_VARIABLE_PATH.SKIP_SLEEP_HUNTERS, false);
      } catch (e) {
        logger.error(funcName, `更新工具条状态时出错`, e);
      }
      try {
        const uLoc = String(get(statWithoutMeta, ERA_VARIABLE_PATH.USER_LOCATION, "")).trim();
        let chars = get(statWithoutMeta, ERA_VARIABLE_PATH.CHARS, {});
        if (typeof chars === "string") {
          try {
            chars = JSON.parse(chars);
          } catch (e) {
            logger.error(funcName, "解析 chars JSON 字符串失败", e);
            chars = {};
          }
        }
        if (!chars || typeof chars !== "object") {
          otherRoles.value = [];
          return;
        }
        const entries = Object.entries(chars).filter(([k, v]) => !String(k).startsWith("$") && v && typeof v === "object" && !Array.isArray(v));
        const others = entries.filter(([, obj]) => {
          const cLoc = String(get(obj, ERA_VARIABLE_PATH.CHAR_LOCATION, "")).trim();
          return !(uLoc && cLoc && cLoc === uLoc);
        });
        others.sort((a, b) => {
          const la = String(get(a[1], ERA_VARIABLE_PATH.CHAR_LOCATION, "")).localeCompare(String(get(b[1], ERA_VARIABLE_PATH.CHAR_LOCATION, "")), "zh-Hans-CN");
          if (la !== 0) return la;
          return String(a[0]).localeCompare(String(b[0]), "zh-Hans-CN");
        });
        const loveThreshold = Number(get(statWithoutMeta, ERA_VARIABLE_PATH.AFFECTION_LOVE_THRESHOLD, 100));
        const hateThreshold = Number(get(statWithoutMeta, ERA_VARIABLE_PATH.AFFECTION_HATE_THRESHOLD, -100));
        const newRoles = others.map(([name, obj]) => {
          const fields = [ [ "年龄", "年龄" ], [ "性别", "性别" ], [ "身份", "身份" ], [ "性格", "性格" ], [ "外貌", "外貌" ], [ "衣着", "衣着" ], [ "人际关系", "人际关系" ], [ "性经验", "性经验" ], [ "性知识", "性知识" ], [ "特殊能力", "特殊能力" ], [ "身体状况", "身体状况" ], [ "目标", "当前目标" ], [ "所想", "当前所想" ], [ "居住地区", "居住地区" ] ];
          const affectionValue = get(obj, ERA_VARIABLE_PATH.CHAR_AFFECTION, 0);
          let affectionState = "neutral";
          if (affectionValue >= loveThreshold) affectionState = "love";
          if (affectionValue <= hateThreshold) affectionState = "hate";
          return {
            name,
            location: toText(get(obj, ERA_VARIABLE_PATH.CHAR_LOCATION, "未知")),
            fields: fields.map(([label, key]) => ({
              label,
              value: toText(get(obj, key, "—"))
            })),
            raw: {
              name,
              ...obj
            },
            affectionState
          };
        });
        (0, external_Vue_namespaceObject.watch)(newRoles, (currentRoles, oldRoles) => {
          currentRoles.forEach((role, index) => {
            const oldRole = oldRoles?.find(r => r.name === role.name);
            if (oldRole && role.affectionState !== oldRole.affectionState) {
              const emitter = particleEmitters.value[index];
              if (emitter) {
                if (role.affectionState === "love") emitter.burst("heart", 10); else if (role.affectionState === "hate") emitter.burst("skull", 8);
              }
            }
          });
        }, {
          deep: true
        });
        otherRoles.value = newRoles;
        particleEmitters.value = new Array(newRoles.length);
      } catch (e) {
        logger.error(funcName, `更新“其他角色”列表时出错`, e);
        otherRoles.value = [];
      }
    };
    const onSkipVisitChange = () => {
      updateEraVariable(ERA_VARIABLE_PATH.SKIP_VISIT_HUNTERS, skipVisitHunters.value);
    };
    const onSkipSleepChange = () => {
      updateEraVariable(ERA_VARIABLE_PATH.SKIP_SLEEP_HUNTERS, skipSleepHunters.value);
    };
    const handleToggle = e => {
      const btn = e.target.closest(".GensokyoOrigin-ContentOthers-card-toggle");
      if (!btn) return;
      const card = btn.closest(".GensokyoOrigin-ContentOthers-role-card");
      if (!card) return;
      const expand = !card.classList.contains("expanded");
      card.classList.toggle("expanded", expand);
      card.classList.toggle("collapsed", !expand);
      btn.setAttribute("aria-expanded", String(expand));
      btn.textContent = expand ? "▲" : "▼";
    };
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[6] || (_cache[6] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🧑‍🤝‍🧑"), (0, external_Vue_namespaceObject.createTextVNode)("其他角色") ], -1)), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ===== 其他角色工具条 ===== "), (0, external_Vue_namespaceObject.createElementVNode)("div", ContentOthersvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", ContentOthersvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      id: "life-skip-visit-hunters",
      "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => skipVisitHunters.value = $event),
      type: "checkbox",
      onChange: onSkipVisitChange
    }, null, 544), [ [ external_Vue_namespaceObject.vModelCheckbox, skipVisitHunters.value ] ]), _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" 异变中退治者不拜访 ", -1)) ]), (0, external_Vue_namespaceObject.createElementVNode)("span", ContentOthersvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createElementVNode)("input", {
      id: "life-skip-sleep-hunters",
      "onUpdate:modelValue": _cache[1] || (_cache[1] = $event => skipSleepHunters.value = $event),
      type: "checkbox",
      onChange: onSkipSleepChange
    }, null, 544), [ [ external_Vue_namespaceObject.vModelCheckbox, skipSleepHunters.value ] ]), _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" 异变中退治者不睡觉 ", -1)) ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "other-roles-list",
      class: "GensokyoOrigin-ContentOthers-incident-list",
      onClick: handleToggle
    }, [ otherRoles.value.length ? ((0, external_Vue_namespaceObject.openBlock)(true), 
    (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, {
      key: 0
    }, (0, external_Vue_namespaceObject.renderList)(otherRoles.value, (role, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: role.name,
      class: "GensokyoOrigin-ContentOthers-role-card collapsed",
      "data-name": role.name
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_5, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", _hoisted_6, (0, external_Vue_namespaceObject.toDisplayString)(role.name.slice(0, 1)), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_7, (0, 
    external_Vue_namespaceObject.toDisplayString)(role.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_8, (0, 
    external_Vue_namespaceObject.toDisplayString)(role.location), 1) ]), _cache[4] || (_cache[4] = (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "GensokyoOrigin-ContentOthers-card-toggle",
      "aria-expanded": "false",
      "aria-label": "展开/收起"
    }, " ▼ ", -1)) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", _hoisted_9, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(role.fields, field => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: field.label,
      class: "GensokyoOrigin-ContentOthers-role-line"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("strong", null, (0, external_Vue_namespaceObject.toDisplayString)(field.label) + "：", 1), (0, 
    external_Vue_namespaceObject.createTextVNode)((0, external_Vue_namespaceObject.toDisplayString)(field.value), 1) ]))), 128)), (0, 
    external_Vue_namespaceObject.createVNode)(AffectionDisplay, {
      character: role.raw,
      "stat-without-meta": stat.value,
      runtime: runtime.value,
      size: "large"
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]), (0, external_Vue_namespaceObject.createVNode)(ParticleEmitter, {
      ref_for: true,
      ref: el => particleEmitters.value[index] = el,
      active: role.affectionState === "love" || role.affectionState === "hate",
      "particle-type": role.affectionState === "hate" ? "skull" : "heart",
      "emission-rate": 2
    }, null, 8, [ "active", "particle-type" ]) ]) ], 8, ContentOthersvue_type_script_setup_true_lang_ts_hoisted_4))), 128)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", _hoisted_10, [ ..._cache[5] || (_cache[5] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-ContentOthers-role-card-header"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-ContentOthers-role-avatar"
    }, "✔"), (0, external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-ContentOthers-role-name"
    }, "当前无“其他角色”"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "GensokyoOrigin-ContentOthers-role-meta"
    }, "与玩家不同区的角色为 0") ]) ], -1) ]) ])) ]) ]));
  }
});

const ContentOthers_exports_ = ContentOthersvue_type_script_setup_true_lang_ts;

const ContentOthers = ContentOthers_exports_;

const external_namespaceObject = _;

const ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "row",
  style: {
    display: "flex",
    gap: "8px",
    "align-items": "center",
    margin: "8px 0 12px"
  }
};

const ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_2 = {
  id: "cfg_status",
  class: "tag"
};

const ContentSettingsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ContentSettings",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/tabs/ContentSettings");
    const loadStatus = (0, external_Vue_namespaceObject.ref)("未载入");
    const configRoot = (0, external_Vue_namespaceObject.ref)(null);
    let initialConfig = null;
    let leafCount = 0;
    let groupCount = 0;
    const isObj = o => o && typeof o === "object" && !Array.isArray(o);
    const join = (base, k) => base ? `${base}.${k}` : k;
    function createControl(path, value) {
      const wrap = document.createElement("div");
      const key = document.createElement("div");
      const box = document.createElement("div");
      wrap.style.margin = "10px 0";
      key.style.fontWeight = "600";
      key.style.color = "#5e5042";
      key.textContent = path;
      wrap.appendChild(key);
      wrap.appendChild(box);
      let getVal;
      if (typeof value === "boolean") {
        const el = document.createElement("input");
        el.type = "checkbox";
        el.checked = !!value;
        box.appendChild(el);
        getVal = () => !!el.checked;
      } else if (typeof value === "number") {
        const el = document.createElement("input");
        el.type = "number";
        el.value = String(value);
        el.style.width = "100%";
        box.appendChild(el);
        getVal = () => Number(el.value);
      } else if (Array.isArray(value)) {
        const isPrimitiveArray = value.every(v => v === null || [ "string", "number", "boolean" ].includes(typeof v));
        const el = document.createElement("textarea");
        el.style.width = "100%";
        el.style.minHeight = "100px";
        box.appendChild(el);
        if (isPrimitiveArray) {
          el.value = value.map(v => String(v)).join("\n");
          getVal = () => {
            const lines = (el.value || "").split("\n").map(s => s.trim()).filter(Boolean);
            const allNumbers = lines.every(s => /^-?\d+(?:\.\d+)?$/.test(s));
            return allNumbers ? lines.map(Number) : lines;
          };
        } else {
          el.value = JSON.stringify(value, null, 2);
          getVal = () => {
            try {
              const text = el.value.trim();
              return text ? JSON.parse(text) : [];
            } catch (e) {
              logger.error("createControl", `解析JSON失败，路径: ${path}`, e);
              return value;
            }
          };
        }
      } else {
        const el = document.createElement("input");
        el.type = "text";
        el.value = String(value);
        el.style.width = "100%";
        box.appendChild(el);
        getVal = () => el.value;
      }
      leafCount++;
      wrap.__getVal = getVal;
      wrap.dataset.path = path;
      try {
        wrap.dataset.init = JSON.stringify(value);
      } catch {
        wrap.dataset.init = "";
      }
      return wrap;
    }
    function createGroup(obj, basePath, docText) {
      const box = document.createElement("details");
      box.open = false;
      const sum = document.createElement("summary");
      sum.textContent = basePath || "(root)";
      box.appendChild(sum);
      if (docText) {
        const d = document.createElement("div");
        d.style.color = "#857664";
        d.style.fontSize = ".9em";
        d.style.margin = "6px 0 10px";
        d.textContent = docText;
        box.appendChild(d);
      }
      groupCount++;
      Object.keys(obj).forEach(k => {
        if (k === "__doc" || k === "_doc" || k.endsWith("__doc") || k.startsWith("_")) return;
        const v = obj[k];
        const p = join(basePath, k);
        if (isObj(v)) {
          const child = createGroup(v, p, v._doc || obj[`${k}__doc`]);
          box.appendChild(child);
        } else {
          const leafDoc = obj[`${k}__doc`];
          const controlElement = createControl(p, v);
          if (leafDoc) {
            const d = document.createElement("div");
            d.style.color = "#857664";
            d.style.fontSize = ".9em";
            d.style.margin = "6px 0 10px";
            d.textContent = leafDoc;
            controlElement.insertBefore(d, controlElement.children[1]);
          }
          box.appendChild(controlElement);
        }
      });
      return box;
    }
    function render(cfg) {
      if (!configRoot.value) {
        logger.warn("render", "无法渲染，因为 #cfg_root 容器不存在。");
        return;
      }
      const t0 = performance.now();
      leafCount = 0;
      groupCount = 0;
      configRoot.value.innerHTML = "";
      initialConfig = (0, external_namespaceObject.cloneDeep)(cfg);
      const view = createGroup(cfg, "", cfg?._doc);
      view.open = false;
      configRoot.value.appendChild(view);
      loadStatus.value = "已载入";
      const ms = (performance.now() - t0).toFixed(1);
      logger.log("render", `配置渲染完成`, {
        groups: groupCount,
        leaves: leafCount,
        ms
      });
    }
    function collectChanges() {
      const t0 = performance.now();
      const items = configRoot.value?.querySelectorAll("[data-path]") || [];
      const changes = [];
      let scanned = 0;
      items.forEach(el => {
        scanned++;
        const path = el.dataset.path;
        const getVal = el.__getVal;
        if (!path || !getVal) return;
        const currentValue = getVal();
        let initialValue = null;
        try {
          initialValue = JSON.parse(el.dataset.init || "null");
        } catch {}
        if (!(0, external_namespaceObject.isEqual)(currentValue, initialValue)) {
          changes.push({
            path,
            from: initialValue,
            to: currentValue
          });
        }
      });
      logger.log("collectChanges", `差异收集完成`, {
        scanned,
        changed: changes.length,
        ms: (performance.now() - t0).toFixed(1),
        sample: changes.slice(0, 5)
      });
      return changes;
    }
    async function save() {
      const funcName = "save";
      try {
        const changes = collectChanges();
        if (!changes.length) {
          logger.log(funcName, "无变化，无需保存。");
          toastr.info("没有检测到任何更改。");
          return;
        }
        logger.log(funcName, `准备写入 ${changes.length} 项更改...`);
        toastr.info(`正在保存 ${changes.length} 项更改...`);
        let ok = 0, fail = 0;
        for (const change of changes) {
          try {
            updateEraVariable(`config.${change.path}`, change.to);
            ok++;
            logger.log(funcName, `已通过 era:updateByPath 请求更新`, {
              path: `config.${change.path}`
            });
          } catch (e) {
            fail++;
            logger.error(funcName, `写入失败`, {
              path: change.path,
              error: e
            });
          }
        }
        logger.log(funcName, `保存完成`, {
          ok,
          fail
        });
        toastr.success(`保存成功 ${ok} 项，失败 ${fail} 项。`);
      } catch (e) {
        logger.error(funcName, `保存过程出现异常`, e);
        toastr.error("保存过程中发生未知错误。");
      }
    }
    function expandAll() {
      const list = configRoot.value?.querySelectorAll("details");
      list?.forEach(d => d.open = true);
      logger.log("expandAll", `展开了 ${list?.length || 0} 个分组。`);
    }
    function collapseAll() {
      const list = configRoot.value?.querySelectorAll("details");
      list?.forEach(d => d.open = false);
      logger.log("collapseAll", `折叠了 ${list?.length || 0} 个分组。`);
    }
    function update(statWithoutMeta) {
      const funcName = "update";
      logger.log(funcName, "接收到更新请求", {
        keys: Object.keys(statWithoutMeta || {}).length
      });
      const config = (0, external_namespaceObject.get)(statWithoutMeta, "config");
      if (config && typeof config === "object") {
        render(config);
      } else {
        logger.warn(funcName, "在 statWithoutMeta 中未找到有效的 config 对象。");
        loadStatus.value = "配置无效";
      }
    }
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⚙️"), (0, external_Vue_namespaceObject.createTextVNode)("设置") ], -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("span", ContentSettingsvue_type_script_setup_true_lang_ts_hoisted_2, (0, 
    external_Vue_namespaceObject.toDisplayString)(loadStatus.value), 1), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_expand_all",
      onClick: expandAll
    }, "展开全部"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_collapse_all",
      onClick: collapseAll
    }, "折叠全部"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "btn_save_cfg",
      onClick: save
    }, "保存更改到世界书") ]), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("div", {
      class: "hint"
    }, "布尔=勾选，数字=数字框，字符串=文本框，数组=每行一项。对象会折叠为分组。", -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "cfg_root",
      ref_key: "configRoot",
      ref: configRoot
    }, null, 512) ]));
  }
});

const ContentSettings_exports_ = (0, exportHelper.A)(ContentSettingsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-851a0cc6" ] ]);

const ContentSettings = ContentSettings_exports_;

const T0_PATH = "incident.异变冷却基准时间";

const Incidentsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Incidents",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/tabs/Incidents");
    function extractIncidents(data) {
      let root = get(data, "incidents");
      if (typeof root === "string") {
        try {
          root = JSON.parse(root);
        } catch {
          root = null;
        }
      }
      if (!root || typeof root !== "object" || Array.isArray(root)) return [];
      return Object.entries(root).filter(([k, v]) => !String(k).startsWith("$") && v && typeof v === "object" && !Array.isArray(v)).map(([__name, __data]) => ({
        __name,
        __data
      }));
    }
    function renderIncidents(state) {
      const funcName = "renderIncidents";
      const host = document.getElementById("incident-list");
      if (!host) {
        logger.warn(funcName, "未找到 #incident-list 容器。");
        return;
      }
      host.innerHTML = "";
      const items = extractIncidents(state);
      logger.log(funcName, `开始渲染 ${items.length} 个异变卡片。`);
      items.forEach(({__name, __data}) => {
        const name = toText(get(__data, "异变名称", __name));
        const status = get(__data, "异变已结束") ? "已结束" : "进行中";
        const fields = [ [ "影响", "异变影响" ], [ "退治者", "异变退治者" ], [ "发起者", "异变发起者" ], [ "黑幕", "异变黑幕" ], [ "其他信息", "其他异变信息" ] ];
        const card = document.createElement("div");
        card.className = "role-card";
        card.innerHTML = `\n<div class="role-card-header">\n    <div class="role-avatar">异</div>\n    <div><div class="role-name">${name}</div><div class="role-meta">进程：${status}</div></div>\n</div>\n${fields.map(([label, key]) => {
          const val = key === "异变退治者" ? getRaw(__data, key, []) : get(__data, key, "—");
          return `<div class="role-line"><strong>${label}：</strong>${toText(val)}</div>`;
        }).join("")}\n`;
        host.appendChild(card);
      });
      logger.log(funcName, "异变卡片渲染完成。");
    }
    function readT0(runtime) {
      if (!runtime) {
        logger.warn("readT0", "runtime 对象不存在，无法读取 T0。");
        return null;
      }
      const t0 = get(runtime, T0_PATH, null);
      if (t0 != null) {
        const n = Number(toText(t0));
        if (Number.isFinite(n)) {
          logger.log("readT0", `从 runtime 读取到 t0: ${n}`);
          return n;
        }
      }
      logger.log("readT0", "未在 runtime 中读取到合法 t0。");
      return null;
    }
    function readCooldownMinutes(state) {
      const cooldown = get(state, ERA_VARIABLE_PATH.INCIDENT_COOLDOWN, 0);
      const n = Number(toText(cooldown));
      if (Number.isFinite(n) && n >= 0) {
        return Math.floor(n);
      }
      return 0;
    }
    function readTimeProgress(state) {
      const timeProgress = get(state, ERA_VARIABLE_PATH.TIME_PROGRESS, 0);
      const n = Number(toText(timeProgress));
      return Number.isFinite(n) ? Math.floor(n) : 0;
    }
    function calcCountdownMinutes(context) {
      const {statWithoutMeta, runtime} = context;
      const t0 = readT0(runtime);
      if (t0 === null) {
        logger.log("calcCountdownMinutes", "t0 不存在/非法，本轮倒计时按 0 处理。");
        return 0;
      }
      const tp = readTimeProgress(statWithoutMeta);
      const cd = readCooldownMinutes(statWithoutMeta);
      const left = Math.max(0, Math.floor(cd - (tp - t0)));
      logger.log("calcCountdownMinutes", `计算倒计时（分钟）: { t0: ${t0}, timeProgress: ${tp}, cooldown: ${cd}, 剩余: ${left} }`);
      return left;
    }
    function updateIncidentToolbar(context) {
      const funcName = "updateIncidentToolbar";
      const {statWithoutMeta} = context;
      const cdEl = document.getElementById("incident-countdown");
      const triggerNowEl = document.getElementById("incident-trigger-now");
      const randomPoolEl = document.getElementById("incident-pool-random");
      if (cdEl) {
        const left = calcCountdownMinutes(context);
        cdEl.textContent = left == null ? "—" : String(left);
        logger.log(funcName, `异变倒计时已更新为: ${cdEl.textContent}`);
      }
      if (triggerNowEl) {
        const shouldTrigger = get(statWithoutMeta, ERA_VARIABLE_PATH.INCIDENT_IMMEDIATE_TRIGGER, false);
        triggerNowEl.checked = !!shouldTrigger;
        logger.log(funcName, `“立即引发异变”状态已更新为: ${triggerNowEl.checked}`);
      }
      if (randomPoolEl) {
        const useRandom = get(statWithoutMeta, ERA_VARIABLE_PATH.INCIDENT_RANDOM_POOL, false);
        randomPoolEl.checked = !!useRandom;
        logger.log(funcName, `“乱序异变”状态已更新为: ${randomPoolEl.checked}`);
      }
    }
    const update = context => {
      const {statWithoutMeta} = context || {};
      if (!statWithoutMeta) {
        logger.warn("update", "上下文信息不完整，缺少 statWithoutMeta，已中止。");
        return;
      }
      renderIncidents(statWithoutMeta);
      updateIncidentToolbar(context);
    };
    (0, external_Vue_namespaceObject.onMounted)(() => {
      const funcName = "onMounted";
      const triggerNowEl = document.getElementById("incident-trigger-now");
      const randomPoolEl = document.getElementById("incident-pool-random");
      if (triggerNowEl) {
        triggerNowEl.onchange = () => {
          const newValue = triggerNowEl.checked;
          logger.log(funcName, `用户切换“立即引发异变”为: ${newValue}`);
          updateEraVariable(ERA_VARIABLE_PATH.INCIDENT_IMMEDIATE_TRIGGER, newValue);
        };
      }
      if (randomPoolEl) {
        randomPoolEl.onchange = () => {
          const newValue = randomPoolEl.checked;
          logger.log(funcName, `用户切换“乱序异变”为: ${newValue}`);
          updateEraVariable(ERA_VARIABLE_PATH.INCIDENT_RANDOM_POOL, newValue);
        };
      }
      logger.log(funcName, "异变工具栏事件已绑定。");
    });
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⚠️"), (0, external_Vue_namespaceObject.createTextVNode)("异变啊异变！") ], -1)), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ===== 异变工具栏（倒计时 + 立即引发） ===== "), _cache[1] || (_cache[1] = (0, 
    external_Vue_namespaceObject.createStaticVNode)('<div id="incident-toolbar" class="debug-select" style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;" data-v-382a017e><span class="label" style="min-width:auto;margin:0;" data-v-382a017e><span class="emoji" data-v-382a017e>⏳</span>异变倒计时（分钟）: </span><strong id="incident-countdown" data-v-382a017e>—</strong><span class="debug-switch" title="来自世界书 config 的初始值；修改即写回到聊天变量的 config.incidents.triggerImmediate" data-v-382a017e><input id="incident-trigger-now" type="checkbox" data-v-382a017e> 立即引发异变 </span><span class="debug-switch" title="来自 config.incident.random_pool" data-v-382a017e><input id="incident-pool-random" type="checkbox" data-v-382a017e> 乱序异变 </span></div><div id="incident-list" class="incident-list" data-v-382a017e></div>', 2)) ]));
  }
});

const Incidents_exports_ = (0, exportHelper.A)(Incidentsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-382a017e" ] ]);

const Incidents = Incidents_exports_;

const Mapvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "map-component",
  id: "mapComponent"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "map-wrapper"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "map-info",
  ref: "mapInfo"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_4 = {
  id: "coords"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "map-container",
  id: "mapContainer"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_6 = [ "innerHTML", "onClick" ];

const Mapvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "dialog"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "location-name"
};

const Mapvue_type_script_setup_true_lang_ts_hoisted_9 = [ "innerHTML" ];

const Mapvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "Map",
  props: {
    context: null
  },
  setup(__props) {
    const exampleMapSize = {
      width: 800,
      height: 600
    };
    const exampleRoads = [ {
      start: {
        x: 100,
        y: 100
      },
      end: {
        x: 300,
        y: 150
      }
    }, {
      start: {
        x: 100,
        y: 100
      },
      end: {
        x: 500,
        y: 500
      }
    } ];
    const props = __props;
    (0, external_Vue_namespaceObject.watch)(() => props.context, (newValue, oldValue) => {
      console.log(`message 从 "${oldValue}" 变为 "${newValue}"`);
    });
    let markers = (0, external_Vue_namespaceObject.computed)(() => {
      if (props.context?.runtime?.area?.legal_locations) {
        return props.context.runtime.area.legal_locations;
      }
      return [];
    });
    let mapState = (0, external_Vue_namespaceObject.ref)({
      offsetX: 0,
      offsetY: 0,
      zoom: 1,
      isDragging: false,
      lastMouseX: 0,
      lastMouseY: 0,
      mapWidth: exampleMapSize.width,
      mapHeight: exampleMapSize.height
    });
    let selectedMarker = (0, external_Vue_namespaceObject.ref)(null);
    let mainRoleMarker = (0, external_Vue_namespaceObject.ref)({
      name: "主角",
      pos: {
        x: 300,
        y: 150
      },
      htmlEle: "<div>📍</div>"
    });
    function selectLocation(markerData) {
      selectedMarker.value = markerData;
    }
    (0, external_Vue_namespaceObject.onMounted)(() => {
      const mapComponent = document.getElementById("mapComponent");
      const mapContainer = document.getElementById("mapContainer");
      const canvas = document.getElementById("mapCanvas");
      const ctx = canvas.getContext("2d");
      mapComponent.style.width = `${mapState.value.mapWidth}px`;
      mapComponent.style.height = `${mapState.value.mapHeight}px`;
      function generateMap() {
        try {
          resetView();
          canvas.width = mapState.value.mapWidth;
          canvas.height = mapState.value.mapHeight;
          drawMap();
        } catch (error) {
          alert("数据格式错误，请检查输入数据：" + error.message);
        }
      }
      function drawMap() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(mapState.value.offsetX, mapState.value.offsetY);
        ctx.scale(mapState.value.zoom, mapState.value.zoom);
        drawMapBackground();
        drawRoads();
        ctx.restore();
      }
      function drawMapBackground() {
        ctx.fillStyle = "#7f8c8d";
        ctx.fillRect(0, 0, mapState.value.mapWidth, mapState.value.mapHeight);
      }
      function drawRoads() {
        try {
          const roads = exampleRoads;
          ctx.strokeStyle = "#333";
          ctx.lineWidth = 4;
          ctx.lineCap = "round";
          roads.forEach(road => {
            ctx.beginPath();
            ctx.moveTo(road.start.x, road.start.y);
            ctx.lineTo(road.end.x, road.end.y);
            ctx.stroke();
          });
        } catch (error) {
          console.error("道路数据格式错误:", error);
        }
      }
      function resetView() {
        mapState.value = {
          ...mapState.value,
          zoom: 1,
          offsetX: (mapContainer.clientWidth - mapState.value.mapWidth) / 2,
          offsetY: (mapContainer.clientHeight - mapState.value.mapHeight) / 2
        };
        drawMap();
      }
      mapContainer.addEventListener("mousedown", e => {
        mapState.value = {
          ...mapState.value,
          isDragging: true,
          lastMouseX: e.clientX,
          lastMouseY: e.clientY
        };
        mapContainer.style.cursor = "grabbing";
      });
      mapContainer.addEventListener("mousemove", e => {
        if (mapState.value.isDragging) {
          const deltaX = e.clientX - mapState.value.lastMouseX;
          const deltaY = e.clientY - mapState.value.lastMouseY;
          mapState.value.offsetX += deltaX;
          mapState.value.offsetY += deltaY;
          mapState.value.lastMouseX = e.clientX;
          mapState.value.lastMouseY = e.clientY;
          drawMap();
        }
      });
      mapContainer.addEventListener("mouseup", () => {
        mapState.value.isDragging = false;
        mapContainer.style.cursor = "grab";
      });
      mapContainer.addEventListener("mouseleave", () => {
        mapState.value.isDragging = false;
        mapContainer.style.cursor = "grab";
      });
      mapContainer.addEventListener("wheel", e => {
        e.preventDefault();
        const zoomFactor = e.deltaY > 0 ? .9 : 1.1;
        const newZoom = mapState.value.zoom * zoomFactor;
        if (newZoom >= .2 && newZoom <= 5) {
          const rect = mapContainer.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const mouseY = e.clientY - rect.top;
          const worldX = (mouseX - mapState.value.offsetX) / mapState.value.zoom;
          const worldY = (mouseY - mapState.value.offsetY) / mapState.value.zoom;
          mapState.value = {
            ...mapState.value,
            zoom: newZoom,
            offsetX: mouseX - worldX * mapState.value.zoom,
            offsetY: mouseY - worldY * mapState.value.zoom
          };
          drawMap();
        }
      });
      generateMap();
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_3, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" 缩放: ", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, 
    external_Vue_namespaceObject.toDisplayString)((0, external_Vue_namespaceObject.unref)(mapState).zoom.toFixed(1)), 1), _cache[1] || (_cache[1] = (0, 
    external_Vue_namespaceObject.createTextVNode)(" x | 坐标: ", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", Mapvue_type_script_setup_true_lang_ts_hoisted_4, (0, 
    external_Vue_namespaceObject.toDisplayString)(Math.round(-(0, external_Vue_namespaceObject.unref)(mapState).offsetX / (0, 
    external_Vue_namespaceObject.unref)(mapState).zoom)) + ", " + (0, external_Vue_namespaceObject.toDisplayString)(Math.round(-(0, 
    external_Vue_namespaceObject.unref)(mapState).offsetY / (0, external_Vue_namespaceObject.unref)(mapState).zoom)), 1) ], 512), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_5, [ _cache[4] || (_cache[4] = (0, 
    external_Vue_namespaceObject.createElementVNode)("canvas", {
      id: "mapCanvas"
    }, null, -1)), (0, external_Vue_namespaceObject.createCommentVNode)(" 动态生成marker "), ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)((0, external_Vue_namespaceObject.unref)(markers), (marker, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: index,
      class: "marker",
      innerHTML: marker.htmlEle,
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: marker.pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: marker.pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY + "px",
        transform: `translate(-50%, -50%) scale(${(0, external_Vue_namespaceObject.unref)(mapState).zoom})`
      }),
      onClick: $event => selectLocation(marker)
    }, null, 12, Mapvue_type_script_setup_true_lang_ts_hoisted_6))), 128)), (0, external_Vue_namespaceObject.createCommentVNode)(" 点击marker的tip弹出 "), (0, 
    external_Vue_namespaceObject.unref)(selectedMarker) ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: 0,
      class: "tip-container",
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: (0, external_Vue_namespaceObject.unref)(selectedMarker).pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: (0, external_Vue_namespaceObject.unref)(selectedMarker).pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY - 10 + "px",
        transform: `translate(-50%, -100%) scale(${(0, external_Vue_namespaceObject.unref)(mapState).zoom})`
      })
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", Mapvue_type_script_setup_true_lang_ts_hoisted_7, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h2", Mapvue_type_script_setup_true_lang_ts_hoisted_8, (0, 
    external_Vue_namespaceObject.toDisplayString)((0, external_Vue_namespaceObject.unref)(selectedMarker).name), 1), _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, "博丽灵梦：喝茶中🍵", -1)), _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, "魔理沙：实验中🧪", -1)) ]) ], 4)) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, external_Vue_namespaceObject.createCommentVNode)(" 主角 "), (0, 
    external_Vue_namespaceObject.unref)(mainRoleMarker) ? ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: 1,
      class: "marker main-role-marker pulsate",
      innerHTML: (0, external_Vue_namespaceObject.unref)(mainRoleMarker).htmlEle,
      style: (0, external_Vue_namespaceObject.normalizeStyle)({
        left: (0, external_Vue_namespaceObject.unref)(mainRoleMarker).pos.x * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetX + "px",
        top: (0, external_Vue_namespaceObject.unref)(mainRoleMarker).pos.y * (0, external_Vue_namespaceObject.unref)(mapState).zoom + (0, 
        external_Vue_namespaceObject.unref)(mapState).offsetY + "px",
        transform: `translate(-50%, -100%) scale(${1 / (0, external_Vue_namespaceObject.unref)(mapState).zoom})`
      })
    }, null, 12, Mapvue_type_script_setup_true_lang_ts_hoisted_9)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]) ]) ]));
  }
});

const Map_exports_ = Mapvue_type_script_setup_true_lang_ts;

const Map = Map_exports_;

const FontSizeControlsvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "font-size-controls"
};

const FontSizeControlsvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "FontSizeControls",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/tabs/FontSizeControls");
    const currentPercent = (0, external_Vue_namespaceObject.ref)(100);
    const stepPct = (0, external_Vue_namespaceObject.ref)(10);
    const clamp = n => Math.max(60, Math.min(200, Math.floor(Number(n) || 100)));
    const applyToDOM = pct => {
      const content = document.getElementById("content_main");
      if (content) {
        content.style.fontSize = `${pct}%`;
        logger.log("applyToDOM", `已应用字号: ${pct}%`);
      } else {
        logger.warn("applyToDOM", "未找到 #content_main 元素。");
      }
    };
    const updateFontSize = statWithoutMeta => {
      const funcName = "updateFontSize";
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 statWithoutMeta 无效。", statWithoutMeta);
        return;
      }
      const newPercent = get(statWithoutMeta, ERA_VARIABLE_PATH.MAIN_FONT_PERCENT, 100);
      const clampedPercent = clamp(Number(newPercent));
      stepPct.value = get(statWithoutMeta, ERA_VARIABLE_PATH.FONT_SCALE_STEP_PCT, 10);
      currentPercent.value = clampedPercent;
      applyToDOM(clampedPercent);
      logger.log(funcName, `从 statWithoutMeta 更新字号为: ${clampedPercent}%`);
    };
    (0, external_Vue_namespaceObject.onMounted)(() => {
      const inc = document.getElementById("increase-font");
      const dec = document.getElementById("decrease-font");
      if (inc) {
        inc.onclick = () => {
          const newValue = clamp(currentPercent.value + stepPct.value);
          currentPercent.value = newValue;
          applyToDOM(newValue);
          updateEraVariable(ERA_VARIABLE_PATH.MAIN_FONT_PERCENT, newValue);
        };
      }
      if (dec) {
        dec.onclick = () => {
          const newValue = clamp(currentPercent.value - stepPct.value);
          currentPercent.value = newValue;
          applyToDOM(newValue);
          updateEraVariable(ERA_VARIABLE_PATH.MAIN_FONT_PERCENT, newValue);
        };
      }
      logger.log("onMounted", "按钮事件已绑定。");
    });
    __expose({
      updateFontSize
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", FontSizeControlsvue_type_script_setup_true_lang_ts_hoisted_1, [ ..._cache[0] || (_cache[0] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "decrease-font",
      class: "font-size-btn"
    }, "−", -1), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "increase-font",
      class: "font-size-btn"
    }, "+", -1) ]) ]));
  }
});

const FontSizeControls_exports_ = (0, exportHelper.A)(FontSizeControlsvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-7fbcf727" ] ]);

const FontSizeControls = FontSizeControls_exports_;

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-tabs",
  class: "status-tabs"
};

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_2 = [ "data-tab", "onClick" ];

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  id: "status-tab-content-area",
  class: "status-tab-content-area"
};

const StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_4 = {
  id: "main-content",
  class: "preserve-format"
};

const StatusTabContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StatusTabContent",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusTab/StatusTabContent");
    const fontSizeControls = (0, external_Vue_namespaceObject.ref)(null);
    const worldMap = (0, external_Vue_namespaceObject.ref)(null);
    const incidents = (0, external_Vue_namespaceObject.ref)(null);
    const contentOthers = (0, external_Vue_namespaceObject.ref)(null);
    const contentBio = (0, external_Vue_namespaceObject.ref)(null);
    const contentSettings = (0, external_Vue_namespaceObject.ref)(null);
    const tabs = [ {
      id: "main",
      name: "正文"
    }, {
      id: "status",
      name: "世界"
    }, {
      id: "incidents",
      name: "异变啊异变！"
    }, {
      id: "others",
      name: "其他角色"
    }, {
      id: "bio",
      name: "履历与关系"
    }, {
      id: "settings",
      name: "设置"
    } ];
    const activeTab = (0, external_Vue_namespaceObject.ref)("main");
    const contextRef = (0, external_Vue_namespaceObject.ref)(null);
    const switchTab = tabId => {
      logger.log("switchTab", `切换选项卡到: ${tabId}`);
      activeTab.value = tabId;
    };
    const update = context => {
      contextRef.value = context;
      const funcName = "update";
      const {statWithoutMeta, runtime} = context || {};
      logger.log(funcName, `接收到更新请求，开始更新所有子组件...`, {
        context
      });
      if (!statWithoutMeta) {
        logger.warn(funcName, "传入的 context 或 statWithoutMeta 为空，无法更新 UI。");
        return;
      }
      if (fontSizeControls.value && typeof fontSizeControls.value.updateFontSize === "function") {
        fontSizeControls.value.updateFontSize(statWithoutMeta);
        logger.debug(funcName, "已调用 FontSizeControls.updateFontSize");
      }
      if (worldMap.value && typeof worldMap.value.update === "function") {
        worldMap.value.update(statWithoutMeta);
        logger.debug(funcName, "已调用 WorldMap.update");
      }
      if (incidents.value && typeof incidents.value.update === "function") {
        incidents.value.update(context);
        logger.debug(funcName, "已调用 Incidents.update");
      }
      if (contentOthers.value && typeof contentOthers.value.update === "function") {
        contentOthers.value.update(context);
        logger.debug(funcName, "已调用 ContentOthers.update");
      }
      if (contentBio.value && typeof contentBio.value.update === "function") {
        contentBio.value.update(context);
        logger.debug(funcName, "已调用 ContentBio.update");
      }
      if (contentSettings.value && typeof contentSettings.value.update === "function") {
        contentSettings.value.update(statWithoutMeta);
        logger.debug(funcName, "已调用 ContentSettings.update");
      }
      const mainExtraEl = document.getElementById("main-extra");
      if (mainExtraEl) {
        const contentString = getStr(statWithoutMeta, ERA_VARIABLE_PATH.EXTRA_MAIN, "");
        mainExtraEl.textContent = contentString;
        logger.debug(funcName, "已更新附加正文", {
          content: contentString.slice(0, 50) + "..."
        });
      }
      logger.log(funcName, "所有子组件更新完成。");
    };
    __expose({
      update,
      worldMap,
      incidents,
      contentOthers,
      contentBio,
      contentSettings
    });
    return (_ctx, _cache) => {
      const _component_content = (0, external_Vue_namespaceObject.resolveComponent)("content");
      return (0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", null, [ (0, 
      external_Vue_namespaceObject.createCommentVNode)(" ▼ [移植] 这部分 HTML 结构严格复制自 app.vue "), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_1, [ ((0, 
      external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
      external_Vue_namespaceObject.renderList)(tabs, tab => (0, external_Vue_namespaceObject.createElementVNode)("button", {
        key: tab.id,
        "data-tab": tab.id,
        class: (0, external_Vue_namespaceObject.normalizeClass)({
          active: activeTab.value === tab.id
        }),
        onClick: $event => switchTab(tab.id)
      }, (0, external_Vue_namespaceObject.toDisplayString)(tab.name), 11, StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_2)), 64)) ]), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
      external_Vue_namespaceObject.createCommentVNode)(" 正文 Tab "), (0, external_Vue_namespaceObject.createElementVNode)("div", {
        id: "content_main",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "main"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(FontSizeControls, {
        ref_key: "fontSizeControls",
        ref: fontSizeControls
      }, null, 512), (0, external_Vue_namespaceObject.createElementVNode)("div", StatusTabContentvue_type_script_setup_true_lang_ts_hoisted_4, [ (0, 
      external_Vue_namespaceObject.createVNode)(_component_content, null, {
        default: (0, external_Vue_namespaceObject.withCtx)(() => [ ..._cache[0] || (_cache[0] = [ (0, 
        external_Vue_namespaceObject.createTextVNode)("$1", -1) ]) ]),
        _: 1
      }) ]), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("div", {
        id: "main-extra",
        class: "preserve-format"
      }, null, -1)) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 世界 Tab (WorldMap) "), activeTab.value === "status" ? ((0, 
      external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
        key: 0,
        id: "content_status",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "status"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(Map, {
        context: contextRef.value
      }, null, 8, [ "context" ]) ], 2)) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true), (0, 
      external_Vue_namespaceObject.createCommentVNode)(" 异变 Tab "), (0, external_Vue_namespaceObject.createElementVNode)("div", {
        id: "content_incidents",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "incidents"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(Incidents, {
        ref_key: "incidents",
        ref: incidents
      }, null, 512) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 其他角色 Tab "), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", {
        id: "content_others",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "others"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(ContentOthers, {
        ref_key: "contentOthers",
        ref: contentOthers
      }, null, 512) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 履历与关系 Tab "), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", {
        id: "content_bio",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "bio"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(ContentBio, {
        ref_key: "contentBio",
        ref: contentBio
      }, null, 512) ], 2), (0, external_Vue_namespaceObject.createCommentVNode)(" 设置 Tab "), (0, 
      external_Vue_namespaceObject.createElementVNode)("div", {
        id: "content_settings",
        class: (0, external_Vue_namespaceObject.normalizeClass)([ "status-tab-content", {
          active: activeTab.value === "settings"
        } ])
      }, [ (0, external_Vue_namespaceObject.createVNode)(ContentSettings, {
        ref_key: "contentSettings",
        ref: contentSettings
      }, null, 512) ], 2) ]), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ [移植] 结构结束 ") ]);
    };
  }
});

const StatusTabContent_exports_ = (0, exportHelper.A)(StatusTabContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-93a0a84e" ] ]);

const StatusTabContent = StatusTabContent_exports_;

const AyaNewsButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsButtonClosed",
  emits: [ "open-news" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "aya-news-button-closed",
      onClick: _cache[0] || (_cache[0] = $event => emit("open-news"))
    }, "文文新闻"));
  }
});

const AyaNewsButtonClosed_exports_ = (0, exportHelper.A)(AyaNewsButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-b15bd7b0" ] ]);

const AyaNewsButtonClosed = AyaNewsButtonClosed_exports_;

const AyaNewsButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsButtonOpen",
  emits: [ "close-news" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "aya-news-button-open",
      onClick: _cache[0] || (_cache[0] = $event => emit("close-news"))
    }, "文文新闻"));
  }
});

const AyaNewsButtonOpen_exports_ = (0, exportHelper.A)(AyaNewsButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-4b56fc8f" ] ]);

const AyaNewsButtonOpen = AyaNewsButtonOpen_exports_;

const AyaNewsPopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "aya-news-popup",
  class: "aya-news-popup",
  role: "dialog"
};

const AyaNewsPopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsPopup",
  emits: [ "close" ],
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/AyaNews/AyaNewsPopup");
    const updateNews = stat => {
      const funcName = "updateNews";
      if (!stat || typeof stat !== "object") {
        logger.warn(funcName, "调用失败：传入的 stat 无效。", stat);
        return;
      }
      try {
        const newsContent = stat.文文新闻 ?? "";
        logger.log(funcName, "将更新新闻文本", {
          preview: String(newsContent).slice(0, 50)
        });
        format_text("aya-news-content-popup", newsContent);
        logger.debug(funcName, "新闻文本已写入 DOM 完成");
      } catch (e) {
        logger.error(funcName, "更新新闻内容时发生异常", e);
      }
    };
    __expose({
      updateNews
    });
    (0, external_Vue_namespaceObject.onMounted)(() => {});
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", AyaNewsPopupvue_type_script_setup_true_lang_ts_hoisted_1, [ ..._cache[0] || (_cache[0] = [ (0, 
    external_Vue_namespaceObject.createElementVNode)("h4", null, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📰"), (0, external_Vue_namespaceObject.createTextVNode)("文文新闻") ], -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      id: "aya-news-content-popup",
      class: "news-body preserve-format"
    }, "—", -1) ]) ]));
  }
});

const AyaNewsPopup_exports_ = (0, exportHelper.A)(AyaNewsPopupvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-08972433" ] ]);

const AyaNewsPopup = AyaNewsPopup_exports_;

const AyaNewsContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "aya-news-container"
};

const AyaNewsContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "AyaNewsContainer",
  setup(__props, {expose: __expose}) {
    const newsVisible = (0, external_Vue_namespaceObject.ref)(false);
    const ayaNewsPopup = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      updateNews: stat => {
        ayaNewsPopup.value?.updateNews(stat);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", AyaNewsContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !newsVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(AyaNewsButtonClosed, {
      key: 0,
      onOpenNews: _cache[0] || (_cache[0] = $event => newsVisible.value = true)
    })) : ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(AyaNewsButtonOpen, {
      key: 1,
      onCloseNews: _cache[1] || (_cache[1] = $event => newsVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(AyaNewsPopup, {
      ref_key: "ayaNewsPopup",
      ref: ayaNewsPopup
    }, null, 512), [ [ external_Vue_namespaceObject.vShow, newsVisible.value ] ]) ]));
  }
});

const AyaNewsContainer_exports_ = (0, exportHelper.A)(AyaNewsContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-dfff4c24" ] ]);

const AyaNewsContainer = AyaNewsContainer_exports_;

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "GensokyoOrigin-RoleCard-header"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "GensokyoOrigin-RoleCard-avatar"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "GensokyoOrigin-RoleCard-name"
};

const RoleCardvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "GensokyoOrigin-RoleCard-meta"
};

const RoleCardvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleCard",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    }
  },
  emits: [ "show-details" ],
  setup(__props) {
    const props = __props;
    const particleEmitter = (0, external_Vue_namespaceObject.ref)(null);
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionState = (0, external_Vue_namespaceObject.computed)(() => {
      if (affectionValue.value >= loveThreshold.value) return "love";
      if (affectionValue.value <= hateThreshold.value) return "hate";
      return "neutral";
    });
    (0, external_Vue_namespaceObject.watch)(affectionState, (newState, oldState) => {
      if (newState !== oldState && particleEmitter.value) {
        if (newState === "love") {
          particleEmitter.value.burst("heart", 10);
        } else if (newState === "hate") {
          particleEmitter.value.burst("skull", 8);
        }
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      class: "GensokyoOrigin-RoleCard-wrapper",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("show-details", __props.character))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_2, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name.slice(0, 1)), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleCardvue_type_script_setup_true_lang_ts_hoisted_4, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character["所在地区"] || "未知"), 1) ]) ]), (0, 
    external_Vue_namespaceObject.createVNode)(AffectionDisplay, {
      character: __props.character,
      "stat-without-meta": __props.statWithoutMeta,
      runtime: __props.runtime,
      size: "small"
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]), (0, external_Vue_namespaceObject.createVNode)(ParticleEmitter, {
      ref_key: "particleEmitter",
      ref: particleEmitter,
      active: affectionState.value === "love" || affectionState.value === "hate",
      "particle-type": affectionState.value === "hate" ? "skull" : "heart",
      "emission-rate": 2
    }, null, 8, [ "active", "particle-type" ]) ]));
  }
});

const RoleCard_exports_ = RoleCardvue_type_script_setup_true_lang_ts;

const RoleCard = RoleCard_exports_;

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "GensokyoOrigin-RoleDetailPopup-popup"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "GensokyoOrigin-RoleDetailPopup-header"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "GensokyoOrigin-RoleDetailPopup-avatar"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "GensokyoOrigin-RoleDetailPopup-name"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_5 = {
  class: "GensokyoOrigin-RoleDetailPopup-meta"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "GensokyoOrigin-RoleDetailPopup-details-grid"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "GensokyoOrigin-RoleDetailPopup-detail-item"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "GensokyoOrigin-RoleDetailPopup-detail-item full-width"
};

const RoleDetailPopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleDetailPopup",
  props: {
    character: {
      type: Object,
      required: true
    },
    statWithoutMeta: {
      type: Object,
      required: true
    },
    runtime: {
      type: Object,
      required: true
    }
  },
  emits: [ "close" ],
  setup(__props) {
    const props = __props;
    const particleEmitter = (0, external_Vue_namespaceObject.ref)(null);
    const toText = v => {
      if (Array.isArray(v)) return v.length ? v.join("；") : "—";
      if (v == null || v === "") return "—";
      return String(v);
    };
    const affectionValue = (0, external_Vue_namespaceObject.computed)(() => props.character?.好感度 || 0);
    const loveThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.loveThreshold) || 100);
    const hateThreshold = (0, external_Vue_namespaceObject.computed)(() => Number(props.statWithoutMeta?.config?.affection?.hateThreshold) || -100);
    const affectionState = (0, external_Vue_namespaceObject.computed)(() => {
      if (affectionValue.value >= loveThreshold.value) return "love";
      if (affectionValue.value <= hateThreshold.value) return "hate";
      return "neutral";
    });
    (0, external_Vue_namespaceObject.watch)(affectionState, (newState, oldState) => {
      if (newState !== oldState && particleEmitter.value) {
        if (newState === "love") {
          particleEmitter.value.burst("heart", 15);
        } else if (newState === "hate") {
          particleEmitter.value.burst("skull", 12);
        }
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", {
      class: "GensokyoOrigin-RoleDetailPopup-overlay",
      onClick: _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.withModifiers)($event => _ctx.$emit("close"), [ "self" ]))
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      class: "GensokyoOrigin-RoleDetailPopup-close-btn",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close"))
    }, "×"), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name.slice(0, 1)), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", null, [ (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_4, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character.name), 1), (0, external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_5, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.character["所在地区"] || "未知"), 1) ]) ]), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item\">\n          <strong>年龄:</strong> {{ toText(character['年龄']) }}\n        </div>\n        <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item\">\n          <strong>性别:</strong> {{ toText(character['性别']) }}\n        </div>\n        <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item\">\n          <strong>身份:</strong> {{ toText(character['身份']) }}\n        </div> "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_7, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "居住地:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(toText(__props.character.居住地区)), 1) ]), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item full-width\">\n          <strong>性格:</strong> {{ toText(character['性格']) }}\n        </div>\n        <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item full-width\">\n          <strong>外貌:</strong> {{ toText(character['外貌']) }}\n        </div>\n        <div class=\"GensokyoOrigin-RoleDetailPopup-detail-item full-width\">\n          <strong>人际关系:</strong> {{ toText(character['人际关系']) }}\n        </div> "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", RoleDetailPopupvue_type_script_setup_true_lang_ts_hoisted_8, [ _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, "当前目标:", -1)), (0, 
    external_Vue_namespaceObject.createTextVNode)(" " + (0, external_Vue_namespaceObject.toDisplayString)(toText(__props.character.目标)), 1) ]) ]), (0, 
    external_Vue_namespaceObject.createVNode)(AffectionDisplay, {
      character: __props.character,
      "stat-without-meta": __props.statWithoutMeta,
      runtime: __props.runtime,
      size: "large"
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]), (0, external_Vue_namespaceObject.createVNode)(ParticleEmitter, {
      ref_key: "particleEmitter",
      ref: particleEmitter,
      active: affectionState.value === "love" || affectionState.value === "hate",
      "particle-type": affectionState.value === "hate" ? "skull" : "heart",
      "emission-rate": 3
    }, null, 8, [ "active", "particle-type" ]) ]) ]));
  }
});

const RoleDetailPopup_exports_ = RoleDetailPopupvue_type_script_setup_true_lang_ts;

const RoleDetailPopup = RoleDetailPopup_exports_;

const RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "role-ribbon-container"
};

const RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_2 = {
  key: 0,
  class: "role-card-placeholder"
};

const ribbonScrollStep = 320;

const RoleRibbonContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "RoleRibbonContainer",
  setup(__props, {expose: __expose}) {
    const state = (0, external_Vue_namespaceObject.reactive)({
      stat: null,
      runtime: null
    });
    const ribbon = (0, external_Vue_namespaceObject.ref)(null);
    const selectedCharacter = (0, external_Vue_namespaceObject.ref)(null);
    const nearbyCharacters = (0, external_Vue_namespaceObject.computed)(() => {
      const userLocation = state.stat?.user?.所在地区;
      if (!userLocation || !state.stat?.chars) {
        return [];
      }
      return Object.entries(state.stat.chars).filter(([, char]) => char && String(char.所在地区 || "").trim() === userLocation).map(([name, char]) => ({
        ...char,
        name
      }));
    });
    const scroll = direction => {
      ribbon.value?.scrollBy({
        left: direction * ribbonScrollStep,
        behavior: "smooth"
      });
    };
    const updateRibbon = context => {
      state.stat = context.statWithoutMeta;
      state.runtime = context.runtime;
    };
    __expose({
      updateRibbon
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "ribbon-left",
      class: "ribbon-arrow left",
      onClick: _cache[0] || (_cache[0] = $event => scroll(-1))
    }, "‹"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "ribbon-right",
      class: "ribbon-arrow right",
      onClick: _cache[1] || (_cache[1] = $event => scroll(1))
    }, "›"), (0, external_Vue_namespaceObject.createElementVNode)("div", {
      id: "role-ribbon",
      ref_key: "ribbon",
      ref: ribbon,
      class: "role-ribbon"
    }, [ ((0, external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(nearbyCharacters.value, char => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(RoleCard, {
      key: char.name,
      character: char,
      "stat-without-meta": state.stat,
      runtime: state.runtime,
      onShowDetails: _cache[2] || (_cache[2] = $event => selectedCharacter.value = $event)
    }, null, 8, [ "character", "stat-without-meta", "runtime" ]))), 128)), !nearbyCharacters.value.length ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", RoleRibbonContainervue_type_script_setup_true_lang_ts_hoisted_2, "附近暂无角色")) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ], 512), selectedCharacter.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(RoleDetailPopup, {
      key: 0,
      character: selectedCharacter.value,
      "stat-without-meta": state.stat,
      runtime: state.runtime,
      onClose: _cache[3] || (_cache[3] = $event => selectedCharacter.value = null)
    }, null, 8, [ "character", "stat-without-meta", "runtime" ])) : (0, external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const RoleRibbonContainer_exports_ = (0, exportHelper.A)(RoleRibbonContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-d2e5aac6" ] ]);

const RoleRibbonContainer = RoleRibbonContainer_exports_;

const TimeButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeButtonClosed",
  props: {
    clockInfo: {}
  },
  emits: [ "open-calendar" ],
  setup(__props) {
    const props = __props;
    const timeText = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.clockInfo) return "—:—";
      return props.clockInfo.hm ? `${props.clockInfo.hm} · ${props.clockInfo.periodName || ""}` : props.clockInfo.iso || "—";
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-time-closed",
      class: "banner-chip",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("open-calendar"))
    }, [ _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "⏰", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(timeText.value), 1) ]));
  }
});

const TimeButtonClosed_exports_ = (0, exportHelper.A)(TimeButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-37a35e60" ] ]);

const TimeButtonClosed = TimeButtonClosed_exports_;

const TimeButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeButtonOpen",
  emits: [ "close-calendar" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-time-open",
      class: "banner-chip-open",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close-calendar"))
    }, [ ..._cache[1] || (_cache[1] = [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📅", -1), (0, external_Vue_namespaceObject.createElementVNode)("span", null, "日历", -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "close-icon"
    }, "收起", -1) ]) ]));
  }
});

const TimeButtonOpen_exports_ = (0, exportHelper.A)(TimeButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-a8d897e6" ] ]);

const TimeButtonOpen = TimeButtonOpen_exports_;

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "cal-day-container"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_2 = [ "data-importance" ];

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "dnum"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_4 = {
  key: 1,
  class: "cal-day-placeholder"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_5 = {
  key: 2,
  class: "fest-popover"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_6 = {
  class: "fest-header"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_7 = {
  class: "fest-host"
};

const CalendarDayvue_type_script_setup_true_lang_ts_hoisted_8 = {
  class: "fest-customs"
};

const CalendarDayvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CalendarDay",
  props: {
    day: {}
  },
  setup(__props) {
    const props = __props;
    const hasFestivals = (0, external_Vue_namespaceObject.computed)(() => !!(props.day.festivals && props.day.festivals.length > 0));
    const showPopover = (0, external_Vue_namespaceObject.ref)(false);
    const highestImportance = (0, external_Vue_namespaceObject.computed)(() => {
      if (!hasFestivals.value || !props.day.festivals) return 0;
      return Math.max(...props.day.festivals.map(f => f.importance));
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_1, [ !__props.day.isPlaceholder ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      key: 0,
      type: "button",
      class: (0, external_Vue_namespaceObject.normalizeClass)([ "cal-day-btn", {
        today: __props.day.isToday,
        "has-fest": hasFestivals.value
      } ]),
      "data-importance": highestImportance.value,
      onMouseenter: _cache[0] || (_cache[0] = $event => showPopover.value = hasFestivals.value),
      onMouseleave: _cache[1] || (_cache[1] = $event => showPopover.value = false)
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_3, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.day.date), 1) ], 42, CalendarDayvue_type_script_setup_true_lang_ts_hoisted_2)) : ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_4)), showPopover.value && hasFestivals.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_5, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(__props.day.festivals, fest => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("div", {
      key: fest.name,
      class: "fest-item"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_6, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("strong", null, (0, external_Vue_namespaceObject.toDisplayString)(fest.name), 1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_7, "@ " + (0, 
    external_Vue_namespaceObject.toDisplayString)(fest.主办地), 1) ]), (0, external_Vue_namespaceObject.createElementVNode)("ul", CalendarDayvue_type_script_setup_true_lang_ts_hoisted_8, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(fest.customs, (custom, index) => ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createElementBlock)("li", {
      key: index
    }, (0, external_Vue_namespaceObject.toDisplayString)(custom), 1))), 128)) ]) ]))), 128)) ])) : (0, 
    external_Vue_namespaceObject.createCommentVNode)("v-if", true) ]));
  }
});

const CalendarDay_exports_ = (0, exportHelper.A)(CalendarDayvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-35064b7e" ] ]);

const CalendarDay = CalendarDay_exports_;

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "cal-content",
  class: "cal-content",
  role: "region"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_2 = {
  class: "cal-head"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "cal-nav"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_4 = {
  class: "cal-body"
};

const CalendarContentvue_type_script_setup_true_lang_ts_hoisted_5 = {
  id: "cal-grid",
  class: "cal-grid"
};

const CalendarContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "CalendarContent",
  props: {
    clockInfo: {}
  },
  setup(__props) {
    const props = __props;
    const displayMonth = (0, external_Vue_namespaceObject.ref)(new Date);
    const festivals = (0, external_Vue_namespaceObject.computed)(() => props.clockInfo?.festivals || []);
    const updateMonth = direction => {
      const newMonth = new Date(displayMonth.value);
      newMonth.setMonth(newMonth.getMonth() + (direction === "prev" ? -1 : 1));
      displayMonth.value = newMonth;
    };
    const resetMonth = () => {
      displayMonth.value = props.clockInfo?.iso ? new Date(props.clockInfo.iso) : new Date;
    };
    const calendarDays = (0, external_Vue_namespaceObject.computed)(() => {
      if (!props.clockInfo) return [];
      const year = displayMonth.value.getFullYear();
      const month = displayMonth.value.getMonth();
      const today = props.clockInfo.iso ? new Date(props.clockInfo.iso) : new Date;
      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);
      const daysInMonth = lastDayOfMonth.getDate();
      const startDayOfWeek = (firstDayOfMonth.getDay() + 6) % 7;
      const days = [];
      for (let i = 0; i < startDayOfWeek; i++) {
        days.push({
          isPlaceholder: true
        });
      }
      for (let i = 1; i <= daysInMonth; i++) {
        const dayFestivals = festivals.value.filter(f => f.month === month + 1 && i >= f.start_day && i <= f.end_day);
        const isToday = year === today.getFullYear() && month === today.getMonth() && i === today.getDate();
        days.push({
          date: i,
          isToday,
          isPlaceholder: false,
          festivals: dayFestivals
        });
      }
      return days;
    });
    (0, external_Vue_namespaceObject.watch)(displayMonth, newDate => {
      const monthStr = `${newDate.getMonth() + 1}月`;
      const yearStr = `${newDate.getFullYear()}年`;
      format_text("cal-month", monthStr);
      format_text("cal-year", yearStr);
    }, {
      immediate: true
    });
    (0, external_Vue_namespaceObject.watch)(() => props.clockInfo, newClockInfo => {
      if (newClockInfo?.iso) {
        displayMonth.value = new Date(newClockInfo.iso);
      }
    }, {
      immediate: true
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_2, [ _cache[2] || (_cache[2] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "cal-title"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      id: "cal-month",
      class: "month"
    }, "—月"), (0, external_Vue_namespaceObject.createElementVNode)("span", {
      id: "cal-year",
      class: "year"
    }, "—年") ], -1)), (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-prev",
      class: "cal-btn",
      title: "上一月",
      onClick: _cache[0] || (_cache[0] = $event => updateMonth("prev"))
    }, "◀"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-today",
      class: "cal-btn",
      title: "回到今天",
      onClick: resetMonth
    }, "●"), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "cal-next",
      class: "cal-btn",
      title: "下一月",
      onClick: _cache[1] || (_cache[1] = $event => updateMonth("next"))
    }, "▶") ]) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_4, [ _cache[3] || (_cache[3] = (0, 
    external_Vue_namespaceObject.createStaticVNode)('<div class="cal-week" data-v-03881b10><div class="w" data-v-03881b10>一</div><div class="w" data-v-03881b10>二</div><div class="w" data-v-03881b10>三</div><div class="w" data-v-03881b10>四</div><div class="w" data-v-03881b10>五</div><div class="w" data-v-03881b10>六</div><div class="w" data-v-03881b10>日</div></div>', 1)), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", CalendarContentvue_type_script_setup_true_lang_ts_hoisted_5, [ ((0, 
    external_Vue_namespaceObject.openBlock)(true), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, (0, 
    external_Vue_namespaceObject.renderList)(calendarDays.value, (day, index) => ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(CalendarDay, {
      key: index,
      day
    }, null, 8, [ "day" ]))), 128)) ]) ]) ]));
  }
});

const CalendarContent_exports_ = (0, exportHelper.A)(CalendarContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-03881b10" ] ]);

const CalendarContent = CalendarContent_exports_;

const TimeContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "time-container"
};

const TimeContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "TimeContainer",
  props: {
    stat: {},
    runtime: {}
  },
  setup(__props) {
    const props = __props;
    const calendarVisible = (0, external_Vue_namespaceObject.ref)(false);
    const clockInfo = (0, external_Vue_namespaceObject.computed)(() => {
      const clockNow = props.runtime?.clock?.now;
      const festivals = props.stat?.festivals_list;
      if (clockNow && festivals) {
        return {
          ...clockNow,
          festivals
        };
      }
      return null;
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", TimeContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !calendarVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(TimeButtonClosed, {
      key: 0,
      onOpenCalendar: _cache[0] || (_cache[0] = $event => calendarVisible.value = true),
      "clock-info": clockInfo.value
    }, null, 8, [ "clock-info" ])) : ((0, external_Vue_namespaceObject.openBlock)(), 
    (0, external_Vue_namespaceObject.createBlock)(TimeButtonOpen, {
      key: 1,
      onCloseCalendar: _cache[1] || (_cache[1] = $event => calendarVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(CalendarContent, {
      "clock-info": clockInfo.value
    }, null, 8, [ "clock-info" ]), [ [ external_Vue_namespaceObject.vShow, calendarVisible.value ] ]) ]));
  }
});

const TimeContainer_exports_ = (0, exportHelper.A)(TimeContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-517ae222" ] ]);

const TimeContainer = TimeContainer_exports_;

const WeatherButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherButtonClosed",
  props: {
    weather: {}
  },
  emits: [ "open-weather" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-weather-closed",
      class: "banner-chip",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("open-weather"))
    }, [ _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "☀️", -1)), (0, external_Vue_namespaceObject.createElementVNode)("span", null, (0, 
    external_Vue_namespaceObject.toDisplayString)(__props.weather || "—"), 1) ]));
  }
});

const WeatherButtonClosed_exports_ = (0, exportHelper.A)(WeatherButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-11b37370" ] ]);

const WeatherButtonClosed = WeatherButtonClosed_exports_;

const WeatherButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherButtonOpen",
  emits: [ "close-weather" ],
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      id: "banner-weather-open",
      class: "banner-chip-open",
      onClick: _cache[0] || (_cache[0] = $event => _ctx.$emit("close-weather"))
    }, [ ..._cache[1] || (_cache[1] = [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "🌦️", -1), (0, external_Vue_namespaceObject.createElementVNode)("span", null, "天气详情", -1), (0, 
    external_Vue_namespaceObject.createElementVNode)("span", {
      class: "close-icon"
    }, "收起", -1) ]) ]));
  }
});

const WeatherButtonOpen_exports_ = (0, exportHelper.A)(WeatherButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-1a6d77c8" ] ]);

const WeatherButtonOpen = WeatherButtonOpen_exports_;

const WeatherContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "weather-content"
};

const WeatherContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherContent",
  props: {
    weather: {}
  },
  setup(__props) {
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", WeatherContentvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createElementVNode)("p", null, "当前天气: " + (0, external_Vue_namespaceObject.toDisplayString)(__props.weather || "未知"), 1), _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("p", null, [ (0, external_Vue_namespaceObject.createElementVNode)("em", null, "(未来可扩充天气预报等详细信息)") ], -1)) ]));
  }
});

const WeatherContent_exports_ = (0, exportHelper.A)(WeatherContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-16c06ed4" ] ]);

const WeatherContent = WeatherContent_exports_;

const WeatherContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "weather-container"
};

const WeatherContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "WeatherContainer",
  props: {
    stat: {
      type: Object,
      required: true
    }
  },
  setup(__props) {
    const props = __props;
    const weatherVisible = (0, external_Vue_namespaceObject.ref)(false);
    const weather = (0, external_Vue_namespaceObject.computed)(() => props.stat?.weather ?? null);
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", WeatherContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !weatherVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(WeatherButtonClosed, {
      key: 0,
      onOpenWeather: _cache[0] || (_cache[0] = $event => weatherVisible.value = true),
      weather: weather.value
    }, null, 8, [ "weather" ])) : ((0, external_Vue_namespaceObject.openBlock)(), (0, 
    external_Vue_namespaceObject.createBlock)(WeatherButtonOpen, {
      key: 1,
      onCloseWeather: _cache[1] || (_cache[1] = $event => weatherVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(WeatherContent, {
      weather: weather.value
    }, null, 8, [ "weather" ]), [ [ external_Vue_namespaceObject.vShow, weatherVisible.value ] ]) ]));
  }
});

const WeatherContainer_exports_ = (0, exportHelper.A)(WeatherContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-0c8bdfda" ] ]);

const WeatherContainer = WeatherContainer_exports_;

const StatusBannerContentvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-banner",
  class: "status-banner"
};

const StatusBannerContentvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "StatusBannerContent",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/StatusBanner/StatusBannerContent");
    const statData = (0, external_Vue_namespaceObject.ref)(null);
    const runtimeData = (0, external_Vue_namespaceObject.ref)(null);
    const update = ({statWithoutMeta, runtime}) => {
      const funcName = "update";
      logger.log(funcName, "状态横幅内容区开始更新，接收到的数据：", {
        statWithoutMeta,
        runtime
      });
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 statWithoutMeta 无效。", {
          statWithoutMeta,
          runtime
        });
        return;
      }
      statData.value = statWithoutMeta;
      runtimeData.value = runtime;
    };
    __expose({
      update
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ===== 状态横幅：时间（可点弹日历） | 天气（预留点击） ===== "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", StatusBannerContentvue_type_script_setup_true_lang_ts_hoisted_1, [ _cache[0] || (_cache[0] = (0, 
    external_Vue_namespaceObject.createElementVNode)("div", {
      class: "banner-title"
    }, [ (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "emoji"
    }, "📡"), (0, external_Vue_namespaceObject.createElementVNode)("span", null, "世界状态") ], -1)), (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 日期和日历组件 "), (0, external_Vue_namespaceObject.createVNode)(TimeContainer, {
      ref: "timeContainer",
      stat: statData.value,
      runtime: runtimeData.value
    }, null, 8, [ "stat", "runtime" ]), _cache[1] || (_cache[1] = (0, external_Vue_namespaceObject.createElementVNode)("span", {
      class: "banner-sep",
      "aria-hidden": "true"
    }, null, -1)), (0, external_Vue_namespaceObject.createCommentVNode)(" 天气组件 "), (0, 
    external_Vue_namespaceObject.createVNode)(WeatherContainer, {
      stat: statData.value
    }, null, 8, [ "stat" ]) ]) ], 2112));
  }
});

const StatusBannerContent_exports_ = (0, exportHelper.A)(StatusBannerContentvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-55265fac" ] ]);

const StatusBannerContent = StatusBannerContent_exports_;

const ThemeTogglevue_type_script_setup_true_lang_ts_hoisted_1 = [ "aria-label", "title", "aria-pressed" ];

const LIGHT = "light";

const DARK = "dark";

const ThemeTogglevue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "ThemeToggle",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/ThemeToggle");
    const currentTheme = (0, external_Vue_namespaceObject.ref)(LIGHT);
    const icon = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "🌙" : "🌞");
    const ariaLabel = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "切换为黑夜模式" : "切换为白日模式");
    const title = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === LIGHT ? "切换为黑夜模式" : "切换为白日模式");
    const isDark = (0, external_Vue_namespaceObject.computed)(() => currentTheme.value === DARK);
    const applyThemeToDOM = theme => {
      const root = document.documentElement;
      if (root) {
        root.setAttribute("data-theme", theme);
        logger.log("applyThemeToDOM", `已将主题应用到 DOM: ${theme}`);
      } else {
        logger.warn("applyThemeToDOM", "未找到 document.documentElement 元素。");
      }
    };
    const updateTheme = context => {
      const funcName = "updateTheme";
      const {statWithoutMeta} = context || {};
      if (!statWithoutMeta || typeof statWithoutMeta !== "object") {
        logger.warn(funcName, "调用失败：传入的 context 或 statWithoutMeta 无效。", context);
        return;
      }
      const newTheme = statWithoutMeta.config?.ui?.theme;
      const validatedTheme = newTheme === DARK ? DARK : LIGHT;
      currentTheme.value = validatedTheme;
      applyThemeToDOM(validatedTheme);
      logger.log(funcName, `从 statWithoutMeta 更新主题为: ${validatedTheme}`);
    };
    (0, external_Vue_namespaceObject.onMounted)(() => {
      const funcName = "onMounted";
      const btn = document.getElementById("theme-toggle");
      if (btn) {
        btn.onclick = () => {
          const nextTheme = currentTheme.value === DARK ? LIGHT : DARK;
          logger.log(`${funcName}:onclick`, `按钮被点击，准备切换到主题: ${nextTheme}`);
          currentTheme.value = nextTheme;
          applyThemeToDOM(nextTheme);
          const updateObject = {
            config: {
              ui: {
                theme: nextTheme
              }
            }
          };
          updateEraVariableByObject(updateObject);
          logger.log(`${funcName}:onclick`, `已通过 eraWriter 请求更新主题变量为:`, updateObject);
        };
        logger.log(funcName, "主题切换按钮的点击事件已成功绑定。");
      } else {
        logger.warn(funcName, "未找到 #theme-toggle 按钮元素，事件绑定失败。");
      }
    });
    __expose({
      updateTheme
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)(external_Vue_namespaceObject.Fragment, null, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" 主题切换按钮 "), (0, external_Vue_namespaceObject.createElementVNode)("button", {
      id: "theme-toggle",
      class: "theme-toggle",
      "aria-label": ariaLabel.value,
      title: title.value,
      "aria-pressed": isDark.value
    }, (0, external_Vue_namespaceObject.toDisplayString)(icon.value), 9, ThemeTogglevue_type_script_setup_true_lang_ts_hoisted_1) ], 2112));
  }
});

const ThemeToggle_exports_ = (0, exportHelper.A)(ThemeTogglevue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-676236f6" ] ]);

const ThemeToggle = ThemeToggle_exports_;

const UserStateButtonClosedvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateButtonClosed",
  emits: [ "open-sidebar" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "user-state-button-closed",
      onClick: _cache[0] || (_cache[0] = $event => emit("open-sidebar"))
    }, "用户信息"));
  }
});

const UserStateButtonClosed_exports_ = (0, exportHelper.A)(UserStateButtonClosedvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-89abe3c0" ] ]);

const UserStateButtonClosed = UserStateButtonClosed_exports_;

const UserStateButtonOpenvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateButtonOpen",
  emits: [ "close-sidebar" ],
  setup(__props, {emit: __emit}) {
    const emit = __emit;
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("button", {
      class: "user-state-button-open",
      onClick: _cache[0] || (_cache[0] = $event => emit("close-sidebar"))
    }, "用户信息"));
  }
});

const UserStateButtonOpen_exports_ = (0, exportHelper.A)(UserStateButtonOpenvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-682280a6" ] ]);

const UserStateButtonOpen = UserStateButtonOpen_exports_;

const UserStatePopupvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "user-state-popup",
  class: "user-state-popup",
  role: "region",
  "aria-label": "用户状态"
};

const UserStatePopupvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStatePopup",
  emits: [ "close" ],
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/UserState/UserStatePopup");
    const style = (0, external_Vue_namespaceObject.ref)({});
    const positionPopup = _anchorEl => {
      style.value = {};
    };
    const updateUserStatus = (stat, anchorEl) => {
      if (anchorEl) {
        positionPopup(anchorEl);
      }
      const funcName = "updateUserStatus";
      logger.debug(funcName, "函数入口，接收到的 stat:", stat);
      if (!stat || typeof stat !== "object" || !stat.user) {
        logger.warn(funcName, "调用失败：传入的 stat 无效或缺少 user 属性。", stat);
        return;
      }
      const {user} = stat;
      const map = [ [ "user-name-popup", user.姓名 ], [ "user-identity-popup", user.身份 ], [ "user-gender-popup", user.性别 ], [ "user-age-popup", user.年龄 ], [ "user-abilities-popup", user.特殊能力 ], [ "user-location-popup", user.所在地区 ], [ "user-home-popup", user.居住地区 ] ];
      map.forEach(([id, value]) => {
        const displayValue = value ?? "—";
        logger.debug(funcName, `[写入DOM] 准备向 #${id} 写入内容:`, displayValue);
        format_text(id, displayValue);
      });
      logger.debug(funcName, "所有字段更新完成。");
    };
    __expose({
      updateUserStatus,
      positionPopup
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", UserStatePopupvue_type_script_setup_true_lang_ts_hoisted_1, [ ..._cache[0] || (_cache[0] = [ (0, 
    external_Vue_namespaceObject.createStaticVNode)('<h4 data-v-9ec113e0><span class="emoji" data-v-9ec113e0>👤</span>用户状态</h4><div class="sidebar-content" data-v-9ec113e0><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>📝</span>姓名:</span> <span id="user-name-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>🪪</span>身份:</span> <span id="user-identity-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>⚧️</span>性别:</span> <span id="user-gender-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>🎂</span>年龄:</span> <span id="user-age-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>✨</span>特殊能力:</span> <span id="user-abilities-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>📍</span>所在地区:</span> <span id="user-location-popup" data-v-9ec113e0>—</span></p><p data-v-9ec113e0><span class="label" data-v-9ec113e0><span class="emoji" data-v-9ec113e0>🏠</span>居住地区:</span> <span id="user-home-popup" data-v-9ec113e0>—</span></p></div>', 2) ]) ]));
  }
});

const UserStatePopup_exports_ = (0, exportHelper.A)(UserStatePopupvue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-9ec113e0" ] ]);

const UserStatePopup = UserStatePopup_exports_;

const UserStateContainervue_type_script_setup_true_lang_ts_hoisted_1 = {
  class: "user-state-container"
};

const UserStateContainervue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  __name: "UserStateContainer",
  setup(__props, {expose: __expose}) {
    const logger = new Logger("幻想乡缘起-主页面/components/UserState/UserStateContainer");
    const sidebarVisible = (0, external_Vue_namespaceObject.ref)(false);
    const userStatePopup = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      updateUserStatus: stat => {
        logger.debug("updateUserStatus", "更新用户状态数据", stat);
        userStatePopup.value?.updateUserStatus(stat);
      }
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", UserStateContainervue_type_script_setup_true_lang_ts_hoisted_1, [ !sidebarVisible.value ? ((0, 
    external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(UserStateButtonClosed, {
      key: 0,
      onOpenSidebar: _cache[0] || (_cache[0] = $event => sidebarVisible.value = true)
    })) : ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createBlock)(UserStateButtonOpen, {
      key: 1,
      onCloseSidebar: _cache[1] || (_cache[1] = $event => sidebarVisible.value = false)
    })), (0, external_Vue_namespaceObject.withDirectives)((0, external_Vue_namespaceObject.createVNode)(UserStatePopup, {
      ref_key: "userStatePopup",
      ref: userStatePopup
    }, null, 512), [ [ external_Vue_namespaceObject.vShow, sidebarVisible.value ] ]) ]));
  }
});

const UserStateContainer_exports_ = (0, exportHelper.A)(UserStateContainervue_type_script_setup_true_lang_ts, [ [ "__scopeId", "data-v-0a721dc0" ] ]);

const UserStateContainer = UserStateContainer_exports_;

const appvue_type_script_setup_true_lang_ts_hoisted_1 = {
  id: "status-container",
  class: "status-ui-container"
};

const appvue_type_script_setup_true_lang_ts_hoisted_2 = {
  id: "status-duo",
  class: "status-duo"
};

const appvue_type_script_setup_true_lang_ts_hoisted_3 = {
  class: "status-main-content"
};

const __default__ = (0, external_Vue_namespaceObject.defineComponent)({
  name: "App"
});

const appvue_type_script_setup_true_lang_ts = (0, external_Vue_namespaceObject.defineComponent)({
  ...__default__,
  setup(__props, {expose: __expose}) {
    const themeToggle = (0, external_Vue_namespaceObject.ref)(null);
    const userState = (0, external_Vue_namespaceObject.ref)(null);
    const ayaNews = (0, external_Vue_namespaceObject.ref)(null);
    const statusBanner = (0, external_Vue_namespaceObject.ref)(null);
    const statusTabContent = (0, external_Vue_namespaceObject.ref)(null);
    const roleRibbon = (0, external_Vue_namespaceObject.ref)(null);
    __expose({
      themeToggle,
      userState,
      ayaNews,
      statusBanner,
      statusTabContent,
      roleRibbon
    });
    return (_ctx, _cache) => ((0, external_Vue_namespaceObject.openBlock)(), (0, external_Vue_namespaceObject.createElementBlock)("div", appvue_type_script_setup_true_lang_ts_hoisted_1, [ (0, 
    external_Vue_namespaceObject.createCommentVNode)(" ▼ 新增：右上角主题切换按钮 "), (0, external_Vue_namespaceObject.createVNode)(ThemeToggle, {
      ref_key: "themeToggle",
      ref: themeToggle
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ 新增 "), (0, 
    external_Vue_namespaceObject.createElementVNode)("div", appvue_type_script_setup_true_lang_ts_hoisted_2, [ (0, 
    external_Vue_namespaceObject.createVNode)(UserStateContainer, {
      ref_key: "userState",
      ref: userState
    }, null, 512), (0, external_Vue_namespaceObject.createVNode)(AyaNewsContainer, {
      ref_key: "ayaNews",
      ref: ayaNews
    }, null, 512) ]), (0, external_Vue_namespaceObject.createElementVNode)("div", appvue_type_script_setup_true_lang_ts_hoisted_3, [ (0, 
    external_Vue_namespaceObject.createVNode)(RoleRibbonContainer, {
      ref_key: "roleRibbon",
      ref: roleRibbon
    }, null, 512), (0, external_Vue_namespaceObject.createVNode)(StatusBannerContent, {
      ref_key: "statusBanner",
      ref: statusBanner
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▼ [重构] 选项卡区域已被封装到 StatusTabContent 组件中 "), (0, 
    external_Vue_namespaceObject.createVNode)(StatusTabContent, {
      ref_key: "statusTabContent",
      ref: statusTabContent
    }, null, 512), (0, external_Vue_namespaceObject.createCommentVNode)(" ▲ [重构] ") ]) ]));
  }
});

const app_exports_ = appvue_type_script_setup_true_lang_ts;

const _app = app_exports_;

$(() => {
  const app = (0, external_Vue_namespaceObject.createApp)(_app);
  const appInstance = app.mount("#app");
  window.vueApp = appInstance;
  const logger = new Logger("幻想乡缘起-主页面");
  eventOn("GSKO:showUI", detail => {
    const funcName = "onShowUI";
    try {
      logContext.mk = String(detail?.mk || "");
    } catch {
      logContext.mk = "";
    }
    logger.log(funcName, "收到 GSKO:showUI 事件", detail);
    if (detail?.actions?.apiWrite === true) {
      logger.log(funcName, "检测到 apiWrite 标记事件，跳过刷新逻辑");
      return;
    }
    logger.debug(funcName, "GSKO:showUI 事件详细内容", detail);
    try {
      const {statWithoutMeta, runtime} = detail || {};
      if (!statWithoutMeta) {
        logger.warn(funcName, "事件中未找到 statWithoutMeta，无法刷新 UI。");
        return;
      }
      if (!runtime) {
        logger.warn(funcName, "事件中未找到 runtime 数据，界面渲染可能不完整。");
      }
      const parsedStat = StatSchema.parse(statWithoutMeta);
      const parsedRuntime = RuntimeSchema.parse(runtime);
      const context = {
        statWithoutMeta: parsedStat,
        runtime: parsedRuntime
      };
      logger.debug(funcName, "传给各子模块的上下文对象:", context);
      const {themeToggle, userState, statusBanner, ayaNews, statusTabContent, roleRibbon} = appInstance;
      try {
        if (themeToggle && typeof themeToggle.updateTheme === "function") {
          logger.debug(funcName, "调用 ThemeToggle.updateTheme");
          themeToggle.updateTheme(context);
          logger.debug(funcName, "ThemeToggle.updateTheme 执行完毕");
        } else {
          logger.warn(funcName, "ThemeToggle 组件缺少 updateTheme 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "ThemeToggle.updateTheme 执行失败，错误信息如下", e);
      }
      try {
        if (userState && typeof userState.updateUserStatus === "function") {
          logger.debug(funcName, "调用 UserState.updateUserStatus");
          userState.updateUserStatus(parsedStat);
          logger.debug(funcName, "UserState.updateUserStatus 执行完毕");
        } else {
          logger.warn(funcName, "UserState 组件缺少 updateUserStatus 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "UserState.updateUserStatus 执行失败，错误信息如下", e);
      }
      try {
        if (statusBanner && typeof statusBanner.update === "function") {
          logger.debug(funcName, "调用 StatusBanner.update");
          statusBanner.update(context);
          logger.debug(funcName, "StatusBanner.update 执行完毕");
        } else {
          logger.warn(funcName, "StatusBanner 组件缺少 update 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "StatusBanner.update 执行失败，错误信息如下", e);
      }
      try {
        if (ayaNews && typeof ayaNews.updateNews === "function") {
          logger.debug(funcName, "调用 AyaNews.updateNews");
          ayaNews.updateNews(parsedStat);
          logger.debug(funcName, "AyaNews.updateNews 执行完毕");
        } else {
          logger.warn(funcName, "AyaNews 组件缺少 updateNews 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "AyaNews.updateNews 执行失败，错误信息如下", e);
      }
      try {
        if (statusTabContent && typeof statusTabContent.update === "function") {
          logger.log(funcName, "调用 StatusTabContent.update...");
          statusTabContent.update(context);
          logger.debug(funcName, "StatusTabContent.update 执行完毕");
        } else {
          logger.warn(funcName, "StatusTabContent 组件缺少 update 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "StatusTabContent.update 执行失败，错误信息如下", e);
      }
      try {
        if (roleRibbon && typeof roleRibbon.updateRibbon === "function") {
          logger.log(funcName, "调用 RoleRibbon.updateRibbon...");
          roleRibbon.updateRibbon(context);
          logger.debug(funcName, "RoleRibbon.updateRibbon 执行完毕");
        } else {
          logger.warn(funcName, "RoleRibbon 组件缺少 updateRibbon 方法。");
        }
      } catch (e) {
        logger.warn(funcName, "RoleRibbon.updateRibbon 执行失败，错误信息如下", e);
      }
    } catch (e) {
      logger.error(funcName, "GSKO:showUI 处理流程出现未捕获异常", e);
    } finally {
      logContext.mk = "";
    }
  });
});</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap);
h4[data-v-3e602d5b]{display:flex;align-items:center;font-size:1.1em;color:var(--muted);margin:0 0 10px}h4 .emoji[data-v-3e602d5b]{margin-right:8px;font-size:1.1em}.preserve-format[data-v-3e602d5b]{white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word;line-height:1.6;font-size:.95em}hr.dashed[data-v-3e602d5b]{border:none;border-top:1px dashed var(--line);margin:20px 0}
.styled-progress-bar[data-v-0390f826]{background:var(--bar-bg);border:1px solid var(--line);border-radius:5px;overflow:hidden;position:relative;flex-grow:1}.styled-progress-bar.size-large[data-v-0390f826]{height:10px}.styled-progress-bar.size-small[data-v-0390f826]{height:8px;max-width:80px}.styled-progress-bar .val[data-v-0390f826]{position:absolute;top:0;bottom:0;height:100%;width:0%;background:linear-gradient(90deg,#c0a58a,#8c7b6a);transition:width .3s ease}.styled-progress-bar.rtl .val[data-v-0390f826]{left:auto;right:0}.styled-progress-bar.negative .val[data-v-0390f826]{background:#b00020}.styled-progress-bar.very-hate .val[data-v-0390f826]{background:#000}.styled-progress-bar.very-love .val[data-v-0390f826]{background:linear-gradient(90deg,#7e3ff2,#c084fc)}
.affection-display[data-v-78646038]{width:100%}.info-line[data-v-78646038]{display:flex;align-items:center;gap:8px;font-size:.9em;margin-bottom:4px}.aff-stage[data-v-78646038]{font-size:.9em;color:var(--muted);margin-left:auto}
.GensokyoOrigin-Particle{position:absolute;line-height:1;-webkit-user-select:none;user-select:none;opacity:0;filter:drop-shadow(0 0 6px rgba(0,0,0,0.25));animation:GensokyoOrigin-Particle-pop 1.2s ease-out forwards;font-size:16px}@keyframes GensokyoOrigin-Particle-pop{0%{transform:translate(0,0) scale(0.8) rotate(0deg);opacity:0}20%{opacity:1}100%{transform:translate(var(--dx,0),var(--dy,-40px)) scale(1.1) rotate(var(--rot,0deg));opacity:0}}.GensokyoOrigin-Particle--heart{color:#b65ff7;text-shadow:0 0 8px rgba(182,95,247,.7),0 0 4px hsla(0,0%,100%,.8)}.GensokyoOrigin-Particle--skull{color:#222;text-shadow:0 0 6px rgba(0,0,0,.5),0 0 3px #fff}:root[data-theme=dark] .GensokyoOrigin-Particle--skull{color:#714f4f;text-shadow:0 0 7px rgba(185,88,88,.7),0 0 3px rgba(255,210,210,.8)}
.particle-emitter-root{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden}
.GensokyoOrigin-ContentOthers-debug-toolbar{display:flex;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap}.GensokyoOrigin-ContentOthers-debug-switch{display:flex;align-items:center;gap:6px;font-size:.9em;padding:4px 8px;border:1px dashed var(--line);border-radius:6px;background:hsla(0,0%,100%,.08)}.GensokyoOrigin-ContentOthers-incident-list{display:flex;flex-direction:column;gap:12px}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card{flex:1 1 auto;min-width:0;background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:var(--pad);position:relative;overflow:hidden;transition:box-shadow .2s ease,transform .02s ease}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding-bottom:8px;border-bottom:1px dashed var(--line)}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card-header>div:nth-child(2){flex:1 1 auto;min-width:0}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-avatar{width:40px;height:40px;border-radius:50%;border:1px solid var(--line);background:var(--avatar-bg);display:grid;place-items:center;font-weight:700;color:var(--muted);flex-shrink:0}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-meta{font-size:.85em;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-card-toggle{margin-left:auto;border:1px solid var(--line);background:var(--paper);border-radius:6px;padding:4px 8px;font-weight:700;cursor:pointer;flex:0 0 auto}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-body{margin-top:8px;border-top:1px dashed var(--line);padding-top:8px;position:relative}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-line{margin:6px 0;font-size:.9em;display:flex;flex-wrap:wrap}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card.collapsed{padding-bottom:8px}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card.collapsed .GensokyoOrigin-ContentOthers-role-body{display:none}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card.collapsed .GensokyoOrigin-ContentOthers-role-card-header{margin-bottom:0;padding-bottom:6px}.GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card.expanded{padding-bottom:calc(var(--pad) + 8px);box-shadow:0 2px 12px rgba(0,0,0,.06);max-height:none;overflow:visible}:root[data-theme=dark] .GensokyoOrigin-ContentOthers-debug-switch{background:hsla(0,0%,100%,.05)}:root[data-theme=dark] .GensokyoOrigin-ContentOthers-incident-list .GensokyoOrigin-ContentOthers-role-card.expanded{box-shadow:0 2px 12px rgba(0,0,0,.35)}
[data-v-851a0cc6] [data-path]{background:rgba(255,247,232,.06);border:1px dashed var(--line);border-radius:8px;padding:10px 12px;margin:10px 0}[data-v-851a0cc6] input[type="text"],[data-v-851a0cc6] input[type="number"],[data-v-851a0cc6] textarea,[data-v-851a0cc6] select{width:100%;background:var(--control-bg);border:1px solid var(--control-border);border-radius:6px;padding:9px 11px;font-size:14px;color:var(--ink);box-shadow:0 1px 0 rgba(0,0,0,.03) inset}[data-v-851a0cc6] input:focus,[data-v-851a0cc6] textarea:focus,[data-v-851a0cc6] select:focus{outline:none;border-color:var(--control-focus);box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 28%,transparent)}[data-v-851a0cc6] input[type="checkbox"]{accent-color:var(--control-focus)}[data-v-851a0cc6] button{cursor:pointer;border:1px solid rgba(0,0,0,0);border-radius:6px;padding:10px 14px;font-weight:700;background:var(--btn-accent);color:#fff;transition:background .2s,box-shadow .2s,border-color .2s,transform .02s}[data-v-851a0cc6] button:hover{background:var(--btn-accent-hover)}[data-v-851a0cc6] button:active{transform:translateY(1px)}[data-v-851a0cc6] .muted-btn{background:var(--btn-muted);color:var(--muted);border-color:var(--btn-muted-border)}[data-v-851a0cc6] .muted-btn:hover{filter:brightness(0.97)}[data-v-851a0cc6] details{border:1px solid var(--line);border-radius:8px;background:var(--paper);margin:10px 0;padding:8px 10px 10px}[data-v-851a0cc6] summary{font-weight:700;color:var(--muted);background:color-mix(in srgb,var(--paper) 88%,black 0%);border-radius:6px;padding:6px 8px;cursor:pointer;-webkit-user-select:none;user-select:none}[data-v-851a0cc6] details[open]>summary{background:color-mix(in srgb,var(--paper) 78%,black 0%)}[data-v-851a0cc6] #cfg_status{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border:1px solid color-mix(in srgb,var(--control-focus) 35%,white 65%);background:color-mix(in srgb,var(--control-focus) 10%,white 90%);color:color-mix(in srgb,var(--control-focus) 70%,black 30%);border-radius:999px;font-weight:700;line-height:1.8}
#content_incidents h4[data-v-382a017e]{display:flex;align-items:center;margin:0 0 15px;padding-bottom:10px;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}#content_incidents .emoji[data-v-382a017e]{font-size:1em;line-height:1;margin-right:8px}#incident-toolbar[data-v-382a017e]{margin-bottom:15px}.debug-select[data-v-382a017e],.debug-switch[data-v-382a017e]{display:flex;align-items:center;gap:6px;font-size:.9em;padding:4px 8px;border:1px dashed var(--line);border-radius:6px;background:color-mix(in srgb,var(--paper) 50%,var(--bg) 50%)}:root[data-theme="dark"],:root[data-theme="dark"]{background:hsla(0,0%,100%,.05)}.incident-list[data-v-382a017e]{display:flex;flex-direction:column;gap:12px}.incident-list[data-v-382a017e] .role-card{background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:var(--pad);overflow:hidden}.incident-list[data-v-382a017e] .role-card .role-card-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding-bottom:8px;border-bottom:1px dashed var(--line)}.incident-list[data-v-382a017e] .role-card .role-avatar{width:40px;height:40px;border-radius:50%;border:1px solid var(--line);background:var(--avatar-bg);display:grid;place-items:center;font-weight:700;color:var(--muted)}.incident-list[data-v-382a017e] .role-card .role-name{font-weight:700}.incident-list[data-v-382a017e] .role-card .role-meta{font-size:.85em;color:var(--muted)}.incident-list[data-v-382a017e] .role-card .role-line{margin:6px 0;font-size:.9em}
.map-component{background:hsla(0,0%,100%,.9);box-shadow:0 10px 30px rgba(0,0,0,.3);overflow:hidden;margin-bottom:20px}.map-component .map-wrapper{position:relative;width:100%;height:100%;background:#f0f0f0}.map-component .map-container{white-space:nowrap;position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;cursor:grab}.map-component #mapCanvas{display:block;background:#7f8c8d}.map-component .marker{position:absolute;transform:translate(-50%,-50%);cursor:pointer}.map-component .container{position:absolute;transform:translate(-50%,-100%)}.map-component .map-info{position:absolute;top:20px;left:20px;background:hsla(0,0%,100%,.8);padding:8px 12px;border-radius:6px;font-size:.9rem;z-index:40}@keyframes bounce{0%,20%,50%,80%,100%{transform:translate(-50%,-100%)}40%{transform:translate(-50%,calc(-100% - 30px))}60%{transform:translate(-50%,calc(-100% - 15px))}}.map-component .pulsate{animation:bounce 2s infinite}.map-component .tip-container{position:absolute;transform-origin:bottom center;z-index:20}.map-component .dialog{background-color:#fff;border-radius:8px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.15);color:#333;position:relative;border:1px solid #fff}.map-component .dialog .location-name{font-size:16px;font-weight:bold;border-bottom:1px solid #333;padding-bottom:6px;margin-bottom:6px}.map-component .dialog::after{content:"";position:absolute;top:100%;left:50%;transform:translateX(-50%);border:12px solid rgba(0,0,0,0);border-top-color:#fff;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.1))}.map-component .main-role-marker{transform-origin:bottom center;font-size:24px;z-index:10}
.font-size-controls[data-v-7fbcf727]{display:flex;justify-content:flex-end;gap:6px;margin-bottom:10px}.font-size-btn[data-v-7fbcf727]{width:28px;height:28px;border:1px solid var(--line);background:var(--paper);border-radius:4px;cursor:pointer;font-weight:700}
.status-tabs[data-v-93a0a84e]{display:flex;gap:8px;border-bottom:1px solid var(--line);background:var(--paper);padding:0 15px;overflow:auto hidden;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity}.status-tabs button[data-v-93a0a84e]{padding:12px 16px;cursor:pointer;font-size:.95em;color:var(--muted);border:none;background:none;border-bottom:3px solid rgba(0,0,0,0);margin-bottom:-1px;flex:0 0 auto;scroll-snap-align:start}.status-tabs button.active[data-v-93a0a84e]{color:var(--ink);border-bottom-color:var(--tab-active);font-weight:700}.status-tab-content-area[data-v-93a0a84e]{flex:1;overflow:auto;padding:20px}.status-tab-content[data-v-93a0a84e]{display:none;line-height:1.6;font-size:.95em}.status-tab-content.active[data-v-93a0a84e]{display:block}:root[data-theme="dark"]{color:var(--muted)}:root[data-theme="dark"]{color:var(--ink)}@media (max-width:768px){.status-tab-content-area[data-v-93a0a84e]{padding:15px}}[data-v-93a0a84e] .font-size-controls{display:flex;justify-content:flex-end;gap:6px;margin-bottom:10px}[data-v-93a0a84e] .font-size-btn{width:28px;height:28px;border:1px solid var(--line);background:var(--paper);border-radius:4px;cursor:pointer;font-weight:700}[data-v-93a0a84e] .incident-list{display:flex;flex-direction:column;gap:12px}
.aya-news-button-closed[data-v-b15bd7b0]{padding:8px 12px;border:1px solid var(--line);border-radius:4px;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%}.aya-news-button-closed[data-v-b15bd7b0]:hover{background-color:var(--paper)}
.aya-news-button-open[data-v-4b56fc8f]{padding:12px 14px;border:1px solid var(--line);border-bottom-left-radius:0;border-bottom-right-radius:0;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%;box-shadow:0 2px 0 var(--line) inset;transition:padding .15s ease}.aya-news-button-open[data-v-4b56fc8f]:hover{background-color:var(--paper)}
.aya-news-popup[data-v-08972433]{width:100%;max-height:60vh;overflow:auto;padding:16px 20px;background:var(--paper);border:1px solid var(--line);border-top:none;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:0 8px 16px rgba(0,0,0,.05);display:flex;flex-direction:column;gap:10px}#aya-news-popup h4[data-v-08972433]{display:flex;align-items:center;height:var(--duo-head-h);margin:0 0 10px;padding:0;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}#aya-news-popup h4 .emoji[data-v-08972433]{font-size:1em;line-height:1;display:inline-grid;place-items:center;width:1.25em;height:1.25em;margin-right:8px}.news-body[data-v-08972433]{flex:1 1 auto;min-height:0;background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:10px;overflow:auto;white-space:normal;overflow-wrap:anywhere;word-break:break-word}
.aya-news-container[data-v-dfff4c24]{position:relative}

.GensokyoOrigin-RoleCard-wrapper{position:relative;flex:0 0 220px;min-width:0;background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:10px;scroll-snap-align:start;cursor:pointer;transition:background .2s ease}.GensokyoOrigin-RoleCard-wrapper:hover{background:color-mix(in srgb,var(--bg) 90%,var(--ink) 10%)}.GensokyoOrigin-RoleCard-header{display:flex;align-items:center;gap:10px;margin-bottom:8px;padding-bottom:8px;border-bottom:1px dashed var(--line)}.GensokyoOrigin-RoleCard-avatar{width:36px;height:36px;border-radius:50%;border:1px solid var(--line);background:var(--avatar-bg);display:grid;place-items:center;font-weight:700;color:var(--muted);flex-shrink:0}.GensokyoOrigin-RoleCard-name{font-weight:700;font-size:.95em}.GensokyoOrigin-RoleCard-meta{font-size:.8em;color:var(--muted)}
.GensokyoOrigin-RoleDetailPopup-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:1000}.GensokyoOrigin-RoleDetailPopup-popup{position:relative;width:90vw;max-width:600px;max-height:80vh;overflow-y:auto;background:var(--paper);border:1px solid var(--line);border-radius:12px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,.2)}.GensokyoOrigin-RoleDetailPopup-close-btn{position:absolute;top:12px;right:12px;width:30px;height:30px;border:none;background:rgba(0,0,0,0);font-size:24px;cursor:pointer;color:var(--muted)}.GensokyoOrigin-RoleDetailPopup-header{display:flex;align-items:center;gap:16px;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--line)}.GensokyoOrigin-RoleDetailPopup-avatar{width:60px;height:60px;border-radius:50%;border:1px solid var(--line);background:var(--avatar-bg);display:grid;place-items:center;font-size:24px;font-weight:700;color:var(--muted);flex-shrink:0}.GensokyoOrigin-RoleDetailPopup-name{font-size:1.5em;font-weight:700}.GensokyoOrigin-RoleDetailPopup-meta{font-size:1em;color:var(--muted)}.GensokyoOrigin-RoleDetailPopup-details-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px}.GensokyoOrigin-RoleDetailPopup-detail-item{background:var(--bg);padding:8px;border-radius:4px;font-size:.95em}.GensokyoOrigin-RoleDetailPopup-detail-item strong{color:var(--muted);margin-right:8px}.GensokyoOrigin-RoleDetailPopup-detail-item.full-width{grid-column:1/-1}
.role-ribbon-container[data-v-d2e5aac6]{position:relative;background:var(--paper);border-bottom:1px solid var(--line);padding:10px 40px;max-width:100%;overflow-x:hidden}.role-ribbon[data-v-d2e5aac6]{display:flex;gap:12px;overflow:auto hidden;scroll-snap-type:x proximity;padding-bottom:6px}.ribbon-arrow[data-v-d2e5aac6]{position:absolute;top:50%;transform:translateY(-50%);width:26px;height:26px;display:grid;place-items:center;border:1px solid var(--line);background:var(--bg);border-radius:4px;cursor:pointer;z-index:10}.ribbon-arrow.left[data-v-d2e5aac6]{left:8px}.ribbon-arrow.right[data-v-d2e5aac6]{right:8px}.role-card-placeholder[data-v-d2e5aac6]{flex:0 0 260px;padding:16px;background:var(--bg);border:1px dashed var(--line);border-radius:6px;color:var(--muted);display:grid;place-items:center}
.emoji[data-v-37a35e60]{margin-right:0;font-size:1.1em}.banner-chip[data-v-37a35e60]{display:inline-flex;align-items:center;gap:.5em;padding:6px 10px;background:color-mix(in srgb,var(--paper) 90%,var(--tab-active) 10%);border:1px solid var(--line);border-radius:999px;font-weight:700;color:var(--ink);cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .08s ease,box-shadow .12s ease,background .2s ease}.banner-chip[data-v-37a35e60]:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}.banner-chip[data-v-37a35e60]:active{transform:translateY(1px) scale(0.99)}
.banner-chip-open[data-v-a8d897e6]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 16px;background:var(--tab-active);border:1px solid var(--line);border-top-left-radius:10px;border-top-right-radius:10px;font-weight:700;color:var(--ink-bright);cursor:pointer;-webkit-user-select:none;user-select:none}.emoji[data-v-a8d897e6]{font-size:1.2em;margin-right:8px}.close-icon[data-v-a8d897e6]{font-size:.9em;color:var(--ink)}
.cal-day-container[data-v-35064b7e]{position:relative;display:flex;flex-direction:column;align-items:stretch;justify-content:flex-start;aspect-ratio:1/1;min-width:0;min-height:0}.cal-day-btn[data-v-35064b7e]{width:100%;height:100%;padding:6px;border:1px solid var(--line);border-radius:8px;background:var(--paper);cursor:pointer;-webkit-user-select:none;user-select:none;transition:background .2s ease,box-shadow .2s ease,transform .06s ease}.cal-day-btn[data-v-35064b7e]:hover{background:color-mix(in srgb,var(--paper) 92%,black 8%)}.cal-day-btn[data-v-35064b7e]:active{transform:translateY(1px)}.cal-day-btn.today[data-v-35064b7e]{outline:2px solid var(--tab-active);outline-offset:0;box-shadow:0 0 0 2px color-mix(in srgb,var(--tab-active) 35%,transparent) inset}.cal-day-btn.has-fest[data-v-35064b7e]{--fest-color:color-mix(in srgb,var(--tab-active) calc(var(--importance,1) * 20%),transparent);background:color-mix(in srgb,var(--fest-color) 50%,var(--paper) 50%);border-color:var(--fest-color)}.cal-day-btn[data-importance="5"][data-v-35064b7e]{--importance:5}.cal-day-btn[data-importance="4"][data-v-35064b7e]{--importance:4}.cal-day-btn[data-importance="3"][data-v-35064b7e]{--importance:3}.cal-day-btn[data-importance="2"][data-v-35064b7e]{--importance:2}.cal-day-btn[data-importance="1"][data-v-35064b7e]{--importance:1}.dnum[data-v-35064b7e]{font-weight:800;color:var(--ink);text-align:right;line-height:1}.cal-day-placeholder[data-v-35064b7e]{width:100%;height:100%;border-radius:8px;background:color-mix(in srgb,var(--paper) 95%,black 5%)}.fest-popover[data-v-35064b7e]{position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:250px;padding:12px;background:var(--bg);border:1px solid var(--line);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1);z-index:10;pointer-events:none;display:flex;flex-direction:column;gap:8px}.fest-item[data-v-35064b7e]{border-top:1px solid var(--line);padding-top:8px}.fest-item[data-v-35064b7e]:first-child{border-top:none;padding-top:0}.fest-header[data-v-35064b7e]{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:6px}.fest-header strong[data-v-35064b7e]{font-weight:bold;color:var(--ink-bright)}.fest-host[data-v-35064b7e]{font-size:.85em;color:var(--muted)}.fest-customs[data-v-35064b7e]{list-style-type:disc;padding-left:20px;margin:0;font-size:.9em;color:var(--ink);display:flex;flex-direction:column;gap:4px}
.cal-content[data-v-03881b10]{position:static;width:100%;max-height:none;margin-top:-1px;padding:12px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:none;overflow:visible}.cal-head[data-v-03881b10]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}.cal-title[data-v-03881b10]{display:flex;align-items:baseline;gap:.5em;color:var(--ink)}.cal-title .month[data-v-03881b10]{font-size:1.25em;font-weight:800}.cal-title .year[data-v-03881b10]{font-size:.95em;color:var(--muted)}.cal-nav[data-v-03881b10]{display:flex;gap:6px}.cal-btn[data-v-03881b10]{cursor:pointer;-webkit-user-select:none;user-select:none;border:1px solid var(--line);background:var(--paper);border-radius:8px;padding:6px 10px;font-weight:700}.cal-btn[data-v-03881b10]:active{transform:translateY(1px)}.cal-body[data-v-03881b10]{padding:10px 12px 12px}.cal-week[data-v-03881b10]{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px;margin-bottom:6px;color:var(--muted);font-weight:700}.cal-week .w[data-v-03881b10]{text-align:center;padding:4px 0;border-bottom:1px dashed var(--line)}.cal-grid[data-v-03881b10]{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px;align-items:stretch;position:relative}
.time-container[data-v-517ae222]{position:relative}

.banner-chip[data-v-11b37370]{display:inline-flex;align-items:center;gap:.5em;padding:6px 10px;background:color-mix(in srgb,var(--paper) 90%,var(--tab-active) 10%);border:1px solid var(--line);border-radius:999px;font-weight:700;color:var(--ink);cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .08s ease,box-shadow .12s ease,background .2s ease}.banner-chip[data-v-11b37370]:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}.banner-chip[data-v-11b37370]:active{transform:translateY(1px) scale(0.99)}.emoji[data-v-11b37370]{margin-right:0;font-size:1.1em}
.banner-chip-open[data-v-1a6d77c8]{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 16px;background:var(--tab-active);border:1px solid var(--line);border-top-left-radius:10px;border-top-right-radius:10px;font-weight:700;color:var(--ink-bright);cursor:pointer;-webkit-user-select:none;user-select:none}.emoji[data-v-1a6d77c8]{font-size:1.2em;margin-right:8px}.close-icon[data-v-1a6d77c8]{font-size:.9em;color:var(--ink)}
.weather-content[data-v-16c06ed4]{position:static;width:100%;padding:16px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;color:var(--ink)}p[data-v-16c06ed4]{margin:4px 0}em[data-v-16c06ed4]{color:var(--muted);font-size:.9em}
.weather-container[data-v-0c8bdfda]{position:relative}

.emoji[data-v-55265fac]{margin-right:8px;font-size:1.1em}.status-banner[data-v-55265fac]{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:8px 10px 6px;padding:10px 12px;background:var(--paper);border:1px solid var(--line);border-radius:10px;box-shadow:0 1px 0 rgba(0,0,0,.03),0 6px 18px rgba(0,0,0,.05);position:relative}.status-banner .banner-title[data-v-55265fac]{display:flex;align-items:center;gap:8px;color:var(--muted);font-weight:700;margin-right:6px}.status-banner .banner-title .emoji[data-v-55265fac]{margin-right:0}.banner-sep[data-v-55265fac]{width:1px;height:18px;background:var(--line);align-self:center;margin:0 2px}:root[data-theme="dark"]{box-shadow:0 1px 0 rgba(0,0,0,.1),0 6px 18px rgba(0,0,0,.2)}
.theme-toggle[data-v-676236f6]{position:absolute;top:8px;right:8px;width:34px;height:34px;display:grid;place-items:center;border-radius:8px;border:1px solid var(--line);background:var(--paper);color:var(--muted);font-size:18px;cursor:pointer;-webkit-user-select:none;user-select:none;transition:transform .05s ease,box-shadow .15s ease,background .15s ease,border-color .15s ease;z-index:20}.theme-toggle[data-v-676236f6]:active{transform:translateY(1px)}.theme-toggle[data-v-676236f6]:focus-visible{outline:none;box-shadow:0 0 0 3px color-mix(in srgb,var(--control-focus) 25%,transparent);border-color:var(--control-focus)}:root[data-theme="light"],:root:not([data-theme]){box-shadow:0 2px 10px rgba(0,0,0,.05)}:root[data-theme="light"],:root:not([data-theme]){background:color-mix(in srgb,var(--paper) 88%,black 12%)}:root[data-theme="dark"]{border-color:color-mix(in srgb,var(--line) 70%,white 30%);background:color-mix(in srgb,var(--paper) 85%,white 0%);color:var(--ink);box-shadow:0 2px 12px rgba(0,0,0,.35)}:root[data-theme="dark"]{background:color-mix(in srgb,var(--paper) 75%,white 0%)}
.user-state-button-closed[data-v-89abe3c0]{padding:8px 12px;border:1px solid var(--line);border-radius:4px;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%}.user-state-button-closed[data-v-89abe3c0]:hover{background-color:var(--paper)}
.user-state-button-open[data-v-682280a6]{padding:12px 14px;border:1px solid var(--line);border-bottom-left-radius:0;border-bottom-right-radius:0;background-color:var(--bg);color:var(--ink);cursor:pointer;width:100%;box-shadow:0 2px 0 var(--line) inset;transition:padding .15s ease}.user-state-button-open[data-v-682280a6]:hover{background-color:var(--paper)}
.user-state-popup[data-v-9ec113e0]{position:static;width:100%;max-height:none;margin-top:-1px;padding:16px;background:var(--paper);border:1px solid var(--line);border-top:0;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:none;display:flex;flex-direction:column}.sidebar-content[data-v-9ec113e0]{overflow:visible}h4[data-v-9ec113e0]{display:flex;align-items:center;height:var(--duo-head-h);margin:0 0 10px;padding:0;line-height:1;font-size:1.1em;color:var(--muted);border-bottom:1px solid var(--line)}h4 .emoji[data-v-9ec113e0]{font-size:1em;line-height:1;display:inline-grid;place-items:center;width:1.25em;height:1.25em;margin-right:8px}p[data-v-9ec113e0]{margin:8px 0;font-size:.9em;line-height:1.5}p>span[data-v-9ec113e0]:last-child{flex:1 1 auto;min-width:0;white-space:normal;overflow-wrap:anywhere;word-break:break-word}
.user-state-container[data-v-0a721dc0]{position:relative}

.status-ui-container{position:relative;display:flex;flex-direction:column;margin:10px;border:1px solid var(--line);border-radius:4px;overflow-x:hidden;overflow-y:visible;background:var(--bg)}.status-main-content{flex:1;display:flex;flex-direction:column;min-height:0;overflow:visible}.status-duo{display:flex;flex-wrap:nowrap;align-items:flex-start;gap:10px;overflow-x:auto;overflow-y:visible;border-bottom:1px dashed var(--line);padding:12px;margin-bottom:12px;width:100%}@media (min-width:1100px){.status-ui-container{display:grid;grid-template-columns:380px minmax(0,1fr);grid-template-rows:auto;grid-auto-rows:auto}.status-duo{grid-column:1;grid-row:1;flex-direction:column;align-items:stretch;overflow-y:visible;overflow-x:hidden;border-right:1px dashed var(--line);border-bottom:none;padding:12px;margin-bottom:0;max-height:none}.status-main-content{grid-column:2}.status-duo>.user-state-container{flex:0 0 auto;border-right:none;border-bottom:1px solid var(--line)}}@media (max-width:768px){.status-ui-container{flex-direction:column;margin:5px}}
/*! tailwindcss v4.1.16 | MIT License | https://tailwindcss.com */:root{--duo-head-h:38px}*{box-sizing:border-box}body{margin:0;font-family:"Noto Serif SC",serif;color:var(--ink);font-size:14px;background:linear-gradient(var(--grid) 1px,transparent 1px),linear-gradient(90deg,var(--grid) 1px,transparent 1px),var(--bg);background-size:20px 20px}.preserve-format{white-space:pre-wrap;overflow-wrap:anywhere;word-break:break-word}.label{font-weight:600;color:var(--muted);min-width:90px;margin-right:5px}hr.dashed{border:none;border-top:1px dashed var(--line);margin:20px 0}html,body,.status-ui-container,.status-main-content,.status-tab-content-area,.role-ribbon-container{max-width:100%;overflow-x:hidden}#content_main,#main-content{max-width:100%;contain:inline-size}#main-content,#main-content *{max-width:100% !important}#main-content img,#main-content video{height:auto}#main-content table{display:block;overflow-x:auto}#main-content pre{white-space:pre-wrap;overflow-x:auto}.debug-console{font-family:ui-monospace,SFMono-Regular,Consolas,"Liberation Mono",Menlo,monospace;background:#0f0f0f;color:#e7e7e7;border:1px solid var(--line);border-radius:4px;padding:10px;height:260px;overflow:auto;white-space:pre-wrap;word-break:break-word}.debug-line{padding:2px 0;border-bottom:1px dashed hsla(0,0%,100%,.08)}.debug-badge{font-size:.75em;padding:2px 6px;border-radius:10px;margin-right:6px;background:#333;color:#eee}.debug-line.warn .debug-badge{background:#9b7b2f}.debug-line.error .debug-badge{background:#b2453d}.debug-stats{font-size:.85em;color:#cfcfcf;margin:6px 0 0;opacity:.9}:root,:root[data-theme=light]{--bg:#fffdf7;--paper:#fcfaf5;--ink:#4a3f35;--muted:#6b5a4b;--line:#d3c8b8;--tile:#e0d5c4;--pad:12px;--control-bg:#fff7e8;--control-border:#c9b59e;--control-focus:#b6782b;--btn-accent:#b76e2b;--btn-accent-hover:#a95f1e;--btn-muted:#efe8de;--btn-muted-border:#d3c8b8;--grid:rgba(224,213,196,0.1);--avatar-bg:#f5f1e8;--bar-bg:#f0ece4;--tab-active:#8c7b6a;--cal-cell-bg:var(--bg);--cal-cell-border:var(--line);--cal-hover-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-hover-bg:color-mix(in srgb,var(--paper) 88%,black 12%)}--cal-festival-bg:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-bg:color-mix(in srgb,var(--btn-accent) 10%,white 90%)}--cal-festival-border:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-border:color-mix(in srgb,var(--btn-accent) 30%,white 70%)}--cal-festival-text:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-text:color-mix(in srgb,var(--btn-accent) 75%,black 25%)}--cal-today-ring:var(--control-focus)}:root[data-theme=dark]{--bg:#13110f;--paper:#1b1916;--ink:#efe8de;--muted:#b7a899;--line:#4b433a;--tile:#2a241e;--pad:12px;--control-bg:#1f1b16;--control-border:#5b4e41;--control-focus:#d89a4a;--btn-accent:#c57a33;--btn-accent-hover:#b56b24;--btn-muted:#2a241e;--btn-muted-border:#4b433a;--grid:rgba(255,255,255,0.04);--avatar-bg:#1f1b17;--bar-bg:#2a2520;--tab-active:#c8b49d;--cal-cell-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-cell-bg:color-mix(in srgb,var(--paper) 92%,black 8%)}--cal-cell-border:var(--line);@supports (color:color-mix(in lab,red,red)){--cal-cell-border:color-mix(in srgb,var(--line) 85%,white 15%)}--cal-hover-bg:var(--paper);@supports (color:color-mix(in lab,red,red)){--cal-hover-bg:color-mix(in srgb,var(--paper) 80%,white 0%)}--cal-festival-bg:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-bg:color-mix(in srgb,var(--btn-accent) 14%,var(--paper) 86%)}--cal-festival-border:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-border:color-mix(in srgb,var(--btn-accent) 45%,var(--line) 55%)}--cal-festival-text:var(--btn-accent);@supports (color:color-mix(in lab,red,red)){--cal-festival-text:color-mix(in srgb,var(--btn-accent) 80%,white 20%)}--cal-today-ring:var(--control-focus)}@media (max-width:480px){.calendar-day .fest{font-size:.75em}}
</style></head><body><div id="app"></div></body></html>